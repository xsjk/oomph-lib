\chapter{Demo problem\+: 2D FSI on unstructured meshes}
\hypertarget{index}{}\label{index}\index{Demo problem: 2D FSI on unstructured meshes@{Demo problem: 2D FSI on unstructured meshes}}
This tutorial demonstrates the use of unstructured meshes in 2D fluid-\/structure interaction problems. We combine two single-\/physics problems, namely
\begin{DoxyItemize}
\item \href{../../../solid/unstructured_solid/html/index.html}{\texttt{ Large deformations of an elastic 2D solid, loaded by surface tractions and a gravitational body force}} ~\newline
~\newline

\item \href{../../../navier_stokes/unstructured_fluid/html/index.html}{\texttt{ Flow through a 2D channel that is partly obstructed by a rigid 2D solid body}}
\end{DoxyItemize}for which we have already created unstructured 2D meshes, using the combination of \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}, {\ttfamily oomph-\/lib\textquotesingle{}s} conversion code \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ {\ttfamily fig2poly},}} and the unstructured mesh generator \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle}. }}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_the_problem}{}\doxysection{\texorpdfstring{The problem}{The problem}}\label{index_the_problem}
The figure below shows a sketch of the problem. A 2D channel is partly obstructed by an odd-\/shaped elastic obstacle that deforms in response to gravity and to the traction that the fluid exerts onto it. The coupled problem is a straightforward combination of the two single-\/physics problems shown at the top of the sketch\+: The flow through a channel with a rigid obstacle (shown on the top left), and the deformation of the elastic obstacle in response to a prescribed surface traction (shown on the top right). When the two constituent single-\/physics problems interact, the fluid provides the traction onto the solid while the change in the solid\textquotesingle{}s shape affects the fluid domain.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{fsi_sketch}
\doxyfigcaption{Sketch of the problem and its two single-\/physics constituents. }
\end{DoxyImage}


As usual, we solve the problem in non-\/dimensional form. For this purpose we non-\/dimensionalise all lengths on some reference length $ {\cal L} $ and use the average inflow velocity, $ {\cal U}$, to non-\/dimensionalise the velocities in the Navier-\/\+Stokes equations. As discussed in the \href{../../../navier_stokes/unstructured_fluid/html/index.html\#reynolds}{\texttt{ single-\/physics fluids tutorial,}} the Reynolds number of the flow is then given by  \[
Re = \frac{\rho {\cal U} {\cal L}}{\mu} \ ,
\] where $ \rho $ and $ \mu $ are the fluid density and viscosity, respectively. {\ttfamily oomph-\/lib\textquotesingle{}s} Navier Stokes elements non-\/dimensionalise the fluid stresses, and in particular the pressure, on the viscous scale, $ \mu {\cal U}/{\cal L} $.

We assume that the solid\textquotesingle{}s constitutive equation is given by {\ttfamily oomph-\/lib\textquotesingle{}s} generalised Hookean constitutive law and non-\/dimensionalise the solid-\/mechanics stresses and tractions with Young\textquotesingle{}s modulus $ E $.

The FSI interaction parameter $ Q $ which represents the ratio of the (viscous) fluid stress scale to the reference stress used to non-\/dimensionalise the solid stresses is therefore given by  \[
Q = \frac{\mu {\cal U}}{{\cal L} E} \ .
\]

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_results}{}\doxysection{\texorpdfstring{Results}{Results}}\label{index_results}
The animation below shows a number of steady flow fields (streamlines and pressure contours) and deformations, obtained in a parameter study in which we first compute the solution of the coupled problem at zero Reynolds number and for a vanishing FSI interaction parameter, $ Q=0 $. For these parameter values, the structure is loaded only by gravity and does not feel the presence of the fluid, whereas the fluid flow is affected by the changes to the fluid domain when the obstacle deforms (first frame). Next, we increase the Reynolds number to $ Re=10$ and re-\/compute the solution (second frame), before increasing $ Q $ in small increments (subsequent frames). The increase in $ Q $ may be interpreted as a reduction in the obstacle\textquotesingle{}s stiffness and the animation shows clearly how this increases its flow-\/induced deformation.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{flow}
\doxyfigcaption{Animation of the flow field (streamlines and pressure contours) and the deformation of the elastic obstacle. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_overview_implementation}{}\doxysection{\texorpdfstring{Overview of the implementation}{Overview of the implementation}}\label{index_overview_implementation}
The use of unstructured meshes means that the design of an algebraic node update strategy for the deforming fluid mesh, as described for \href{../../fsi_collapsible_channel_algebraic/html/index.html}{\texttt{ fluid-\/structure interaction with structured meshes, }} is (almost) impossible and would, in any case, defeat the point of using automatic mesh generation tools. A slightly less efficient, but easily and generally applicable strategy is to update the nodal positions within the fluid mesh by treating the fluid domain as a pseudo-\/elastic solid. Apart from this change in the node-\/update strategy, the majority of the steps described below are the same as for fluid-\/structure-\/interaction problems on structured meshes.

One important prerequisite for the use of the FSI helper functions in {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily FSI\+\_\+functions} namespace is that each boundary at the FSI interface between the fluid and solid meshes must be parametrised by boundary coordinates. Moreover, the boundary-\/coordinate representations in the fluid and solid meshes {\bfseries{ must }} be consistent. Once the appropriate boundaries have been identified, {\ttfamily oomph-\/lib\textquotesingle{}s} unstructured meshes allow the automatic (and consistent) generation of these boundary coordinates; see \doxysectlink{index_boundary_coord}{How the boundary coordinates are generated}{2}. Unfortunately, different third-\/party mesh generators use different strategies to label mesh boundaries and a certain amount of "{}manual labour"{} tends be required to identify boundaries after the mesh has been imported into {\ttfamily oomph-\/lib}.

Since the driver code, discussed in detail below, is somewhat lengthy (partly because of the large number of self-\/tests and diagnostics included), we provide a brief overview of the main steps required to solve this problem\+: ~\newline
~\newline

\begin{DoxyEnumerate}
\item Use the combination of \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}, {\ttfamily oomph-\/lib\textquotesingle{}s} conversion code \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ {\ttfamily fig2poly},}} and the unstructured mesh generator \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} to generate the solid mesh, as already discussed in \href{../../../solid/unstructured_solid/html/index.html\#mesh}{\texttt{ another tutorial.}} ~\newline
~\newline

\item Use the same procedure to generate the fluid mesh, as discussed in \href{../../../navier_stokes/unstructured_fluid/html/index.html\#mesh}{\texttt{ the single-\/physics fluids tutorial.}} Make sure that the fluid mesh is derived from the {\ttfamily Solid\+Mesh} base class to allow the use of pseudo-\/elasticity to update the nodal positions in response to the deformation of the domain boundary. ~\newline
~\newline

\item Ensure that boundary coordinates are set up (consistently) on the FSI interface between the two meshes. For meshes derived from {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Triangle\+Mesh} class, this may be done by calling the function {\ttfamily Triangle\+Mesh\+::setup\+\_\+boundary\+\_\+coordinates()}. ~\newline
~\newline

\item Attach {\ttfamily FSISolid\+Traction\+Elements} to the faces of the "{}bulk"{} solid elements that are exposed to the fluid flow. These elements will apply the fluid traction to the solid. ~\newline
~\newline

\item Combine the {\ttfamily FSISolid\+Traction\+Elements} into a compound {\ttfamily Geom\+Object} that provides a continuous representation of the solid\textquotesingle{}s FSI boundary, required by the {\ttfamily Impose\+Displacement\+By\+Lagrange\+Multiplier\+Elements} described below. ~\newline
~\newline

\item Attach {\ttfamily Impose\+Displacement\+By\+Lagrange\+Multiplier\+Elements} to the faces of the "{}bulk"{} fluid elements that are adjacent to the solid. These elements will employ Lagrange multipliers to deform the pseudo-\/solid fluid mesh so that its shape remains consistent with the solid\textquotesingle{}s FSI boundary (as described by the compound {\ttfamily Geom\+Object} created in the previous step). ~\newline
~\newline

\item Determine the "{}bulk"{} fluid elements that are adjacent to the integration points of the {\ttfamily FSISolid\+Traction\+Elements}, using the function {\ttfamily FSI\+\_\+functions\+::setup\+\_\+fluid\+\_\+load\+\_\+info\+\_\+for\+\_\+solid\+\_\+elements(...)}. ~\newline
~\newline

\end{DoxyEnumerate}In our experience, the most error-\/prone part of this procedure is the identification of the mesh boundaries in the \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}-\/based, unstructured meshes. It is very easy to exclude a node at the end of the FSI boundary in the fluid mesh, say, while "{}remembering"{} it in the solid mesh. If this happens, the automatic matching of the unstructured fluid and solid meshes will not work (see \doxysectlink{index_boundary_coord}{How the boundary coordinates are generated}{2} for details). For this reason, the driver code presented below generates a lot of output that can be used to identify and fix such problems. See also the section \doxysectlink{index_go_wrong}{What can go wrong?}{2} at the end of this tutorial.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_namespace}{}\doxysection{\texorpdfstring{Problem Parameters}{Problem Parameters}}\label{index_namespace}
As usual we define the various problem parameters in a global namespace. We define the Reynolds number, $ Re $, and the FSI interaction parameter $ Q $.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_namespace==============================}}
\DoxyCodeLine{\textcolor{comment}{///\ Namespace\ for\ physical\ parameters}}
\DoxyCodeLine{\textcolor{comment}{//==================================================}}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceGlobal__Parameters}{Global\_Parameters}}}
\DoxyCodeLine{\{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Reynolds\ number}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a9d72e94a9305c6a310940a6a427ebe06}{Re}}=0.0;\ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ FSI\ parameter}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a7814fddf663e56168174a42d2cd6b4c1}{Q}}=0.0;}

\end{DoxyCodeInclude}
 We define the gravitational body force that acts (only!) on the solid ~\newline
 (see \doxysectlink{index_b_f}{Gravity only affects the solid -- really?}{2} to find out why this is odd...)


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Non-\/dim\ gravity}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a335000b5db4206486a116ae0468d2d0c}{Gravity}}=0.0;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Non-\/dimensional\ gravity\ as\ body\ force}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a200109847bf4cc26da4d00e8d68d569e}{gravity}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ time,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Vector<double>\ \&xi,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ Vector<double>\ \&b)}
\DoxyCodeLine{\ \{}
\DoxyCodeLine{\ \ b[0]=0.0;}
\DoxyCodeLine{\ \ b[1]=-\/\mbox{\hyperlink{namespaceGlobal__Parameters_a335000b5db4206486a116ae0468d2d0c}{Gravity}};}
\DoxyCodeLine{\ \}}

\end{DoxyCodeInclude}
 and provide a pointer to the constitutive equation for the solid. For simplicity, this constitutive equation will also be used for the (pseudo-\/)solid elements that determine the deformation of the fluid mesh. In general, the constitutive law used to control the deformation of the fluid mesh need not have any physical basis, it is more important that the elements do not become too deformed during the mesh motion.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pseudo-\/solid\ Poisson\ ratio}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a20fccdcfa2c15ad8b951b9ada3bb1661}{Nu}}=0.3;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constitutive\ law\ for\ the\ solid\ (and\ pseudo-\/solid)\ mechanics}}
\DoxyCodeLine{\textcolor{comment}{}\ ConstitutiveLaw\ *\mbox{\hyperlink{namespaceGlobal__Parameters_adbd1f040f375c96fe56b3f475f7dbec2}{Constitutive\_law\_pt}}=0;}

\end{DoxyCodeInclude}
 Finally, we provide a helper function that will be used to establish whether a node is located on the FSI boundary when the mesh is in its undeformed configuration. This function uses a simple "{}brute force"{} approach. It is required because currently our \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}-\/based mesh generation procedures do not allow us to associate fractional parts of a polygonal domain boundary as belonging to different mesh boundaries. Hence, such boundaries have to be identified a posteriori in the driver code. Although similar in form, equivalent helper functions must be (re-\/)written for different domain geometries.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Boolean\ to\ identify\ if\ node\ is\ on\ fsi\ boundary}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceGlobal__Parameters_a655abf819eb3045dac883f2b7073ba22}{is\_on\_fsi\_boundary}}(Node*\ nod\_pt)}
\DoxyCodeLine{\ \{}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{if}\ (}
\DoxyCodeLine{\ \ \ (}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Is\ it\ a\ boundary\ node?}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{dynamic\_cast<}BoundaryNodeBase*\textcolor{keyword}{>}(nod\_pt)!=0)\&\&}
\DoxyCodeLine{\ \ \ (}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Horizontal\ extent\ of\ main\ immersed\ obstacle}}
\DoxyCodeLine{\ \ \ \ (\ \ (nod\_pt-\/>x(0)>1.6)\&\&(nod\_pt-\/>x(0)<4.75)\&\&}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Vertical\ extent\ of\ main\ immersed\ obstacle}}
\DoxyCodeLine{\ \ \ \ \ \ \ (nod\_pt-\/>x(1)>0.1125)\&\&(nod\_pt-\/>x(1)<2.8)\ )\ ||}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Two\ nodes\ on\ the\ bottom\ wall\ are\ below\ y=0.3}}
\DoxyCodeLine{\ \ \ \ (\ \ (nod\_pt-\/>x(1)<0.3)\&\&}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ ...and\ bracketed\ in\ these\ two\ x-\/ranges}}
\DoxyCodeLine{\ \ \ \ \ \ \ (\ \ (\ (nod\_pt-\/>x(0)>3.0)\&\&(nod\_pt-\/>x(0)<3.1)\ )\ ||}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ (\ (nod\_pt-\/>x(0)<4.6)\&\&(nod\_pt-\/>x(0)>4.5)\ )\ \ \ )\ }
\DoxyCodeLine{\ \ \ \ \ )}
\DoxyCodeLine{\ \ \ \ )}
\DoxyCodeLine{\ \ \ )}
\DoxyCodeLine{\ \ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\ \ \ \}}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\ \ \ \}}
\DoxyCodeLine{\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_namespace}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_mesh_code}{}\doxysection{\texorpdfstring{Creating the meshes}{Creating the meshes}}\label{index_mesh_code}
\hypertarget{index_solid_mesh}{}\doxysubsection{\texorpdfstring{The solid mesh}{The solid mesh}}\label{index_solid_mesh}
Following the procedure discussed in the corresponding \href{../../../solid/unstructured_solid/html/index.html}{\texttt{ single-\/physics solid mechanics problem}} we create the mesh for the elastic obstacle using multiple inheritance from {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Triangle\+Mesh} and the {\ttfamily Solid\+Mesh} base class.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//========start\_solid\_mesh=================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Triangle-\/based\ mesh\ upgraded\ to\ become\ a\ solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classMySolidTriangleMesh}{MySolidTriangleMesh}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ TriangleMesh<ELEMENT>,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ SolidMesh\ }
\DoxyCodeLine{\{}

\end{DoxyCodeInclude}
 As before, we set the Lagrangian coordinates to the current nodal positions to make the initial configuration stress-\/free. Initially all boundary nodes are located on the same boundary, corresponding to the single xfig polyline that defines the surface of the elastic obstacle. In the current problem we have to identify two additional boundaries\+: The "{}bottom boundary"{} (boundary 1) where the positions of the solid nodes will be pinned; and the nodes that are located on the FSI boundary (boundary 2).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classMySolidTriangleMesh}{MySolidTriangleMesh}}(\textcolor{keyword}{const}\ std::string\&\ node\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ poly\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TimeStepper*\ time\_stepper\_pt=}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&Mesh::Default\_TimeStepper)\ :}
\DoxyCodeLine{\ \ TriangleMesh<ELEMENT>(node\_file\_name,element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ poly\_file\_name,\ time\_stepper\_pt)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Assign\ the\ Lagrangian\ coordinates}}
\DoxyCodeLine{\ \ \ set\_lagrangian\_nodal\_coordinates();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Identify\ special\ boundaries}}
\DoxyCodeLine{\ \ \ set\_nboundary(3);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ n\_node=this-\/>nnode();}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ j=0;j<n\_node;j++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ Node*\ nod\_pt=this-\/>node\_pt(j);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 1\ is\ lower\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)<0.15)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>remove\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>add\_boundary\_node(1,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 2\ is\ FSI\ interface}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespaceGlobal__Parameters_a655abf819eb3045dac883f2b7073ba22}{Global\_Parameters::is\_on\_fsi\_boundary}}(nod\_pt))}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>remove\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>add\_boundary\_node(2,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}\textcolor{comment}{//\ done\ boundary\ assignment}}

\end{DoxyCodeInclude}


Finally, we identify the elements that are located next to the newly created domain boundaries and create boundary coordinates along boundaries 1 and 2.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Identify\ the\ elements\ next\ to\ the\ newly\ created\ boundaries}}
\DoxyCodeLine{\ \ \ TriangleMesh<ELEMENT>::setup\_boundary\_element\_info();}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Setup\ boundary\ coordinates\ for\ boundaries\ 1\ and\ 2}}
\DoxyCodeLine{\ \ \ this-\/>\textcolor{keyword}{template}\ setup\_boundary\_coordinates<ELEMENT>(1);}
\DoxyCodeLine{\ \ \ this-\/>\textcolor{keyword}{template}\ setup\_boundary\_coordinates<ELEMENT>(2);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Empty\ Destructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classMySolidTriangleMesh}{\string~MySolidTriangleMesh}}()\ \{\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
\hypertarget{index_fluid_mesh}{}\doxysubsection{\texorpdfstring{The fluid mesh}{The fluid mesh}}\label{index_fluid_mesh}
The creation of the fluid mesh follows the same process but uses the mesh created for the ~\newline
 \href{../../../navier_stokes/unstructured_fluid/html/index.html}{\texttt{ single-\/physics fluids problem.}} The use of multiple inheritance from the {\ttfamily Triangle\+Mesh} and {\ttfamily Solid\+Mesh} base classes will allow us to employ pseudo-\/solid node-\/update techniques to update the position of the fluid nodes in response to changes in the domain boundary.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//======================start\_fluid\_mesh===================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Triangle-\/based\ mesh\ upgraded\ to\ become\ a\ pseudo-\/solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classFluidTriangleMesh}{FluidTriangleMesh}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ TriangleMesh<ELEMENT>,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ SolidMesh\ }
\DoxyCodeLine{\{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classFluidTriangleMesh}{FluidTriangleMesh}}(\textcolor{keyword}{const}\ std::string\&\ node\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ poly\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TimeStepper*\ time\_stepper\_pt=}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&Mesh::Default\_TimeStepper)\ :}
\DoxyCodeLine{\ \ TriangleMesh<ELEMENT>(node\_file\_name,element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ poly\_file\_name,\ time\_stepper\_pt)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Assign\ the\ Lagrangian\ coordinates}}
\DoxyCodeLine{\ \ \ set\_lagrangian\_nodal\_coordinates();}

\end{DoxyCodeInclude}
 The fluid problem requires the identification of three additional boundaries\+: The inflow boundary (boundary 1), the outflow boundary (boundary 2) and the FSI boundary (boundary 3).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Identify\ special\ boundaries}}
\DoxyCodeLine{\ \ \ this-\/>set\_nboundary(4);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ n\_node=this-\/>nnode();}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ j=0;j<n\_node;j++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ Node*\ nod\_pt=this-\/>node\_pt(j);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 1\ is\ left\ (inflow)\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(0)<0.226)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>remove\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>add\_boundary\_node(1,nod\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ overlapping\ nodes\ back\ to\ boundary\ 0}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)<0.2)\ this-\/>add\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)>4.06)\ this-\/>add\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 2\ is\ right\ (outflow)\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(0)>8.28)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>remove\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>add\_boundary\_node(2,nod\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ overlapping\ nodes\ back\ to\ boundary\ 0}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)<0.2)\ this-\/>add\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)>4.06)\ this-\/>add\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 3\ is\ FSI\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespaceGlobal__Parameters_a655abf819eb3045dac883f2b7073ba22}{Global\_Parameters::is\_on\_fsi\_boundary}}(nod\_pt))}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>remove\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>add\_boundary\_node(3,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//If\ it's\ below\ y=0.2\ it's\ also\ on\ boundary\ 0\ so\ stick\ it\ back\ on}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>x(1)<0.2)\ this-\/>add\_boundary\_node(0,nod\_pt);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ TriangleMesh<ELEMENT>::setup\_boundary\_element\_info();}

\end{DoxyCodeInclude}
 We create boundary coordinates along the three newly-\/created mesh boundaries and document the process for the FSI boundary (boundary 3). See \doxysectlink{index_go_wrong}{What can go wrong?}{2} for a more detailed discussion of the output created here. ~\newline



\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Open\ a\ file\ to\ doc\ the\ FaceElements\ that\ are\ used\ to}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ create\ the\ boundary\ coordinates.\ The\ elements\ must}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ form\ a\ simply-\/connected\ line.\ This\ may\ not\ work}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ if\ the\ mesh\ is\ too\ coarse\ so\ that,\ e.g.\ an\ element}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ that\ goes\ through\ the\ interior\ has\ endpoints\ that\ are}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ both\ located\ on\ the\ same\ boundary.\ Outputting\ the}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ FaceElements\ can\ help\ identify\ such\ cases.}}
\DoxyCodeLine{\ \ \ ofstream\ some\_file(\textcolor{stringliteral}{"{}RESLT/boundary\_generation\_test.dat"{}});}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Setup\ boundary\ coordinates\ for\ boundaries\ 1,\ 2\ and\ 3}}
\DoxyCodeLine{\ \ \ this-\/>\textcolor{keyword}{template}\ setup\_boundary\_coordinates<ELEMENT>(1);}
\DoxyCodeLine{\ \ \ this-\/>\textcolor{keyword}{template}\ setup\_boundary\_coordinates<ELEMENT>(2);}
\DoxyCodeLine{\ \ \ this-\/>\textcolor{keyword}{template}\ setup\_boundary\_coordinates<ELEMENT>(3,some\_file);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Close\ it\ again}}
\DoxyCodeLine{\ \ \ some\_file.close();}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Empty\ Destructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classFluidTriangleMesh}{\string~FluidTriangleMesh}}()\ \{\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_main}{}\doxysection{\texorpdfstring{The driver code}{The driver code}}\label{index_main}
We specify an output directory and instantiate the constitutive equation for the solid mechanics computations, specifying the Poisson ratio. (\href{../../../solid/solid_theory/html/index.html\#non-dim_solid}{\texttt{ Recall}} that the omission of Young\textquotesingle{}s modulus $ E $ in the constructor of the constitutive equation implies that all stresses and tractions are non-\/dimensionalised on $ E $.)

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_main======================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Driver\ for\ unstructured\ fsi\ problem}}
\DoxyCodeLine{\textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{unstructured__two__d__fsi_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Label\ for\ output}}
\DoxyCodeLine{\ DocInfo\ doc\_info;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ output\ directory}}
\DoxyCodeLine{\ doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT"{}});}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Create\ the\ constitutive\ law}}
\DoxyCodeLine{\ \mbox{\hyperlink{namespaceGlobal__Parameters_adbd1f040f375c96fe56b3f475f7dbec2}{Global\_Parameters::Constitutive\_law\_pt}}\ =\ \textcolor{keyword}{new}\ GeneralisedHookean(}
\DoxyCodeLine{\ \ \&\mbox{\hyperlink{namespaceGlobal__Parameters_a20fccdcfa2c15ad8b951b9ada3bb1661}{Global\_Parameters::Nu}});}

\end{DoxyCodeInclude}
 We create the {\ttfamily Problem} object and output the domain boundaries and the initial guess for the solution.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ the\ problem\ with\ triangular\ Taylor\ Hood\ for\ fluid\ and\ solid}}
\DoxyCodeLine{\ \mbox{\hyperlink{classUnstructuredFSIProblem}{UnstructuredFSIProblem}}<}
\DoxyCodeLine{\ PseudoSolidNodeUpdateElement<TTaylorHoodElement<2>,\ TPVDElement<2,3>\ >,\ }
\DoxyCodeLine{\ \ TPVDElement<2,3>\ >\ problem;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ boundaries\ }}
\DoxyCodeLine{\ problem.\mbox{\hyperlink{classUnstructuredFSIProblem_a920c8629e5516bf916edd340d445100f}{fluid\_mesh\_pt}}()-\/>output\_boundaries(\textcolor{stringliteral}{"{}RESLT/fluid\_boundaries.dat"{}});}
\DoxyCodeLine{\ problem.solid\_mesh\_pt()-\/>output\_boundaries(\textcolor{stringliteral}{"{}RESLT/solid\_boundaries.dat"{}});}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ the\ initial\ guess\ for\ the\ solution}}
\DoxyCodeLine{\ problem.doc\_solution(doc\_info);}
\DoxyCodeLine{\ doc\_info.number()++;}

\end{DoxyCodeInclude}
 Finally, we perform a two-\/stage parameter study. We start by solving the problem at zero Reynolds number with the FSI parameter $ Q $ set to zero.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Parameter\ study}}
\DoxyCodeLine{\ \mbox{\hyperlink{namespaceGlobal__Parameters_a335000b5db4206486a116ae0468d2d0c}{Global\_Parameters::Gravity}}=2.0e-\/4;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ q\_increment=1.0e-\/6;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Solve\ the\ problem\ at\ zero\ Re\ and\ Q}}
\DoxyCodeLine{\ problem.newton\_solve();}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ the\ solution}}
\DoxyCodeLine{\ problem.doc\_solution(doc\_info);}
\DoxyCodeLine{\ doc\_info.number()++;}

\end{DoxyCodeInclude}
 Next we re-\/solve the problem at finite Reynolds number, before slowly increasing the strength of the fluid-\/structure interaction.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Bump\ up\ Re}}
\DoxyCodeLine{\ \mbox{\hyperlink{namespaceGlobal__Parameters_a9d72e94a9305c6a310940a6a427ebe06}{Global\_Parameters::Re}}=10.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Now\ do\ proper\ parameter\ study\ with\ increase\ in\ Q}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nstep=2;\ \textcolor{comment}{//\ 10;}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i=0;i<nstep;i++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Solve\ the\ problem}}
\DoxyCodeLine{\ \ \ problem.newton\_solve();}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Output\ the\ solution}}
\DoxyCodeLine{\ \ \ problem.doc\_solution(doc\_info);}
\DoxyCodeLine{\ \ \ doc\_info.number()++;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Bump\ up\ Q}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{namespaceGlobal__Parameters_a7814fddf663e56168174a42d2cd6b4c1}{Global\_Parameters::Q}}+=q\_increment;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_main}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_class}{}\doxysection{\texorpdfstring{The Problem class}{The Problem class}}\label{index_class}
The {\ttfamily Problem} class has the usual members, with access functions to the fluid and solid meshes, and a post-\/processing routine.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_problem\_class============================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Unstructured\ FSI\ Problem}}
\DoxyCodeLine{\textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ FLUID\_ELEMENT,\ \textcolor{keyword}{class}\ SOLID\_ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classUnstructuredFSIProblem}{UnstructuredFSIProblem}}\ :\ \textcolor{keyword}{public}\ Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a6a31fd839e0215ef1312942cf7284bd2}{UnstructuredFSIProblem}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a976a81e0dee902f6713bd8ca4d79d000}{\string~UnstructuredFSIProblem}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ for\ the\ fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classFluidTriangleMesh}{FluidTriangleMesh<FLUID\_ELEMENT>}}*\&\ \mbox{\hyperlink{classUnstructuredFSIProblem_a920c8629e5516bf916edd340d445100f}{fluid\_mesh\_pt}}()\ }
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a33c3b4cd9923f8b25368ff20e4810b2c}{Fluid\_mesh\_pt}};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ for\ the\ solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classMySolidTriangleMesh}{MySolidTriangleMesh<SOLID\_ELEMENT>}}*\&\ \mbox{\hyperlink{classUnstructuredFSIProblem_a3aeaaac80eca8d12a97bd7d268bccdb0}{solid\_mesh\_pt}}()\ }
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classUnstructuredFSIProblem_aeb164665366e237ca311e448466d7c9d}{Solid\_mesh\_pt}};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a15f581318b505de07f50bd570da8c8d0}{doc\_solution}}(DocInfo\&\ doc\_info);}

\end{DoxyCodeInclude}
 The class provides two private helper functions\+: one to create the {\ttfamily Face\+Elements} that apply the fluid traction to the solid and one to create the {\ttfamily Face\+Elements} that use Lagrange multipliers to deform the fluid mesh according to the motion of the solid boundary.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Create\ FSI\ traction\ elements}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ create\_fsi\_traction\_elements();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Create\ elements\ that\ enforce\ prescribed\ boundary\ motion}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ for\ the\ pseudo-\/solid\ fluid\ mesh\ by\ Lagrange\ multipliers}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ create\_lagrange\_multiplier\_elements();}

\end{DoxyCodeInclude}
 Another private helper function is provided to document the boundary parametrisation of the solid\textquotesingle{}s FSI interface\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Sanity\ check:\ Doc\ boundary\ coordinates\ from\ solid\ side}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ doc\_solid\_boundary\_coordinates();}

\end{DoxyCodeInclude}
 The private member data includes pointers to the various meshes and a {\ttfamily Geom\+Object} representation of the FSI boundary.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classFluidTriangleMesh}{FluidTriangleMesh<FLUID\_ELEMENT>}}*\ Fluid\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classMySolidTriangleMesh}{MySolidTriangleMesh<SOLID\_ELEMENT>}}*\ Solid\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointers\ to\ mesh\ of\ Lagrange\ multiplier\ elements}}
\DoxyCodeLine{\textcolor{comment}{}\ SolidMesh*\ Lagrange\_multiplier\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Vector\ of\ pointers\ to\ mesh\ of\ FSI\ traction\ elements}}
\DoxyCodeLine{\textcolor{comment}{}\ SolidMesh*\ Traction\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ GeomObject\ incarnation\ of\ fsi\ boundary\ in\ solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ MeshAsGeomObject*\ }
\DoxyCodeLine{\ Solid\_fsi\_boundary\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{\};\ }

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_constructor}{}\doxysection{\texorpdfstring{The Problem constructor}{The Problem constructor}}\label{index_constructor}
We start by building the fluid mesh, using the files created by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }}; see the discussion in the corresponding \href{../../../navier_stokes/unstructured_fluid/html/index.html\#mesh}{\texttt{ single-\/physics fluids problem.}}


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_constructor==================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Constructor\ for\ unstructured\ FSI\ problem.}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ FLUID\_ELEMENT,\ \textcolor{keyword}{class}\ SOLID\_ELEMENT>}
\DoxyCodeLine{\mbox{\hyperlink{classUnstructuredFSIProblem_a6a31fd839e0215ef1312942cf7284bd2}{UnstructuredFSIProblem<FLUID\_ELEMENT,SOLID\_ELEMENT>::UnstructuredFSIProblem}}()}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Create\ fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ fluid\_node\_file\_name=\textcolor{stringliteral}{"{}fluid.fig.1.node"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ fluid\_element\_file\_name=\textcolor{stringliteral}{"{}fluid.fig.1.ele"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ fluid\_poly\_file\_name=\textcolor{stringliteral}{"{}fluid.fig.1.poly"{}};\ }
\DoxyCodeLine{\ Fluid\_mesh\_pt\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFluidTriangleMesh}{FluidTriangleMesh<FLUID\_ELEMENT>}}(fluid\_node\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fluid\_element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fluid\_poly\_file\_name);}

\end{DoxyCodeInclude}


Next, we apply the boundary conditions for the fluid and the pseudo-\/solid equations. We pin the pseudo-\/solid nodes along all domain boundaries, apart from the FSI boundary (boundary 3), apply a no-\/slip condition for the fluid velocity along the solid channel walls (boundary 0) and the FSI boundary (boundary 3); pin the velocity at the inflow (boundary 1, where we will impose a Poiseuille flow profile); and impose parallel outflow at the downstream end (boundary 2). As mentioned before, the manual identification of mesh boundaries in unstructured meshes that are generated by third-\/party mesh generators is a relatively error-\/prone process. Therefore we document the boundary conditions for the pseudo-\/solid to allow an external sanity check.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Doc\ pinned\ solid\ nodes}}
\DoxyCodeLine{\ std::ofstream\ pseudo\_solid\_bc\_file(\textcolor{stringliteral}{"{}pinned\_pseudo\_solid\_nodes.dat"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ the\ boundary\ conditions\ for\ fluid\ problem:\ All\ nodes\ are}}
\DoxyCodeLine{\ \textcolor{comment}{//\ free\ by\ default\ -\/-\/\ just\ pin\ the\ ones\ that\ have\ Dirichlet\ conditions}}
\DoxyCodeLine{\ \textcolor{comment}{//\ here.\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nbound=Fluid\_mesh\_pt-\/>nboundary();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ ibound=0;ibound<nbound;ibound++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Pin\ velocity\ everywhere\ apart\ from\ outlet\ where\ we}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ have\ parallel\ outflow}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (ibound!=2)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin(0);\ }
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin(1);\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Pin\ pseudo-\/solid\ positions\ everywhere\ apart\ from\ boundary\ 3,\ }}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ the\ fsi\ boundary\ }}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ ((ibound==0)||(ibound==1)||(ibound==2))}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ i=0;i<2;i++)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pin\ the\ node}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ SolidNode*\ nod\_pt=Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ nod\_pt-\/>pin\_position(i);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Doc\ it\ as\ pinned}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ pseudo\_solid\_bc\_file\ <<\ nod\_pt-\/>x(i)\ <<\ \textcolor{stringliteral}{"{}\ "{}};}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ pseudo\_solid\_bc\_file\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ loop\ over\ boundaries}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Close}}
\DoxyCodeLine{\ pseudo\_solid\_bc\_file.close();}

\end{DoxyCodeInclude}
 We complete the build of the elements by specifying the Reynolds number and the constitutive equation used in the pseudo-\/solid mesh deformation.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Complete\ the\ build\ of\ the\ fluid\ elements\ so\ they\ are\ fully\ functional}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_element\ =\ Fluid\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ from\ GeneralisedElement\ to\ the\ present\ element}}
\DoxyCodeLine{\ \ \ FLUID\_ELEMENT*\ el\_pt\ =\ }
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{dynamic\_cast<}FLUID\_ELEMENT*\textcolor{keyword}{>}(Fluid\_mesh\_pt-\/>element\_pt(e));}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ Reynolds\ number}}
\DoxyCodeLine{\ \ \ el\_pt-\/>re\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Parameters_a9d72e94a9305c6a310940a6a427ebe06}{Global\_Parameters::Re}};}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ constitutive\ law\ for\ pseudo-\/elastic\ mesh\ deformation}}
\DoxyCodeLine{\ \ \ el\_pt-\/>constitutive\_law\_pt()\ =}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespaceGlobal__Parameters_adbd1f040f375c96fe56b3f475f7dbec2}{Global\_Parameters::Constitutive\_law\_pt}};}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ loop\ over\ elements}}

\end{DoxyCodeInclude}
 Finally, we impose a Poiseuille profile at the inflow boundary (boundary 1) and assign the equation numbers.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Apply\ fluid\ boundary\ conditions:\ Poiseuille\ at\ inflow}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Find\ max.\ and\ min\ y-\/coordinate\ at\ inflow}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ibound=1;}
\DoxyCodeLine{\ \textcolor{comment}{//Initialise\ both\ to\ the\ y-\/coordinate\ of\ the\ first\ boundary\ node}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ y\_min=fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,0)-\/>x(1);;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ y\_max=y\_min;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Loop\ over\ the\ rest\ of\ the\ boundary\ nodes}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ num\_nod=\ fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=1;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ y=fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>x(1);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (y>y\_max)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ y\_max=y;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (y<y\_min)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ y\_min=y;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ y\_mid=0.5*(y\_min+y\_max);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ all\ boundaries}}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ n\_boundary\ =\ fluid\_mesh\_pt()-\/>nboundary();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ ibound=0;ibound<n\_boundary;ibound++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ num\_nod=\ fluid\_mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Parabolic\ inflow\ at\ the\ left\ boundary\ (boundary\ 1)}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (ibound==1)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ y=fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>x(1);}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ veloc=1.5/(y\_max-\/y\_min)*}
\DoxyCodeLine{\ \ \ \ \ \ \ \ (y-\/y\_min)*(y\_max-\/y)/((y\_mid-\/y\_min)*(y\_max-\/y\_mid));}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(0,veloc);}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(1,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Zero\ flow\ elsewhere\ }}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(0,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(1,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ Poiseuille}}

\end{DoxyCodeInclude}


Next, we create the solid mesh, using the files created by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }}; see the discussion in the corresponding \href{../../../solid/unstructured_solid/html/index.html\#mesh}{\texttt{ single-\/physics solids problem.}}


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Solid\ mesh}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Create\ solid\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ solid\_node\_file\_name=\textcolor{stringliteral}{"{}solid.fig.1.node"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ solid\_element\_file\_name=\textcolor{stringliteral}{"{}solid.fig.1.ele"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ solid\_poly\_file\_name=\textcolor{stringliteral}{"{}solid.fig.1.poly"{}};\ }
\DoxyCodeLine{\ Solid\_mesh\_pt\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMySolidTriangleMesh}{MySolidTriangleMesh<SOLID\_ELEMENT>}}(solid\_node\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solid\_element\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ solid\_poly\_file\_name);}

\end{DoxyCodeInclude}
 We complete the build of the solid elements by passing the pointer to the constitutive equation and the function pointer to the gravitational body force.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Complete\ the\ build\ of\ all\ solid\ elements\ so\ they\ are\ fully\ functional}}
\DoxyCodeLine{\ n\_element\ =\ Solid\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ i=0;i<n\_element;i++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Cast\ to\ a\ solid\ element}}
\DoxyCodeLine{\ \ \ SOLID\_ELEMENT\ *el\_pt\ =\ }
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{dynamic\_cast<}SOLID\_ELEMENT*\textcolor{keyword}{>}(Solid\_mesh\_pt-\/>element\_pt(i));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ constitutive\ law}}
\DoxyCodeLine{\ \ \ el\_pt-\/>constitutive\_law\_pt()\ =}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespaceGlobal__Parameters_adbd1f040f375c96fe56b3f475f7dbec2}{Global\_Parameters::Constitutive\_law\_pt}};}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ body\ force}}
\DoxyCodeLine{\ \ \ el\_pt-\/>body\_force\_fct\_pt()\ =\ \mbox{\hyperlink{namespaceGlobal__Parameters_a200109847bf4cc26da4d00e8d68d569e}{Global\_Parameters::gravity}};}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 We suppress the displacements of the nodes on boundary 1.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ both\ positions\ at\ lower\ boundary\ of\ solid\ mesh\ (boundary\ 1)}}
\DoxyCodeLine{\ ibound=1;}
\DoxyCodeLine{\ num\_nod=Solid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \{\ \ \ \ }
\DoxyCodeLine{\ \ \ Solid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin\_position(0);}
\DoxyCodeLine{\ \ \ Solid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin\_position(1);}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}


Next, we create the {\ttfamily Face\+Elements} that apply the fluid traction to the solid


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Create\ FSI\ Traction\ elements}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Now\ construct\ the\ (empty)\ traction\ element\ mesh}}
\DoxyCodeLine{\ Traction\_mesh\_pt=\textcolor{keyword}{new}\ SolidMesh;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{comment}{//\ Build\ the\ FSI\ traction\ elements\ and\ add\ them\ to\ the\ traction\ mesh}}
\DoxyCodeLine{\ create\_fsi\_traction\_elements();}

\end{DoxyCodeInclude}
 and the {\ttfamily Face\+Elements} that use Lagrange multipliers to deform the fluid mesh to keep it aligned with the FSI boundary.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Create\ Lagrange\ multiplier\ mesh\ for\ boundary\ motion}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Construct\ the\ mesh\ of\ elements\ that\ enforce\ prescribed\ boundary\ motion}}
\DoxyCodeLine{\ \textcolor{comment}{//\ of\ pseudo-\/solid\ fluid\ mesh\ by\ Lagrange\ multipliers}}
\DoxyCodeLine{\ Lagrange\_multiplier\_mesh\_pt=\textcolor{keyword}{new}\ SolidMesh;}
\DoxyCodeLine{\ create\_lagrange\_multiplier\_elements();}

\end{DoxyCodeInclude}
 We combine the various sub-\/meshes into a global mesh.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Combine\ meshes}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Add\ sub\ meshes}}
\DoxyCodeLine{\ add\_sub\_mesh(Fluid\_mesh\_pt);}
\DoxyCodeLine{\ add\_sub\_mesh(Solid\_mesh\_pt);}
\DoxyCodeLine{\ add\_sub\_mesh(Traction\_mesh\_pt);}
\DoxyCodeLine{\ add\_sub\_mesh(Lagrange\_multiplier\_mesh\_pt);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ global\ mesh}}
\DoxyCodeLine{\ build\_global\_mesh();}

\end{DoxyCodeInclude}
 Finally, we set up the fluid-\/structure interaction by determining which "{}bulk"{} fluid elements are located next to the FSI traction elements that apply the fluid load to the solid. We document the boundary coordinate along the FSI interface by opening the {\ttfamily Multi\+\_\+domain\+\_\+functions\+::\+Doc\+\_\+boundary\+\_\+coordinate\+\_\+file} stream before calling {\ttfamily FSI\+\_\+functions\+::setup\+\_\+fluid\+\_\+load\+\_\+info\+\_\+for\+\_\+solid\+\_\+elements(...)} If this stream is open, the setup routine writes the Eulerian coordinates of the points on the FSI interface and their intrinsic surface coordinate $ [ x, y, \zeta ] $ to the specified file.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ FSI}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Document\ the\ boundary\ coordinate\ \ along\ the\ FSI\ interface\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ of\ the\ fluid\ mesh\ during\ call\ to}}
\DoxyCodeLine{\ \textcolor{comment}{//\ setup\_fluid\_load\_info\_for\_solid\_elements()}}
\DoxyCodeLine{\ Multi\_domain\_functions::Doc\_boundary\_coordinate\_file.open(}
\DoxyCodeLine{\ \ \textcolor{stringliteral}{"{}fluid\_boundary\_test.dat"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Work\ out\ which\ fluid\ dofs\ affect\ the\ residuals\ of\ the\ wall\ elements:}}
\DoxyCodeLine{\ \textcolor{comment}{//\ We\ pass\ the\ boundary\ between\ the\ fluid\ and\ solid\ meshes\ and\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ pointers\ to\ the\ meshes.\ The\ interaction\ boundary\ is\ boundary\ 3}}
\DoxyCodeLine{\ \textcolor{comment}{//\ of\ the\ 2D\ fluid\ mesh.}}
\DoxyCodeLine{\ FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<FLUID\_ELEMENT,2>}
\DoxyCodeLine{\ \ (\textcolor{keyword}{this},3,Fluid\_mesh\_pt,Traction\_mesh\_pt);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Close\ the\ doc\ file}}
\DoxyCodeLine{\ Multi\_domain\_functions::Doc\_boundary\_coordinate\_file.close();}

\end{DoxyCodeInclude}
 We use the private helper function {\ttfamily doc\+\_\+solid\+\_\+boundary\+\_\+coordinates()} to create the same output from the "{}solid side"{} of the FSI interface. This is useful for debugging purposes because it allows us to check whether the fluid and solid meshes employ a matching parametrisation of the FSI interface; see \doxysectlink{index_go_wrong}{What can go wrong?}{2} for more details.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Sanity\ check:\ Doc\ boundary\ coordinates\ from\ solid\ side}}
\DoxyCodeLine{\ doc\_solid\_boundary\_coordinates();}

\end{DoxyCodeInclude}
 All that\textquotesingle{}s left to do is to set up the equation numbering scheme and the problem is ready to be solved.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ equation\ numbering\ scheme}}
\DoxyCodeLine{\ cout\ <<\textcolor{stringliteral}{"{}Number\ of\ equations:\ "{}}\ <<\ assign\_eqn\_numbers()\ <<\ std::endl;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_constructor}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_fsi_traction}{}\doxysection{\texorpdfstring{Creating the FSI traction elements}{Creating the FSI traction elements}}\label{index_fsi_traction}
The creation of the FSI traction elements adjacent to the solid boundary 2 follows the usual procedure. We loop over the relevant 2D "{}bulk"{} solid elements and attach the {\ttfamily FSISolid\+Traction\+Elements} to the appropriate faces.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//============start\_of\_create\_traction\_elements==========================}}
\DoxyCodeLine{\textcolor{comment}{///\ Create\ FSI\ traction\ elements\ }}
\DoxyCodeLine{\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ FLUID\_ELEMENT,\textcolor{keyword}{class}\ SOLID\_ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a934a587c99668fca969a72814b3142a7}{UnstructuredFSIProblem<FLUID\_ELEMENT,SOLID\_ELEMENT>::}}}
\DoxyCodeLine{\mbox{\hyperlink{classUnstructuredFSIProblem_a934a587c99668fca969a72814b3142a7}{create\_fsi\_traction\_elements}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Traction\ elements\ are\ located\ on\ boundary\ 2\ of\ solid\ bulk\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ b=2;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ How\ many\ bulk\ elements\ are\ adjacent\ to\ boundary\ b?}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_element\ =\ solid\_mesh\_pt()-\/>nboundary\_element(b);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ the\ bulk\ elements\ adjacent\ to\ boundary\ b}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Get\ pointer\ to\ the\ bulk\ element\ that\ is\ adjacent\ to\ boundary\ b}}
\DoxyCodeLine{\ \ \ SOLID\_ELEMENT*\ bulk\_elem\_pt\ =\ \textcolor{keyword}{dynamic\_cast<}SOLID\_ELEMENT*\textcolor{keyword}{>}(}
\DoxyCodeLine{\ \ \ \ solid\_mesh\_pt()-\/>boundary\_element\_pt(b,e));}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//What\ is\ the\ index\ of\ the\ face\ of\ the\ element\ e\ along\ boundary\ b}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{int}\ face\_index\ =\ solid\_mesh\_pt()-\/>face\_index\_at\_boundary(b,e);}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Create\ new\ element\ }}
\DoxyCodeLine{\ \ \ FSISolidTractionElement<SOLID\_ELEMENT,2>*\ el\_pt=}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{new}\ FSISolidTractionElement<SOLID\_ELEMENT,2>(bulk\_elem\_pt,face\_index);}

\end{DoxyCodeInclude}
 Next we add the newly-\/created {\ttfamily Face\+Element} to the mesh of traction elements, specify which boundary of the bulk mesh it is attached to, and pass the FSI interaction parameter $ Q $ to the element.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Add\ it\ to\ the\ mesh}}
\DoxyCodeLine{\ \ \ Traction\_mesh\_pt-\/>add\_element\_pt(el\_pt);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Specify\ boundary\ number}}
\DoxyCodeLine{\ \ \ el\_pt-\/>set\_boundary\_number\_in\_bulk\_mesh(b);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Function\ that\ specifies\ the\ load\ ratios}}
\DoxyCodeLine{\ \ \ el\_pt-\/>q\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Parameters_a7814fddf663e56168174a42d2cd6b4c1}{Global\_Parameters::Q}};\ }
\DoxyCodeLine{\ \ \}\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \}\ \textcolor{comment}{//\ end\ of\ create\_traction\_elements}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_create_lagr}{}\doxysection{\texorpdfstring{Creating the Lagrange multiplier elements}{Creating the Lagrange multiplier elements}}\label{index_create_lagr}
The creation of the {\ttfamily Face\+Elements} that use Lagrange multipliers to impose the boundary displacement of the pseudo-\/solid fluid mesh is again fairly straightforward (the use of Lagrange multipliers for the imposition of boundary displacements is explained in \href{../../../solid/prescribed_displ_lagr_mult/html/index.html}{\texttt{ another tutorial}}). We start by combining the {\ttfamily FSISolid\+Traction\+Elements} attached to the solid\textquotesingle{}s FSI boundary to form a compound {\ttfamily Geom\+Object}. This {\ttfamily Geom\+Object} provides a continuous representation of the FSI boundary (as determined by the deformation of the solid) and is parametrised by the boundary coordinate assigned earlier. This continuous representation will define the desired position of the boundary as enforced by the Lagrange multiplier elements.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//============start\_of\_create\_lagrange\_multiplier\_elements===============}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Create\ elements\ that\ impose\ the\ prescribed\ boundary\ displacement}}
\DoxyCodeLine{\textcolor{comment}{///\ for\ the\ pseudo-\/solid\ fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ FLUID\_ELEMENT,\ \textcolor{keyword}{class}\ SOLID\_ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a6f810c300f373cfc79e23d58f95944e3}{UnstructuredFSIProblem<FLUID\_ELEMENT,SOLID\_ELEMENT>::}}}
\DoxyCodeLine{\mbox{\hyperlink{classUnstructuredFSIProblem_a6f810c300f373cfc79e23d58f95944e3}{create\_lagrange\_multiplier\_elements}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Create\ \ GeomObject\ incarnation\ of\ fsi\ boundary\ in\ solid\ mesh}}
\DoxyCodeLine{\ Solid\_fsi\_boundary\_pt=}
\DoxyCodeLine{\ \ \textcolor{keyword}{new}\ MeshAsGeomObject}
\DoxyCodeLine{\ \ (Traction\_mesh\_pt);}

\end{DoxyCodeInclude}
 Now we attach {\ttfamily Impose\+Displacement\+By\+Lagrange\+Multiplier\+Elements} to the appropriate faces of the "{}bulk"{} fluid elements that are adjacent to the FSI interface (boundary 3 in the fluid mesh).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Lagrange\ multiplier\ elements\ are\ located\ on\ boundary\ 3\ of\ the\ fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ b=3;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ How\ many\ bulk\ fluid\ elements\ are\ adjacent\ to\ boundary\ b?}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_element\ =\ Fluid\_mesh\_pt-\/>nboundary\_element(b);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ the\ bulk\ fluid\ elements\ adjacent\ to\ boundary\ b?}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Get\ pointer\ to\ the\ bulk\ fluid\ element\ that\ is\ adjacent\ to\ boundary\ b}}
\DoxyCodeLine{\ \ \ FLUID\_ELEMENT*\ bulk\_elem\_pt\ =\ \textcolor{keyword}{dynamic\_cast<}FLUID\_ELEMENT*\textcolor{keyword}{>}(}
\DoxyCodeLine{\ \ \ \ Fluid\_mesh\_pt-\/>boundary\_element\_pt(b,e));}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Find\ the\ index\ of\ the\ face\ of\ element\ e\ along\ boundary\ b}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{int}\ face\_index\ =\ Fluid\_mesh\_pt-\/>face\_index\_at\_boundary(b,e);}
\DoxyCodeLine{\ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Create\ new\ element}}
\DoxyCodeLine{\ \ \ ImposeDisplacementByLagrangeMultiplierElement<FLUID\_ELEMENT>*\ el\_pt\ =}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{new}\ ImposeDisplacementByLagrangeMultiplierElement<FLUID\_ELEMENT>(}
\DoxyCodeLine{\ \ \ \ \ bulk\_elem\_pt,face\_index);\ \ \ }
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Add\ it\ to\ the\ mesh}}
\DoxyCodeLine{\ \ \ Lagrange\_multiplier\_mesh\_pt-\/>add\_element\_pt(el\_pt);}

\end{DoxyCodeInclude}
 Next we pass a pointer to the compound {\ttfamily Geom\+Object} that defines the desired shape of the FSI interface and specify which boundary in the "{}bulk"{} fluid mesh the element is attached to.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ GeomObject\ that\ defines\ the\ boundary\ shape\ and\ set}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ which\ bulk\ boundary\ we\ are\ attached\ to\ (needed\ to\ extract}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ the\ boundary\ coordinate\ from\ the\ bulk\ nodes)}}
\DoxyCodeLine{\ \ \ el\_pt-\/>set\_boundary\_shape\_geom\_object\_pt(Solid\_fsi\_boundary\_pt,b);}

\end{DoxyCodeInclude}
 Finally, we apply boundary conditions for the Lagrange multipliers\+: we pin the Lagrange multipliers for nodes that are located on boundary 0 where the nodal displacements are pinned. (\href{../../../solid/prescribed_displ_lagr_mult/html/index.html}{\texttt{ Recall}} that the Lagrange multipliers are additional degrees of freedom added to the "{}bulk"{} degrees of freedom originally created by the "{}bulk"{} element.)


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Loop\ over\ the\ nodes\ to\ apply\ boundary\ conditions}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ nnod=el\_pt-\/>nnode();}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ j=0;j<nnod;j++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ Node*\ nod\_pt\ =\ el\_pt-\/>node\_pt(j);}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Is\ the\ node\ also\ on\ boundary\ 0?\ }}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (nod\_pt-\/>is\_on\_boundary(0))}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ nodal\ values\ were\ used\ by\ the\ "{}bulk"{}\ element}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ that\ originally\ created\ this\ node?}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ n\_bulk\_value=el\_pt-\/>nbulk\_value(j);}
\DoxyCodeLine{\ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ remaining\ ones\ are\ Lagrange\ multipliers\ and\ we\ pin\ them.}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ nval=nod\_pt-\/>nvalue();}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ j=n\_bulk\_value;j<nval;j++)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ nod\_pt-\/>pin(j);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\ of\ create\_lagrange\_multiplier\_elements}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_doc_solution}{}\doxysection{\texorpdfstring{Post-\/processing}{Post-processing}}\label{index_doc_solution}
The post-\/processing routine simply executes the output functions for the fluid and solid meshes and writes the results into separate files.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_doc\_solution=================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ FLUID\_ELEMENT,\ \textcolor{keyword}{class}\ SOLID\_ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFSIProblem_a15f581318b505de07f50bd570da8c8d0}{UnstructuredFSIProblem<FLUID\_ELEMENT,SOLID\_ELEMENT>::}}}
\DoxyCodeLine{\mbox{\hyperlink{classUnstructuredFSIProblem_a15f581318b505de07f50bd570da8c8d0}{doc\_solution}}(DocInfo\&\ doc\_info)}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ ofstream\ some\_file;}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ filename[100];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ plot\ points}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ npts;}
\DoxyCodeLine{\ npts=5;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ fluid\ solution\ }}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/fluid\_soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ Fluid\_mesh\_pt-\/>output(some\_file,npts);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ solid\ solution\ }}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/solid\_soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ Solid\_mesh\_pt-\/>output(some\_file,npts);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_doc\_solution}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_doc_solid_zeta}{}\doxysection{\texorpdfstring{Sanity check\+: Documenting the solid boundary coordinates}{Sanity check: Documenting the solid boundary coordinates}}\label{index_doc_solid_zeta}
The function {\ttfamily doc\+\_\+solid\+\_\+boundary\+\_\+conditions()} documents the parametrisation of the solid\textquotesingle{}s FSI boundary in the file {\ttfamily solid\+\_\+boundary\+\_\+test.\+dat}. The file contains the solid\textquotesingle{}s counterpart of the $ [ x, y, \zeta ] $ data that we created for the fluid side of the FSI interface when setting up the fluid-\/structure interaction with {\ttfamily FSI\+\_\+functions\+::setup\+\_\+fluid\+\_\+load\+\_\+info\+\_\+for\+\_\+solid\+\_\+elements(...)}. The two parametrisations should be consistent; see \doxysectlink{index_go_wrong}{What can go wrong?}{2} for more details.

The function also writes the file {\ttfamily fsi\+\_\+geom\+\_\+object.\+dat}, which may be used to check the integrity of the compound {\ttfamily Geom\+Object} ~\newline
 that represents the FSI interface of the solid\+: As $ \zeta $ sweeps along the range used to parametrise the boundary, the position vector $ {\bf R}(\zeta) $, returned by {\ttfamily Geom\+Object\+::position(...)} should follow the FSI interface.

The implementation of the function is reasonably straightforward so we omit its listing here, see the \href{../../../../demo_drivers/interaction/unstructured_fsi/unstructured_two_d_fsi.cc}{\texttt{ source code}} for details.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_comm_ex}{}\doxysection{\texorpdfstring{Comments and Exercises}{Comments and Exercises}}\label{index_comm_ex}
\hypertarget{index_boundary_coord}{}\doxysubsection{\texorpdfstring{How the boundary coordinates are generated}{How the boundary coordinates are generated}}\label{index_boundary_coord}
The use of pseudo-\/elasticity for the node update in the fluid mesh makes the solution of FSI problems extremely straightforward. They key ingredient that allows the "{}automatic"{} coupling between the unstructured fluid and solid meshes ~\newline
 is the (consistent!) generation of the boundary coordinate $ \zeta $ along the FSI interface. The function {\ttfamily Triangle\+Mesh\+::setup\+\_\+boundary\+\_\+coordinates(...)} achieves this automatically and exploits the facts that
\begin{DoxyEnumerate}
\item Meshes generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} are bounded by polygonal line segments.
\item Vertices in the polygonal domain boundary coincide with vertex nodes of the triangular finite elements.
\end{DoxyEnumerate}The assignment of the boundary coordinate along mesh boundary {\ttfamily b} is performed as follows\+:
\begin{DoxyEnumerate}
\item Attach {\ttfamily Face\+Elements} to the relevant faces of the "{}bulk"{} elements that are adjacent to mesh boundary {\ttfamily b}.
\item Establish the connectivity of the {\ttfamily Face\+Elements} using the fact that they share common {\ttfamily Nodes} and sort the elements into "{}connectivity"{} order around the boundary.
\item Locate the "{}lowest left"{} boundary node on the boundary and set its boundary coordinate to zero.
\item Step through the {\ttfamily Face\+Elements} (and their nodes) in order (taking into account that some {\ttfamily Face\+Elements} may be reversed relative to each other) and use the distance between adjacent nodes as the increment in the boundary coordinate.
\item Delete the {\ttfamily Face\+Elements}.
\end{DoxyEnumerate}This procedure generates a consistent boundary parametrisation, irrespective of how many fluid and solid elements meet at the shared FSI boundary. This is because the nodes along all {\ttfamily Face\+Elements} are located along the same straight line segments. The method would not work if the boundary was curvilinear!

The method also fails, if the "{}lower left"{} boundary nodes identified in the two meshes are not located at the same position. This tends to happen if boundary nodes are assigned inconsistently, e.\+g. because the final node on the FSI interface was identified as being located on the appropriate mesh boundary in the fluid mesh but not in the solid mesh. In that case the boundary coordinates of the two meshes are offset relatively to each other by an amount equal to the distance between the respective "{}lower left"{} nodes.

Here is a plot of the boundary coordinate $ \zeta $ generated from the fluid (blue) and solid (red) sides, with $ \zeta $ being plotted "{}on top"{} of the unstructured solid mesh.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{boundary_coordinate_check}
\doxyfigcaption{Plot of the boundary coordinates generated from the fluid and solid sides of the FSI interface. }
\end{DoxyImage}


\DoxyHorRuler{0}
\hypertarget{index_non_matching}{}\doxysubsection{\texorpdfstring{Fluid and solid meshes do not have to be matching}{Fluid and solid meshes do not have to be matching}}\label{index_non_matching}
To demonstrate that the fluid and solid meshes to not have to be matching across the FSI interface, here are the results of another computation in which a much finer fluid mesh was used.

This computation was performed by re-\/generating the mesh, running triangle with a smaller maximum element size\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{triangle\ -\/q\ -\/a0.01\ fluid.fig.poly}

\end{DoxyCode}


The driver code remained completely unchanged.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{flow_fine}
\doxyfigcaption{Animation of the flow field (streamlines and pressure contours) and the deformation, computed on a refined fluid mesh. }
\end{DoxyImage}


\DoxyHorRuler{0}
\hypertarget{index_b_f}{}\doxysubsection{\texorpdfstring{Gravity only affects the solid – really?}{Gravity only affects the solid – really?}}\label{index_b_f}
The computations presented above suffer from a rather embarrassing modelling error. We have implicitly assumed that the solid is deformed significantly by gravity whereas no body force acts in the fluid. This is extremely unlikely to be right but makes for a useful exercise.
\begin{DoxyEnumerate}
\item Formulate the problem properly, starting from the dimensional form of the governing equations, to determine the correct non-\/dimensional body forces for the fluid and the solid. ~\newline
~\newline

\item Use your analysis to explain under what circumstances our "{}error"{} could actually be a justifiable approximation to the real system.
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{index_go_wrong}{}\doxysubsection{\texorpdfstring{What can go wrong?}{What can go wrong?}}\label{index_go_wrong}
As indicated above, the methodology employed in this tutorial makes the formulation of 2D FSI problems extremely straightforward. The most difficult part of the entire procedure is identifying the appropriate boundaries in the mesh generated by third-\/party software. Here are a few things that can (and often do) go wrong, which result in the code being unable to set up consistent boundary coordinates.
\begin{DoxyItemize}
\item {\bfseries{ Boundaries don\textquotesingle{}t match in xfig\+:}} ~\newline
~\newline
 When drawing the boundaries of the fluid and solid domains in \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}, it is important to ensure that the FSI boundary is the same. A simple way to achieve this is to draw the fluid domain first and then make a copy of the resulting \texorpdfstring{$\ast$}{*}.fig file. Once the file has been renamed it can be loaded into \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}} and the polygonal vertices that are not part of the FSI interface can be deleted, while new vertices that are only part of the solid boundary can then be added. Just make sure that you don\textquotesingle{}t move any of the vertices that define the FSI interface! ~\newline
~\newline

\item {\bfseries{ The mesh is too coarse for the automatic generation of boundary-\/lookup schemes\+:}} ~\newline
~\newline
 \begin{center} \tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{1}{|X[-1]}|}
\hline
{\bfseries{Note\+:}} We believe that the problem described here has now been fixed. However, it is possible/likely that there are particularly pathological meshes in which the scheme fails. If you encounter any such problems, please \href{../../../contact/html/index.html}{\texttt{ let us know. }}   \\\cline{1-1}
\end{longtabu}
\end{center}  ~\newline
~\newline
 Another problem arises if the mesh generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} is too coarse for the automatic identification of mesh boundaries by {\ttfamily Triangle\+Mesh\+Base\+::setup\+\_\+boundary\+\_\+element\+\_\+info()}. This function gets (justifiably) confused when the mesh is so coarse that both vertex nodes on an element edge that crosses the interior of the domain are located on the same mesh boundary. We do not intend to fix this problem -- if your mesh is that coarse, you should refine it! Anyway, if it happens, the problem may be diagnosed by plotting the output written to {\ttfamily Multi\+\_\+domain\+\_\+functions\+::\+Doc\+\_\+boundary\+\_\+coordinate\+\_\+file} if this stream is open when {\ttfamily FSI\+\_\+functions\+::setup\+\_\+fluid\+\_\+load\+\_\+info\+\_\+for\+\_\+solid\+\_\+elements(...)} is called. The file ({\ttfamily fluid\+\_\+boundary\+\_\+test.\+dat} in our driver code) contains the {\ttfamily Face\+Elements} that are attached to the (perceived) FSI boundary in the fluid mesh. (The file {\ttfamily solid\+\_\+boundary\+\_\+test.\+dat}, generated manually in our driver code, contains the same information for the solid mesh.) ~\newline
~\newline
 Here is what the plot should look like if the fluid mesh is sufficiently fine (the {\ttfamily Face\+Elements} are shown as thick red lines on top of the "{}bulk"{} fluid mesh)\+: ~\newline
~\newline
 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{boundary_generation_test}
\doxyfigcaption{Correct FSI boundary. }
\end{DoxyImage}
 ~\newline
 In the next figure, the fluid mesh is too coarse and the boundary detection has failed spectacularly\+: ~\newline
~\newline
 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{boundary_generation_test_too_coarse}
\doxyfigcaption{Wrongly identified FSI boundary on a (too) coarse fluid mesh. }
\end{DoxyImage}
 ~\newline
~\newline

\item {\bfseries{ The boundary coordinates on the fluid and solid side of the FSI interface don\textquotesingle{}t match\+:}} ~\newline
~\newline
 We have already alluded to this problem when discussing \doxysectlink{index_boundary_coord}{How the boundary coordinates are generated}{2}. The problem arises mainly (only?) when nodes at the "{}end"{} of the FSI interface are only added to the FSI boundary in one of the meshes but not the other. For this reason, we strongly recommend printing out the mesh boundaries and checking them carefully before proceeding. Here is a plot of the mesh boundaries for the current problem\+: ~\newline
~\newline
 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{boundaries}
\doxyfigcaption{Boundary nodes in the fluid (triangle) and solid (square) meshes. }
\end{DoxyImage}
 ~\newline

\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/interaction/unstructured_fsi}{\texttt{ demo\+\_\+drivers/interaction/unstructured\+\_\+fsi }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/interaction/unstructured_fsi/unstructured_two_d_fsi.cc}{\texttt{ demo\+\_\+drivers/interaction/unstructured\+\_\+fsi/unstructured\+\_\+two\+\_\+d\+\_\+fsi.\+cc }} \end{center} 
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
