\chapter{Demo problem\+: Flow in a 2D channel with an elastic leaflet}
\hypertarget{index}{}\label{index}\index{Demo problem: Flow in a 2D channel with an elastic leaflet@{Demo problem: Flow in a 2D channel with an elastic leaflet}}
In this example we consider the flow in a 2D channel which is partially obstructed by an elastic leaflet -- the FSI generalisation of the \href{../../../navier_stokes/channel_with_leaflet/html/index.html}{\texttt{ Navier-\/\+Stokes problem in which the motion of the leaflet is prescribed.}} A particular feature of this problem is that the leaflet (modelled as a thin-\/walled beam structure) is totally immersed in the fluid and is therefore exposed to the fluid traction from both sides.

The problem presented here was used as one of the test cases for {\ttfamily oomph-\/lib\textquotesingle{}s} FSI preconditioner; see ~\newline
~\newline
 \begin{center} \href{http://www.maths.man.ac.uk/~mheil/oomph_lib_additional_material/HeilHazelBoyleCompMech/HeilHazelBoyleCompMech.pdf}{\texttt{ Heil, M., Hazel, A.\+L. \& Boyle, J. (2008)\+: Solvers for large-\/displacement fluid-\/structure interaction problems\+: Segregated vs. monolithic approaches. Computational Mechanics.}} \end{center} 

In this tutorial we concentrate on the problem formulation. The application of the preconditioner is discussed \href{../../../preconditioners/fsi/html/index.html}{\texttt{ elsewhere}} -- the required source code is contained in the \href{../../../../demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc}{\texttt{ driver code.}}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_the_problem}{}\doxysection{\texorpdfstring{The Problem}{The Problem}}\label{index_the_problem}
The figure below shows a sketch of the problem\+: A 2D channel of height $ H^*_{tot}$ and length $ L^*_{left} + L^*_{right} $ is partially occluded by a thin-\/walled elastic leaflet of height $ H^*_{leaflet} $. (As usual, we use asterisks to distinguish dimensional quantities from their non-\/dimensional equivalents to be introduced later.) We assume that the leaflet is sufficiently thin so that, as far as the boundary conditions for the fluid are concerned, the leaflet can be assumed to be infinitely thin. This allows us to parametrise its shape by a single Lagrangian coordinate $ \xi^* $. Hence we write the position vector to a material point on the leaflet as $ {\bf R}^*_w(\xi^*,t^*) $. A pulsatile Poiseuille flow whose mean velocity fluctuates between $ U^* $ and $ 2 U^* $ is imposed at the upstream end of the channel. The outflow is assumed to be parallel and axially traction-\/free.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{fsi_channel_with_leaflet_dim}
\doxyfigcaption{Sketch of the problem. }
\end{DoxyImage}


We non-\/dimensionalise all length and coordinates on the channel width, $ H^*_{tot} $ , time on the natural timescale of the flow, $ H^*_{tot}/U^* $, the velocities on the (minimum) mean velocity, ~\newline
 $ U^* $, and the pressure on the viscous scale.

The fluid flow is then governed by the non-\/dimensional Navier-\/\+Stokes equations  \[
Re \left( St \frac{\partial u_i}{\partial t} + 
u_j \frac{\partial u_i}{\partial x_j} \right) =
- \frac{\partial p}{\partial x_i}  +
\frac{\partial }{\partial x_j} \left[ \left(
\frac{\partial u_i}{\partial x_j} +  
\frac{\partial u_j}{\partial x_i} \right) \right],
\] where $ Re = \rho U^* H_0^* / \mu $ and $ St = 1 $, and \begin{center}  \[
\frac{\partial u_i}{\partial x_i} = 0,
\] \end{center}  subject to a time-\/periodic, parabolic inflow with non-\/dimensional period $ T $, \begin{center}  \[
{\bf u} = 6 x_2 (1-x_2) \left( 1 + \frac{1}{2} (1-\cos(2 \pi t/T)) \right) 
{\bf e}_1
\] \end{center}  in the inflow cross-\/section; parallel, axially-\/traction-\/free outflow at the outlet; and no-\/slip on the stationary channel walls, $ {\bf u} = {\bf 0} $. The no-\/slip condition on the leaflet is \begin{center}  \[
{\bf u} = \frac{\partial {\bf R}_w(\xi,t)}{\partial t}.
\] \end{center} 

We model the leaflet as a thin-\/walled, massless, elastic Kirchhoff-\/\+Love beam of wall thickness $ h^* $. The beam\textquotesingle{}s effective (1D) elastic modulus is given by $ E_{eff} = E/(1-\nu^2), $ where $ E $ and $ \nu $ are its 3D Young\textquotesingle{}s modulus and Poisson\textquotesingle{}s ratio, respectively. The beam\textquotesingle{}s deformation is governed by the principle of virtual displacements, discussed in detail \href{../../../beam/tensioned_string/html/index.html}{\texttt{ in another tutorial.}} As in the Navier-\/\+Stokes equations, we scale all lengths in the beam problem on the channel\textquotesingle{}s width, $ H^*_{tot}. $ The non-\/dimensional position vector $ {\bf r}_w(\xi) $ to the undeformed wall is then given by  \[
{\bf r}_w(\xi) = 
{\bf R}_w(\xi,t=0) = 
\left(
\begin{array}{c}
X_0  \\
\xi
\end{array}
\right) \ \ \ \ \ \ \mbox{where $\xi \in [0,H_{leaflet}].$}
\] Our non-\/dimensionalisation of the principle of virtual displacements requires all stresses and tractions to be non-\/dimensionalised on the beam\textquotesingle{}s (effective 1D) elastic modulus, $ E_{eff} $. The non-\/dimensional load vector $ {\bf f} = {\bf f}^{*}/E_{eff} $ that acts on the leaflet (combining the fluid tractions acting on its front and back faces) is then given by  \[
f_i = Q \bigg\{ 
\left( p\big|_{front} \ N_i^{[front]} -
\left(
\frac{\partial u_i}{\partial x_j} +
\frac{\partial u_j}{\partial x_i} 
\right)\bigg|_{front} N_j^{[front]} \right)
+
\]  \[
. \hspace{3cm} + \left( p\big|_{back} \ N_i^{[back]} -
\left(
\frac{\partial u_i}{\partial x_j} +
\frac{\partial u_j}{\partial x_i} 
\right)\bigg|_{back} N_j^{[back]} \right) 
\bigg\}
\ \ \ \ \ \ \mbox{for $i=1,2,$}
\] where  \[
Q = \frac{\mu U}{E_{eff} H_{tot}^*}
\] is the ratio of the fluid pressure scale, $ \mu U/H_{tot}^* $ , used to non-\/dimensionalise the Navier-\/\+Stokes equations, to the beam\textquotesingle{}s effective elastic modulus, $ E_{eff} $. The parameter $ Q
$ therefore indicates the strength of the fluid-\/structure interaction. In particular, if $ Q=0 $ the leaflet does not "{}feel"{} the fluid traction. $ {\bf N}_{front} $ and $ {\bf N}_{back} $ are the outer unit normals on the "{}front"{} and "{}back"{} faces of the deformed leaflet, as shown in this sketch of the non-\/dimensional version of the problem\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{fsi_channel_with_leaflet}
\doxyfigcaption{Sketch of the problem in dimensionless variables. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_results}{}\doxysection{\texorpdfstring{Results}{Results}}\label{index_results}
The figure below shows (a) a snapshot of the flow field ~\newline
 (pressure contours and instantaneous streamlines) and (b) the time-\/trace of the horizontal position of the leaflet\textquotesingle{}s tip for a Reynolds number of $ Re = 200 $, a non-\/dimensional period of $ T=2 $, and an interaction parameter of $ Q = 10^{-6}
$. Following the decay of initial transients the leaflet performs periodic large-\/amplitude oscillations with the period of the pulsating inflow. Large velocity gradients develop at the front of the leaflet and in the shear layer that emanates from its tip and separates the recirculating flow region behind the leaflet from the main flow. Fig. (c) illustrates the non-\/uniform mesh refinement and shows the improved resolution in the high-\/shear regions, particularly near the leaflet\textquotesingle{}s tip where the pressure is singular. The mesh was continuously adapted throughout the simulation and contained an average of about 32,000 degrees of freedom. This is a fraction of the 1,324,343 degrees of freedom that would be required to achieve the same local resolution via uniform mesh refinement.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{flow_from_paper}
\doxyfigcaption{Computational results. }
\end{DoxyImage}


The corresponding \href{../figures/fsi_channel_with_leaflet_flow.avi}{\texttt{ animation}} illustrates the algebraic node update strategy (implemented with an {\ttfamily Algebraic\+Mesh}, discussed in more detail in \href{../../fsi_collapsible_channel_algebraic/html/index.html}{\texttt{ another tutorial}}) and the evolution of the flow field. Note that the instantaneous streamlines intersect the (impermeable) leaflet because the leaflet is not stationary. The animation shows how the mesh adapts itself to changes in the flow field -- using much smaller elements in high-\/shear regions, including the artificial outflow boundary layer that is created by the imposition of parallel outflow in a region where the flow is far from fully-\/developed.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_parameters}{}\doxysection{\texorpdfstring{The global parameters}{The global parameters}}\label{index_parameters}
As usual we use a namespace to define the problem parameters\+: The Reynolds number and its product with the Strouhal number (both initialised to 50),

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//====\ start\_of\_global\_parameters================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Global\ parameters}}
\DoxyCodeLine{\textcolor{comment}{//===============================================================}}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceGlobal__Physical__Variables}{Global\_Physical\_Variables}}}
\DoxyCodeLine{\{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Reynolds\ number}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Re}}=50.0;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Womersley\ number:\ Product\ of\ Reynolds\ and\ Strouhal\ numbers}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{ReSt}}=50.0;}

\end{DoxyCodeInclude}
 the leaflet\textquotesingle{}s non-\/dimensional wall thickness, $ h = h^*/H^*_{tot}
$, and the FSI parameter,


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Non-\/dimensional\ wall\ thickness.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_af6e07423e22c0991084d9a2f43727805}{H}}=0.05;}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Fluid\ structure\ interaction\ parameter:\ Ratio\ of\ stresses\ used\ for}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ non-\/dimensionalisation\ of\ fluid\ to\ solid\ stresses.\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a66cb7ecda9ba0cd72367dd697f154545}{Q}}=1.0e-\/6;}

\end{DoxyCodeInclude}
 and the parameters that define the magnitude of the pulsating inflow.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Period\ for\ fluctuations\ in\ flux}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a2ffa220a56bff9b6b495ed47954d513f}{Period}}=2.0;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Min.\ flux}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_aa46dc81a0757e8f9707646e03c32d4fc}{Min\_flux}}=1.0;}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Max.\ flux}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_aee645139728fd3d01573b161c74e7e8a}{Max\_flux}}=2.0;}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Flux:\ Pulsatile\ flow\ fluctuating\ between\ Min\_flux\ and\ Max\_flux\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ with\ period\ Period}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ad651484fe06209606bccefe6fe23be0c}{flux}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ t)}
\DoxyCodeLine{\ \{\ \ }
\DoxyCodeLine{\ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_aa46dc81a0757e8f9707646e03c32d4fc}{Min\_flux}}+}
\DoxyCodeLine{\ \ \ (\mbox{\hyperlink{namespaceGlobal__Physical__Variables_aee645139728fd3d01573b161c74e7e8a}{Max\_flux}}-\/\mbox{\hyperlink{namespaceGlobal__Physical__Variables_aa46dc81a0757e8f9707646e03c32d4fc}{Min\_flux}})*0.5*(1.0-\/cos(2.0*MathematicalConstants::Pi*t/Period));}
\DoxyCodeLine{\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_namespace}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 ~\newline
 \DoxyHorRuler{0}
\hypertarget{index_leaflet}{}\doxysection{\texorpdfstring{The undeformed leaflet}{The undeformed leaflet}}\label{index_leaflet}
We use a {\ttfamily Geom\+Object} to describe the initial, stress-\/free shape of the elastic leaflet\+: a vertical straight line. The member function {\ttfamily d2position(...)} provides the first and second derivatives of the position vector, as required by the variational principle that governs the beam\textquotesingle{}s deformation; see \href{../../../beam/tensioned_string/html/index.html}{\texttt{ the beam theory tutorial for details. }}


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=====start\_of\_undeformed\_leaflet=================================}}
\DoxyCodeLine{\textcolor{comment}{///\ GeomObject:\ Undeformed\ straight,\ vertical\ leaflet}}
\DoxyCodeLine{\textcolor{comment}{//=================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classUndeformedLeaflet}{UndeformedLeaflet}}\ :\ \textcolor{keyword}{public}\ GeomObject}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ argument\ is\ the\ x-\/coordinate\ of\ the\ leaflet}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classUndeformedLeaflet}{UndeformedLeaflet}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x0):\ GeomObject(1,2)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classUndeformedLeaflet_aa89fc695af9e53aa38894c9d875afd36}{X0}}=x0;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Position\ vector\ at\ Lagrangian\ coordinate\ zeta\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUndeformedLeaflet_a8e9b79702eb9a38e19886b84aeb47918}{position}}(\textcolor{keyword}{const}\ Vector<double>\&\ zeta,\ Vector<double>\&\ r)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Position\ Vector}}
\DoxyCodeLine{\ \ \ r[0]\ =\ \mbox{\hyperlink{classUndeformedLeaflet_aa89fc695af9e53aa38894c9d875afd36}{X0}};}
\DoxyCodeLine{\ \ \ r[1]\ =\ zeta[0];}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Parametrised\ position\ on\ object:\ r(zeta).\ Evaluated\ at}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ previous\ timestep.\ t=0:\ current\ time;\ t>0:\ previous}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ timestep.\ Calls\ steady\ version.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUndeformedLeaflet_a8e9b79702eb9a38e19886b84aeb47918}{position}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ t,\ \textcolor{keyword}{const}\ Vector<double>\&\ zeta,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Vector<double>\&\ r)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Use\ the\ steady\ version}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classUndeformedLeaflet_a8e9b79702eb9a38e19886b84aeb47918}{position}}(zeta,r);}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ position}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Posn\ vector\ and\ its\ \ 1st\ \&\ 2nd\ derivatives}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ w.r.t.\ to\ coordinates:}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ \(\backslash\)f\$\ \(\backslash\)frac\{dR\_i\}\{d\ \(\backslash\)zeta\_\(\backslash\)alpha\}\(\backslash\)f\$\ =\ drdzeta(alpha,i).\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ \(\backslash\)f\$\ \(\backslash\)frac\{d\string^2R\_i\}\{d\ \(\backslash\)zeta\_\(\backslash\)alpha\ d\ \(\backslash\)zeta\_\(\backslash\)beta\}\(\backslash\)f\$\ =\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ ddrdzeta(alpha,beta,i).\ Evaluated\ at\ current\ time.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUndeformedLeaflet_a47d674756ce22e00a44ca0bd030a99da}{d2position}}(\textcolor{keyword}{const}\ Vector<double>\&\ zeta,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Vector<double>\&\ r,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DenseMatrix<double>\ \&drdzeta,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RankThreeTensor<double>\ \&ddrdzeta)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Position\ vector}}
\DoxyCodeLine{\ \ \ r[0]\ =\ \mbox{\hyperlink{classUndeformedLeaflet_aa89fc695af9e53aa38894c9d875afd36}{X0}};}
\DoxyCodeLine{\ \ \ r[1]\ =\ zeta[0];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Tangent\ vector}}
\DoxyCodeLine{\ \ \ drdzeta(0,0)=0.0;}
\DoxyCodeLine{\ \ \ drdzeta(0,1)=1.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Derivative\ of\ tangent\ vector}}
\DoxyCodeLine{\ \ \ ddrdzeta(0,0,0)=0.0;}
\DoxyCodeLine{\ \ \ ddrdzeta(0,0,1)=0.0;}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ d2position}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Number\ of\ geometric\ Data\ in\ GeomObject:\ None.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classUndeformedLeaflet_a56153a1d117dd41657183655de094d3e}{ngeom\_data}}()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ 0;\}\ \ }
\DoxyCodeLine{}
\DoxyCodeLine{\ private\ :}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ x\ position\ of\ the\ undeformed\ leaflet's\ origin.\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classUndeformedLeaflet_aa89fc695af9e53aa38894c9d875afd36}{X0}};}
\DoxyCodeLine{}
\DoxyCodeLine{\};\ \textcolor{comment}{//end\_of\_undeformed\_wall}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_main}{}\doxysection{\texorpdfstring{The driver code}{The driver code}}\label{index_main}
As with most time-\/dependent demo codes, the specification of a non-\/zero number of command line arguments will be interpreted as the code being run as part of {\ttfamily oomph-\/lib\textquotesingle{}s} self-\/test in which case only a few timesteps will be performed. Therefore we start by storing the command line arguments in the namespace {\ttfamily Command\+Line\+Args} to make them accessible throughout the code.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=======\ start\_of\_main================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Driver\ code\ \ -\/-\/\ pass\ a\ command\ line\ argument\ if\ you\ want\ to\ run}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ the\ code\ in\ validation\ mode\ where\ it\ only\ performs\ a\ few\ steps}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{fsi__channel__with__leaflet_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}*\ argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Store\ command\ line\ arguments}}
\DoxyCodeLine{\ CommandLineArgs::setup(argc,argv);}

\end{DoxyCodeInclude}
 Next we specify the geometry and mesh parameters, and build the {\ttfamily Problem} object, using the {\ttfamily Algebraic\+Element} version of the two-\/dimensional {\ttfamily Refineable\+QTaylor\+Hood\+Elements}.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Parameters\ for\ the\ leaflet:\ x-\/position\ of\ root\ and\ height}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ x\_0\ =\ 1.0;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ hleaflet=0.5;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ elements\ in\ various\ regions\ of\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nleft=6;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nright=18;}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ny1=3;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ny2=3;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Dimensions\ of\ fluid\ mesh:\ length\ to\ the\ left\ and\ right\ of\ leaflet}}
\DoxyCodeLine{\ \textcolor{comment}{//\ and\ total\ height}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ lleft\ =1.0;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ lright=3.0;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ htot=1.0;}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \textcolor{comment}{//Build\ the\ problem}}
\DoxyCodeLine{\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem}{FSIChannelWithLeafletProblem}}<}
\DoxyCodeLine{\ \ AlgebraicElement<RefineableQTaylorHoodElement<2>\ >\ >}
\DoxyCodeLine{\ \ problem(lleft,lright,hleaflet,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ htot,nleft,nright,ny1,ny2,x\_0);\ }

\end{DoxyCodeInclude}
 We prepare a {\ttfamily Doc\+Info} object and open a trace file to document the system\textquotesingle{}s evolution.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ up\ doc\ info}}
\DoxyCodeLine{\ DocInfo\ doc\_info;\ }
\DoxyCodeLine{\ doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Trace\ file}}
\DoxyCodeLine{\ ofstream\ trace;}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ filename[100];}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/trace.dat"{}},doc\_info.directory().c\_str());}
\DoxyCodeLine{\ trace.open(filename);}

\end{DoxyCodeInclude}
 Next we assign the timestepping parameters (using fewer timesteps if the code is run during a self-\/test) and document the system\textquotesingle{}s initial state which provides the initial guess for the Newton iteration in the subsequent steady solve.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ timesteps\ (reduced\ for\ validation)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nstep=200;}
\DoxyCodeLine{\ \textcolor{keywordflow}{if}\ (CommandLineArgs::Argc>1)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ nstep=2;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Timestep:\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ dt=0.05;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Initialise\ timestep\ }}
\DoxyCodeLine{\ problem.initialise\_dt(dt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Doc\ initial\ guess\ for\ steady\ solve}}
\DoxyCodeLine{\ problem.doc\_solution(doc\_info,trace);}
\DoxyCodeLine{\ doc\_info.number()++;\ }

\end{DoxyCodeInclude}
 We wish to start the time-\/dependent simulation from an initial condition that corresponds to the steady solution of the problem with unit influx (i.\+e. the steady solution obtained if the time-\/dependent boundary condition that is applied at the inlet is held fixed at its value for $ t= 0 $). For the required Reynolds number of $ Re=200 $, the currently assigned initial guess (zero velocity and pressure, with the wall ~\newline
 in its undeformed position) is "{}too far"{} from the actual solution and the Newton method would diverge (try it!). Therefore we generate the initial steady solution in a preliminary sequence of steady computations in which we first compute the solution for a Reynolds number of $ Re=50 $ (for this value the Newton method does converge). This solution is then used as the initial guess for the computation at $ Re=100 $, etc. We allow for up to 3 mesh adaptations for each Reynolds number to allow the mesh to adapt itself to the flow conditions before starting the time-\/dependent run.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Initial\ loop\ to\ increment\ the\ Reynolds\ number\ in\ sequence\ of\ steady\ solves}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_increment=4;}
\DoxyCodeLine{\ \textcolor{comment}{//\ Just\ to\ one\ step\ for\ validation\ run}}
\DoxyCodeLine{\ \textcolor{keywordflow}{if}\ (CommandLineArgs::Argc>1)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ n\_increment=1;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ max.\ number\ of\ adaptations}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ max\_adapt=3;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}}=0.0;}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i=0;i<n\_increment;i++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Increase\ Re\ and\ ReSt\ (for\ St=1)}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}}+=50.0;}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{Global\_Physical\_Variables::ReSt}}=\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Solve\ the\ steady\ problem\ }}
\DoxyCodeLine{\ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Computing\ a\ steady\ solution\ for\ Re="{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}}\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ problem.steady\_newton\_solve(max\_adapt);}
\DoxyCodeLine{\ \ \ problem.doc\_solution(doc\_info,trace);}
\DoxyCodeLine{\ \ \ doc\_info.number()++;\ }
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ reached\ final\ Reynolds\ number\ }}

\end{DoxyCodeInclude}


Finally, we start the proper timestepping procedure, allowing for one mesh adaptation per timestep and suppressing the re-\/assignment of the initial condition after the mesh adaptation by setting the {\ttfamily first} flag to false.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Proper\ time-\/dependent\ run}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Limit\ the\ number\ of\ adaptations\ during\ unsteady\ run\ to\ one\ per\ timestep}}
\DoxyCodeLine{\ max\_adapt=1;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Don't\ re-\/set\ the\ initial\ conditions\ when\ adapting\ the\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{bool}\ first\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Timestepping\ loop}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ istep=0;istep<nstep;istep++)}
\DoxyCodeLine{\ \ \{\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Solve\ the\ problem}}
\DoxyCodeLine{\ \ \ problem.unsteady\_newton\_solve(dt,max\_adapt,first);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Output\ the\ solution}}
\DoxyCodeLine{\ \ \ problem.doc\_solution(doc\_info,trace);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Step\ number}}
\DoxyCodeLine{\ \ \ doc\_info.number()++;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\}\textcolor{comment}{//end\ of\ main}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_problem}{}\doxysection{\texorpdfstring{The Problem class}{The Problem class}}\label{index_problem}
The {\ttfamily Problem} class contains the usual member functions, most of which are either empty or explained in more detail below.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=====start\_of\_problem\_class========================================}}
\DoxyCodeLine{\textcolor{comment}{///\ FSI\ leaflet\ in\ channel}}
\DoxyCodeLine{\textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classFSIChannelWithLeafletProblem}{FSIChannelWithLeafletProblem}}\ :\ \textcolor{keyword}{public}\ Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ Pass\ the\ lenght\ of\ the\ domain\ at\ the\ left}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ leaflet\ lleft,the\ lenght\ of\ the\ domain\ at\ the\ right\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ lright,the\ height\ of\ the\ leaflet\ hleaflet,\ the\ total\ height}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ domain\ htot,\ the\ number\ of\ macro-\/elements\ at\ the\ left\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ nleft,\ the\ number\ of\ macro-\/elements\ at\ the\ right\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ nright,\ the\ number\ of\ macro-\/elements\ under\ hleaflet\ ny1,}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ number\ of\ macro-\/elements\ above\ hleaflet\ ny2,\ the\ abscissa}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ origin\ of\ the\ leaflet\ x\_0.}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem}{FSIChannelWithLeafletProblem}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ lleft,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ lright,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ hleaflet,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ htot,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nleft,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nright,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ ny1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \ ny2,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_0);\ \ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor\ empty}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a5df1d8f7229314a92ffb48ec61f56fe0}{\string~FSIChannelWithLeafletProblem}}()\{\}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Actions\ after\ solve\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_abff6e46a940263c9255a61f649bb4239}{actions\_after\_newton\_solve}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Actions\ before\ solve\ (empty)\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a8a32ef77f32b3283b4b509669deb0a11}{actions\_before\_newton\_solve}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Actions\ after\ adaptation}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_acc3f4745ea9b4524aebbc4f2556d1286}{actions\_after\_adapt}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ to\ the\ wall\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ OneDLagrangianMesh<FSIHermiteBeamElement>*\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a6505a8ecf982304b71b513dac4f47e89}{wall\_mesh\_pt}}()\ }
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a943437726f0a54fa8f7fc9ffb12bc4cd}{Wall\_mesh\_pt}};}
\DoxyCodeLine{\ \ \}\ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ to\ fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>*\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_ad4408b6e1367fcbe976d48b55d9fd78e}{fluid\_mesh\_pt}}()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a40cee3652918bdcf67569afc89d3074d}{Fluid\_mesh\_pt}};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a055f124f38dca43bc3ed36b80c5c0880}{doc\_solution}}(DocInfo\&\ doc\_info,\ ofstream\&\ trace);}

\end{DoxyCodeInclude}


Two member functions are implemented here\+: The function {\ttfamily actions\+\_\+before\+\_\+implicit\+\_\+timestep()} updates the time-\/dependent velocity profile at the upstream boundary (boundary 3; see the enumeration of the mesh boundaries in the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}})\+: 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Update\ the\ inflow\ velocity}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ actions\_before\_implicit\_timestep()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Actual\ time}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ t=time\_pt()-\/>time();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Amplitude\ of\ flow}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ ampl=\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ad651484fe06209606bccefe6fe23be0c}{Global\_Physical\_Variables::flux}}(t);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Update\ parabolic\ flow\ along\ boundary\ 3}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ ibound=3;\ }
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=\ Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ ycoord\ =\ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>x(1);\ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{double}\ uy\ =\ ampl*6.0*ycoord/Htot*(1.0-\/ycoord/Htot);}
\DoxyCodeLine{\ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(0,uy);}
\DoxyCodeLine{\ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(1,0.0);\ \ \ \ }
\DoxyCodeLine{\ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ actions\_before\_implicit\_timestep}}

\end{DoxyCodeInclude}
 Since the node-\/update is performed by an algebraic node-\/update procedure the nodal positions in the fluid mesh must be updated whenever any of the (solid) degrees-\/of-\/freedom change. This is done automatically during the computation of the shape derivatives (implemented in the {\ttfamily Algebraic\+Element} wrapper class described \href{../../fsi_collapsible_channel_algebraic/html/index.html}{\texttt{ another tutorial}}), but an additional node update must be performed when the unknowns are updated by the Newton solver. This is achieved by performing a further node-\/update in the function {\ttfamily actions\+\_\+before\+\_\+newton\+\_\+convergence\+\_\+check()}\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ before\ checking\ Newton\ convergence:\ Update\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ nodal\ positions\ in\ the\ fluid\ mesh\ in\ response\ to\ possible\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ changes\ in\ the\ wall\ shape}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ actions\_before\_newton\_convergence\_check()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ Fluid\_mesh\_pt-\/>node\_update();}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 The private member data contains the usual pointers to the {\ttfamily Problem\textquotesingle{}s} two sub-\/meshes, the pointer to {\ttfamily Geom\+Object} that represents the leaflet, and the total height of the channel.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ the\ fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>*\ Fluid\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ the\ "{}wall"{}\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ OneDLagrangianMesh<FSIHermiteBeamElement>*\ Wall\_mesh\_pt;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ the\ GeomObject\ that\ represents\ the\ wall}}
\DoxyCodeLine{\textcolor{comment}{}\ GeomObject*\ Leaflet\_pt;}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Total\ height\ of\ the\ domain}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ Htot;}
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_constructor}{}\doxysection{\texorpdfstring{The problem constructor}{The problem constructor}}\label{index_constructor}
We start the problem construction by creating two timesteppers\+: A {\ttfamily BFD$<$2$>$} timestepper for the fluid and the fake timestepper {\ttfamily Steady$<$2$>$} for the (massless) solid. (\href{../../fsi_collapsible_channel_adapt/html/index.html}{\texttt{ Recall }} that timesteppers from the {\ttfamily Steady} family return zero time-\/derivatives but keep track of the past histories. These are needed during the adaptive refinement of the fluid mesh\+: when assigning the history of the previous nodal positions for newly created fluid nodes, we must evaluate the position of the leaflet at previous timesteps; this is discussed in more detail in \href{../../fsi_collapsible_channel_adapt/html/index.html}{\texttt{ another tutorial}}.)


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=====start\_of\_constructor==============================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\mbox{\hyperlink{classFSIChannelWithLeafletProblem_aaa0a455e91c4fb2dd9696607b802d01b}{FSIChannelWithLeafletProblem<ELEMENT>::FSIChannelWithLeafletProblem}}(}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ lleft,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ lright,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ hleaflet,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ htot,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nleft,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nright,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ ny1,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \ ny2,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_0)\ :\ Htot(htot)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Timesteppers:}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Allocate\ the\ timestepper}}
\DoxyCodeLine{\ BDF<2>*\ fluid\_time\_stepper\_pt=\textcolor{keyword}{new}\ BDF<2>;}
\DoxyCodeLine{\ add\_time\_stepper\_pt(fluid\_time\_stepper\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Allocate\ the\ wall\ timestepper}}
\DoxyCodeLine{\ Steady<2>*\ wall\_time\_stepper\_pt=\textcolor{keyword}{new}\ Steady<2>;}
\DoxyCodeLine{\ add\_time\_stepper\_pt(wall\_time\_stepper\_pt);}

\end{DoxyCodeInclude}
 Next we create the mesh of 1D Hermite beam elements that represents the leaflet, passing a pointer to an instance of the {\ttfamily \doxylink{classUndeformedLeaflet}{Undeformed\+Leaflet}} to its constructor.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Discretise\ leaflet}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Geometric\ object\ that\ represents\ the\ undeformed\ leaflet}}
\DoxyCodeLine{\ \mbox{\hyperlink{classUndeformedLeaflet}{UndeformedLeaflet}}*\ undeformed\_wall\_pt=\textcolor{keyword}{new}\ \mbox{\hyperlink{classUndeformedLeaflet}{UndeformedLeaflet}}(x\_0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Create\ the\ "{}wall"{}\ mesh\ with\ FSI\ Hermite\ beam\ elements}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_wall\_el=5;}
\DoxyCodeLine{\ Wall\_mesh\_pt\ =\ \textcolor{keyword}{new}\ OneDLagrangianMesh<FSIHermiteBeamElement>}
\DoxyCodeLine{\ \ (n\_wall\_el,hleaflet,undeformed\_wall\_pt,wall\_time\_stepper\_pt);}

\end{DoxyCodeInclude}
 The wall mesh defines the geometry of the deformed leaflet, therefore we create a {\ttfamily Geom\+Object} representation of that mesh, using the {\ttfamily Mesh\+As\+Geom\+Object} class, and pass it to the constructor of the fluid mesh\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Provide\ GeomObject\ representation\ of\ leaflet\ mesh\ and\ build\ fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ a\ geometric\ object\ (one\ Lagrangian,\ two\ Eulerian\ coordinates)}}
\DoxyCodeLine{\ \textcolor{comment}{//\ from\ the\ wall\ mesh}}
\DoxyCodeLine{\ MeshAsGeomObject*\ wall\_geom\_object\_pt=}
\DoxyCodeLine{\ \ \textcolor{keyword}{new}\ MeshAsGeomObject(Wall\_mesh\_pt);\ }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Build\ the\ mesh}}
\DoxyCodeLine{\ Fluid\_mesh\_pt\ =\textcolor{keyword}{new}\ RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>(}
\DoxyCodeLine{\ \ wall\_geom\_object\_pt,}
\DoxyCodeLine{\ \ lleft,\ lright,}
\DoxyCodeLine{\ \ hleaflet,}
\DoxyCodeLine{\ \ htot,nleft,}
\DoxyCodeLine{\ \ nright,ny1,ny2,}
\DoxyCodeLine{\ \ fluid\_time\_stepper\_pt);}

\end{DoxyCodeInclude}
 We specify an error estimator for the fluid mesh and add both meshes to the {\ttfamily Problem} before combining them into a global mesh.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ error\ estimator}}
\DoxyCodeLine{\ Z2ErrorEstimator*\ error\_estimator\_pt=\textcolor{keyword}{new}\ Z2ErrorEstimator;}
\DoxyCodeLine{\ Fluid\_mesh\_pt-\/>spatial\_error\_estimator\_pt()=error\_estimator\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ global\ mesh}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Add\ the\ sub\ meshes\ to\ the\ problem}}
\DoxyCodeLine{\ add\_sub\_mesh(Fluid\_mesh\_pt);}
\DoxyCodeLine{\ add\_sub\_mesh(Wall\_mesh\_pt);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Combine\ all\ submeshes\ into\ a\ single\ Mesh}}
\DoxyCodeLine{\ build\_global\_mesh();}

\end{DoxyCodeInclude}
 Dirichlet conditions (prescribed velocity) are applied on virtually all boundaries of the fluid domain (prescribed inflow at the inlet; zero velocity on the rigid channel walls; fluid velocity prescribed by the wall motion on the leaflet), apart from the outflow (boundary 1; see the enumeration of the mesh boundaries in the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}}) where the axial velocity is unknown (and determined indirectly by the "{}axially-\/traction-\/free"{} condition) while the vertical velocity has to be set to zero to ensure parallel outflow.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Fluid\ boundary\ conditions}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Pin\ the\ boundary\ nodes\ of\ the\ fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ num\_bound\ =\ Fluid\_mesh\_pt-\/>nboundary();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ ibound=0;ibound<num\_bound;ibound++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=\ Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin(1);}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{comment}{//\ Do\ not\ pin\ the\ x\ velocity\ of\ the\ outflow}}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ibound\ !=\ 1)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>pin(0);\ }
\DoxyCodeLine{\ \ \ \ \ \ \}\ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{//\ end\ loop\ over\ boundaries}}

\end{DoxyCodeInclude}
 Next we assign the parabolic velocity profile at the inlet (recall that all values are initialised to zero so no further action is required on any of the other Dirichlet boundaries).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ parabolic\ flow\ along\ boundary\ 3\ (everything\ else\ that's\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ pinned\ has\ homogenous\ boundary\ conditions\ so\ no\ action\ is\ required}}
\DoxyCodeLine{\ \textcolor{comment}{//\ as\ that's\ the\ default\ assignment).\ Inflow\ profile\ is\ parabolic}}
\DoxyCodeLine{\ \textcolor{comment}{//\ and\ this\ is\ interpolated\ correctly\ during\ mesh\ refinement\ so}}
\DoxyCodeLine{\ \textcolor{comment}{//\ no\ re-\/assignment\ necessary\ after\ adaptation.}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ibound=3;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ num\_nod=\ Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ ycoord\ =\ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>x(1);\ }
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ uy\ =\ 6.0*ycoord/htot*(1.0-\/ycoord/htot);}
\DoxyCodeLine{\ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(0,uy);}
\DoxyCodeLine{\ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(1,0.0);\ \ \ \ }
\DoxyCodeLine{\ \ \}\textcolor{comment}{//\ end\ of\ setup\ boundary\ condition}}

\end{DoxyCodeInclude}
 The leaflet is clamped at its lower end so we pin its $x_1$-\/ and $x_2$-\/positions, and impose a vertical slope by setting $ dx_1/ds = 0 $ (where s is the local coordinate along the element; see the discussion of the boundary conditions for beam elements in \href{../../../beam/tensioned_string/html/index.html}{\texttt{ another tutorial}} for details).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Boundary\ conditions\ for\ wall\ mesh}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ the\ boundary\ conditions:\ the\ lower\ end\ of\ the\ beam\ is\ fixed\ in\ space}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ b=0;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ displacements\ in\ both\ x\ and\ y\ directions}}
\DoxyCodeLine{\ wall\_mesh\_pt()-\/>boundary\_node\_pt(b,0)-\/>pin\_position(0);\ }
\DoxyCodeLine{\ wall\_mesh\_pt()-\/>boundary\_node\_pt(b,0)-\/>pin\_position(1);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Infinite\ slope:\ Pin\ type\ 1\ (slope)\ dof\ for\ displacement\ direction\ 0\ }}
\DoxyCodeLine{\ wall\_mesh\_pt()-\/>boundary\_node\_pt(b,0)-\/>pin\_position(1,0);}

\end{DoxyCodeInclude}
 Next, we complete the build of the fluid elements by passing pointers to the relevant physical parameters to the elements and pinning any redundant pressure degrees of freedom; see \href{../../../navier_stokes/adaptive_driven_cavity/html/index.html}{\texttt{ another tutorial}} for details.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Complete\ build\ of\ fluid\ elements}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_element\ =\ Fluid\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ the\ elements\ to\ set\ up\ element-\/specific\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ things\ that\ cannot\ be\ handled\ by\ constructor}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ from\ GeneralisedElement\ to\ the\ present\ element}}
\DoxyCodeLine{\ \ \ ELEMENT*\ el\_pt\ =\ \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(Fluid\_mesh\_pt-\/>element\_pt(e));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ Reynolds\ number}}
\DoxyCodeLine{\ \ \ el\_pt-\/>re\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ Womersley\ number}}
\DoxyCodeLine{\ \ \ el\_pt-\/>re\_st\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_a085ee4bf968ffdd01a41b8c41864f907}{Global\_Physical\_Variables::ReSt}};}
\DoxyCodeLine{\ \ \ \ \ \ }
\DoxyCodeLine{\ \ \}\textcolor{comment}{//\ end\ loop\ over\ elements}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ redudant\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ pin\_redundant\_nodal\_pressures(Fluid\_mesh\_pt-\/>element\_pt());}

\end{DoxyCodeInclude}
 When completing the build of the wall elements we use the function {\ttfamily enable\+\_\+fluid\+\_\+loading\+\_\+on\+\_\+both\+\_\+sides()} to indicate that the leaflet is completely immersed in the fluid so that fluid tractions act on both of its faces. When setting up the fluid-\/structure interaction below, one of the two faces will have to be identified as the "{}front"{} (face 0) and the other one as the "{}back"{} (face 1). The function {\ttfamily normal\+\_\+points\+\_\+into\+\_\+fluid()} allows us to indicate if the outer unit normal on the leaflet (as computed by {\ttfamily FSIHermite\+Beam\+Element\+::get\+\_\+normal(...)} points into the fluid, when viewed from the "{}front"{} face. Here it does not -- see \doxysectlink{index_comm}{Further comments}{2} for more details on this slightly subtle point).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Complete\ build\ of\ wall\ elements}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ n\_element\ =\ wall\_mesh\_pt()-\/>nelement();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ to\ the\ specific\ element\ type}}
\DoxyCodeLine{\ \ \ FSIHermiteBeamElement\ *elem\_pt\ =\ }
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{dynamic\_cast<}FSIHermiteBeamElement*\textcolor{keyword}{>}(wall\_mesh\_pt()-\/>element\_pt(e));}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ physical\ parameters\ for\ each\ element:}}
\DoxyCodeLine{\ \ \ elem\_pt-\/>h\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_af6e07423e22c0991084d9a2f43727805}{Global\_Physical\_Variables::H}};}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Function\ that\ specifies\ the\ load\ ratios}}
\DoxyCodeLine{\ \ \ elem\_pt-\/>q\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_a66cb7ecda9ba0cd72367dd697f154545}{Global\_Physical\_Variables::Q}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ undeformed\ shape\ for\ each\ element}}
\DoxyCodeLine{\ \ \ elem\_pt-\/>undeformed\_beam\_pt()\ =\ undeformed\_wall\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Leaflet\ is\ immersed\ and\ loaded\ by\ fluid\ on\ both\ sides}}
\DoxyCodeLine{\ \ \ elem\_pt-\/>enable\_fluid\_loading\_on\_both\_sides();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ The\ normal\ to\ the\ leaflet,\ as\ computed\ by\ the\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ FSIHermiteElements\ points\ away\ from\ the\ fluid\ rather\ than\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ into\ the\ fluid\ (as\ assumed\ by\ default)\ when\ viewed\ from}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ the\ "{}front"{}\ (face\ 0).}}
\DoxyCodeLine{\ \ \ elem\_pt-\/>set\_normal\_pointing\_out\_of\_fluid();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ loop\ over\ elements}}

\end{DoxyCodeInclude}


We can now set up the fluid structure interaction. The motion of the leaflet determines the fluid velocity of all nodes on boundaries 4 and 5 via the no-\/slip condition (see the enumeration of the mesh boundaries in the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}}). The fluid velocity at these nodes can be updated automatically whenever a fluid node is moved (by the fluid mesh\textquotesingle{}s node-\/update function) by specifying an auxiliary node update function.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ FSI}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ The\ velocity\ of\ the\ fluid\ nodes\ on\ the\ wall\ (fluid\ mesh\ boundary\ 4,5)}}
\DoxyCodeLine{\ \textcolor{comment}{//\ is\ set\ by\ the\ wall\ motion\ -\/-\/\ hence\ the\ no-\/slip\ condition\ must\ be}}
\DoxyCodeLine{\ \textcolor{comment}{//\ re-\/applied\ whenever\ a\ node\ update\ is\ performed\ for\ these\ nodes.\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ Such\ tasks\ may\ be\ performed\ automatically\ by\ the\ auxiliary\ node\ update\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ function\ specified\ by\ a\ function\ pointer:}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ ibound=4;ibound<6;ibound++\ )}
\DoxyCodeLine{\ \ \{\ }
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=\ Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{\ \ \ }
\DoxyCodeLine{\ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,\ inod)-\/>}
\DoxyCodeLine{\ \ \ \ \ \ set\_auxiliary\_node\_update\_fct\_pt(}
\DoxyCodeLine{\ \ \ \ \ \ \ FSI\_functions::apply\_no\_slip\_on\_moving\_wall);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\textcolor{comment}{//\ aux\ node\ update\ fct\ has\ been\ set}}

\end{DoxyCodeInclude}
 Finally, we have to determine which fluid elements are adjacent to the two faces of the {\ttfamily FSIHermite\+Beam\+Elements} to allow them to compute the fluid traction they are exposed to. This is done separately for the "{}front"{} and "{}back"{} faces. The "{}front"{} of the leaflet (face 0) is assumed to coincide with the fluid mesh boundary 4; the "{}back"{} (face 1) is assumed to coincide with the fluid mesh boundary 5.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Work\ out\ which\ fluid\ dofs\ affect\ the\ residuals\ of\ the\ wall\ elements:}}
\DoxyCodeLine{\ \textcolor{comment}{//\ We\ pass\ the\ boundary\ between\ the\ fluid\ and\ solid\ meshes\ and\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ pointers\ to\ the\ meshes.\ The\ interaction\ boundary\ is\ boundary\ 4\ and\ 5}}
\DoxyCodeLine{\ \textcolor{comment}{//\ of\ the\ 2D\ fluid\ mesh.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Front\ of\ leaflet:\ Set\ face=0\ (which\ is\ also\ the\ default\ so\ this\ argument}}
\DoxyCodeLine{\ \textcolor{comment}{//\ could\ be\ omitted)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ face=0;\ }
\DoxyCodeLine{\ FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ \ (\textcolor{keyword}{this},4,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Back\ of\ leaflet:\ face\ 1,\ needs\ to\ be\ specified\ explicitly}}
\DoxyCodeLine{\ face=1;\ }
\DoxyCodeLine{\ FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ \ (\textcolor{keyword}{this},5,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }

\end{DoxyCodeInclude}


Following the setup of the fluid-\/structure interaction we assign the equation numbers\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ equation\ numbering\ scheme}}
\DoxyCodeLine{\ cout\ <<\textcolor{stringliteral}{"{}Number\ of\ equations:\ "{}}\ <<\ assign\_eqn\_numbers()\ <<\ std::endl;\ }
\DoxyCodeLine{\}\textcolor{comment}{//end\ of\ constructor}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_adapt}{}\doxysection{\texorpdfstring{Actions after the mesh adaptation}{Actions after the mesh adaptation}}\label{index_adapt}
Once the fluid mesh has been adapted we free all pressure degrees of freedom and then (re-\/)pin any redundant ones; see the discussion in \href{../../../navier_stokes/adaptive_driven_cavity/html/index.html}{\texttt{ another tutorial}} for details.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//====\ start\_of\_actions\_after\_adapt=================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Actions\_after\_adapt()}}
\DoxyCodeLine{\textcolor{comment}{//==================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_acc3f4745ea9b4524aebbc4f2556d1286}{FSIChannelWithLeafletProblem<ELEMENT>::actions\_after\_adapt}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Unpin\ all\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ unpin\_all\_pressure\_dofs(Fluid\_mesh\_pt-\/>element\_pt());}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ redundant\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ pin\_redundant\_nodal\_pressures(Fluid\_mesh\_pt-\/>element\_pt());}

\end{DoxyCodeInclude}
 Any newly created fluid nodes on the leaflet (i.\+e. on the fluid mesh boundaries 4 and 5) must be subjected to the automatic application of the no-\/slip condition. For simplicity we (re-\/)specify the auxiliary node update function pointer for all of the nodes on those boundaries.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ (Re-\/)apply\ the\ no\ slip\ condition\ on\ the\ moving\ wall}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ The\ velocity\ of\ the\ fluid\ nodes\ on\ the\ wall\ (fluid\ mesh\ boundary\ 4,5)}}
\DoxyCodeLine{\ \textcolor{comment}{//\ is\ set\ by\ the\ wall\ motion\ -\/-\/\ hence\ the\ no-\/slip\ condition\ must\ be}}
\DoxyCodeLine{\ \textcolor{comment}{//\ re-\/applied\ whenever\ a\ node\ update\ is\ performed\ for\ these\ nodes.\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ Such\ tasks\ may\ be\ performed\ automatically\ by\ the\ auxiliary\ node\ update\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ function\ specified\ by\ a\ function\ pointer:}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ ibound=4;ibound<6;ibound++\ )}
\DoxyCodeLine{\ \ \{\ }
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=\ Fluid\_mesh\_pt-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{\ \ \ }
\DoxyCodeLine{\ \ \ \ \ Fluid\_mesh\_pt-\/>boundary\_node\_pt(ibound,\ inod)-\/>}
\DoxyCodeLine{\ \ \ \ \ \ set\_auxiliary\_node\_update\_fct\_pt(}
\DoxyCodeLine{\ \ \ \ \ \ \ FSI\_functions::apply\_no\_slip\_on\_moving\_wall);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ aux\ node\ update\ fct\ has\ been\ (re-\/)set}}

\end{DoxyCodeInclude}
 Finally, the adaptation of the fluid mesh may change the fluid elements that are adjacent to the wall elements so we re-\/generate the corresponding FSI lookup schemes.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Re-\/setup\ FSI}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Work\ out\ which\ fluid\ dofs\ affect\ the\ residuals\ of\ the\ wall\ elements:}}
\DoxyCodeLine{\ \textcolor{comment}{//\ We\ pass\ the\ boundary\ between\ the\ fluid\ and\ solid\ meshes\ and\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ pointers\ to\ the\ meshes.\ The\ interaction\ boundary\ is\ boundary\ 4\ and\ 5}}
\DoxyCodeLine{\ \textcolor{comment}{//\ of\ the\ 2D\ fluid\ mesh.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Front\ of\ leaflet:\ Set\ face=0\ (which\ is\ also\ the\ default\ so\ this\ argument}}
\DoxyCodeLine{\ \textcolor{comment}{//\ could\ be\ omitted)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ face=0;\ }
\DoxyCodeLine{\ FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ \ (\textcolor{keyword}{this},4,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Back\ of\ leaflet:\ face\ 1,\ needs\ to\ be\ specified\ explicitly}}
\DoxyCodeLine{\ face=1;\ }
\DoxyCodeLine{\ FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ \ (\textcolor{keyword}{this},5,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_actions\_after\_adapt}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_doc}{}\doxysection{\texorpdfstring{Post Processing}{Post Processing}}\label{index_doc}
The function {\ttfamily doc\+\_\+solution(...)} documents the results. We output the fluid and solid meshes and document selected additional quantities in the trace file.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_doc\_solution=================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFSIChannelWithLeafletProblem_a055f124f38dca43bc3ed36b80c5c0880}{FSIChannelWithLeafletProblem<ELEMENT>::doc\_solution}}(DocInfo\&\ doc\_info,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ofstream\&\ trace)}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ ofstream\ some\_file;}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ filename[100];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ plot\ points}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ npts;}
\DoxyCodeLine{\ npts=5;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ fluid\ solution\ }}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ Fluid\_mesh\_pt-\/>output(some\_file,npts);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ wall\ solution\ }}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/wall\_soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ Wall\_mesh\_pt-\/>output(some\_file,npts);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Get\ node\ at\ tip\ of\ leaflet}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_el\_wall=Wall\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{\ Node*\ tip\_node\_pt=Wall\_mesh\_pt-\/>finite\_element\_pt(n\_el\_wall-\/1)-\/>node\_pt(1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Get\ time:}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ time=time\_pt()-\/>time();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Write\ trace\ file}}
\DoxyCodeLine{\ trace\ <<\ time\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ad651484fe06209606bccefe6fe23be0c}{Global\_Physical\_Variables::flux}}(time)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ tip\_node\_pt-\/>x(0)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ tip\_node\_pt-\/>x(1)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ tip\_node\_pt-\/>dposition\_dt(0)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ tip\_node\_pt-\/>dposition\_dt(1)\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ doc\_info.number()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ <<\ std::endl;}

\end{DoxyCodeInclude}
 The remaining output is created to determine which elements are located next to the fluid mesh boundaries 4 and 5 (Yes, \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ the documentation for the mesh}} illustrates the enumeration of the mesh boundaries but we generally prefer to be paranoid; see \doxysectlink{index_comm}{Further comments}{2} ), and to establish the direction of the unit normal on the beam.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Help\ me\ figure\ out\ what\ the\ "{}front"{}\ and\ "{}back"{}\ faces\ of\ the\ leaflet\ are}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ fluid\ elements\ on\ fluid\ mesh\ boundary\ 4\ (associated\ with}}
\DoxyCodeLine{\ \textcolor{comment}{//\ the\ "{}front"{})}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ bound=4;}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/fluid\_boundary\_elements\_front\_\%i.dat"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nel=\ Fluid\_mesh\_pt-\/>nboundary\_element(bound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ e=0;e<nel;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(Fluid\_mesh\_pt-\/>boundary\_element\_pt(bound,e))}
\DoxyCodeLine{\ \ \ \ -\/>output(some\_file,npts);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ fluid\ elements\ on\ fluid\ mesh\ boundary\ 5\ (associated\ with}}
\DoxyCodeLine{\ \textcolor{comment}{//\ the\ "{}back"{})}}
\DoxyCodeLine{\ bound=5;}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/fluid\_boundary\_elements\_back\_\%i.dat"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ nel=\ Fluid\_mesh\_pt-\/>nboundary\_element(bound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ e=0;e<nel;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(Fluid\_mesh\_pt-\/>boundary\_element\_pt(bound,e))}
\DoxyCodeLine{\ \ \ \ -\/>output(some\_file,npts);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ normal\ vector\ on\ wall\ elements}}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/wall\_normal\_\%i.dat"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ nel=Wall\_mesh\_pt-\/>nelement();}
\DoxyCodeLine{\ Vector<double>\ s(1);}
\DoxyCodeLine{\ Vector<double>\ x(2);}
\DoxyCodeLine{\ Vector<double>\ xi(1);}
\DoxyCodeLine{\ Vector<double>\ N(2);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ e=0;e<nel;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Get\ pointer\ to\ element}}
\DoxyCodeLine{\ \ \ FSIHermiteBeamElement*\ el\_pt=}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{dynamic\_cast<}FSIHermiteBeamElement*\textcolor{keyword}{>}(Wall\_mesh\_pt-\/>element\_pt(e));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Loop\ over\ plot\ points}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ i=0;i<npts;i++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ s[0]=-\/1.0+2.0*double(i)/double(npts-\/1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Get\ Eulerian\ position}}
\DoxyCodeLine{\ \ \ \ \ el\_pt-\/>interpolated\_x(s,x);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Get\ unit\ normal}}
\DoxyCodeLine{\ \ \ \ \ el\_pt-\/>get\_normal(s,N);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Get\ Lagrangian\ coordinate}}
\DoxyCodeLine{\ \ \ \ \ el\_pt-\/>interpolated\_xi(s,xi);}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ some\_file\ <<\ x[0]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ x[1]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ N[0]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ N[1]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ xi[0]\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_doc\_solution}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_comm_ex}{}\doxysection{\texorpdfstring{Further comments and exercises}{Further comments and exercises}}\label{index_comm_ex}
\hypertarget{index_comm}{}\doxysubsection{\texorpdfstring{Further comments}{Further comments}}\label{index_comm}

\begin{DoxyEnumerate}
\item {\bfseries{How does one identify the "{}front"{} and "{}back"{} of an immersed beam structure?}} ~\newline
~\newline
 When setting up the fluid-\/structure interaction in the \doxysectlink{index_constructor}{The problem constructor}{1} we had to associate the fluid mesh boundaries 4 and 5 (the boundaries adjacent to the leaflet (see the enumeration of the mesh boundaries in the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}}) with the "{}front"{} and "{}back"{} of the fully immersed beam structure. Furthermore, since the computation of the fluid traction acting on the leaflet depends on the direction of the normal, and the normal on the "{}front"{} of the leaflet points in the opposite direction to that on its "{}back"{} it is important to assess which normal is used in the automatic computation of the fluid traction. There are two ways of establishing this\+: ~\newline
~\newline

\begin{DoxyEnumerate}
\item {\bfseries{Quick and dirty\+:}} ~\newline
 Set {\ttfamily FSIHermite\+Beam\+Element\+::normal\+\_\+points\+\_\+into\+\_\+fluid()} to {\ttfamily true} and perform a steady computation. If the leaflet is sucked towards the high-\/pressure region you got it wrong. ~\newline
~\newline

\item {\bfseries{Do it properly\+:}} ~\newline
 Use the output generated in {\ttfamily doc\+\_\+solution(...)} to identify the elements adjacent to the fluid mesh boundaries 4 and 5 (i.\+e. the fluid elements next to the leaflet\textquotesingle{}s "{}front"{} and "{}back"{} faces), respectively, and the normal vector returned by {\ttfamily FSIHermite\+Beam\+Element\+::get\+\_\+normal(...)} -- this is the normal that is used in the computation of the fluid traction. The figure below shows a plot of these within an adaptively refined fluid mesh. ~\newline
~\newline
 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{front_and_back}
\doxyfigcaption{Elements near the \`{}front\textquotesingle{} (red) and \`{}back\textquotesingle{} (green) of the leaflet and the outer unit normal on the leaflet. }
\end{DoxyImage}
 The red and green elements are the fluid elements adjacent to the fluid mesh boundaries 4 and 5 (i.\+e. the "{}front"{} and "{}back"{} of the leaflet), respectively. The normal vectors (shown in blue) point towards the upstream end of the channel so they point {\itshape away} {\itshape from} (rather than {\itshape into}) the fluid that is adjacent to the "{}front"{} (the red region). This is why we set {\ttfamily FSIHermite\+Beam\+Element\+::normal\+\_\+points\+\_\+into\+\_\+fluid()=false} (Admittedly, we used the former method to get this right and only documented the proper way to do it when writing this tutorial...) ~\newline
~\newline

\end{DoxyEnumerate}
\item {\bfseries{Use of faster solvers\+: {\ttfamily oomph-\/lib\textquotesingle{}s} FSI preconditioner}} ~\newline
~\newline
 The problem presented in this tutorial was used as one of the test cases for {\ttfamily oomph-\/lib\textquotesingle{}s} FSI preconditioner; see ~\newline
~\newline
 \begin{center} \href{http://www.maths.man.ac.uk/~mheil/oomph_lib_additional_material/HeilHazelBoyleCompMech/HeilHazelBoyleCompMech.pdf}{\texttt{ Heil, M., Hazel, A.\+L. \& Boyle, J. (2008)\+: Solvers for large-\/displacement fluid-\/structure interaction problems\+: Segregated vs. monolithic approaches. Computational Mechanics.}} \end{center}  ~\newline
~\newline
 The use of this preconditioner (which leads to much faster solution times) is described in another tutorial. However, the required source code is already part of the driver code and has simply been ignored in this tutorial. Feel free to experiment with the preconditioner by modifying \href{../../../../demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc}{\texttt{ the source code.}}
\end{DoxyEnumerate}\hypertarget{index_ex}{}\doxysubsection{\texorpdfstring{Exercises}{Exercises}}\label{index_ex}

\begin{DoxyEnumerate}
\item Confirm that choosing the wrong value for the flag ~\newline
 {\ttfamily FSIHermite\+Beam\+Element\+::normal\+\_\+points\+\_\+into\+\_\+fluid()} makes the leaflet move in the wrong direction as it perceives positive fluid tractions as negative ones and vice versa. Here is what you should get\+:  
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{normal_points_in_wrong_direction}
\doxyfigcaption{Deformation of the leaflet with the wrong choice of FSIHermite\+Beam\+Element\+::normal\+\_\+points\+\_\+into\+\_\+fluid()\+: The leaflet gets sucked towards the high-\/pressure region. }
\end{DoxyImage}
 Clearly, the normal points in the wrong direction and the tractions have the wrong sign. This can be made "{}consistent"{}, however, by also swapping the association between the mesh boundaries and the leaflet\textquotesingle{}s faces. I.\+e. if we associate mesh boundary 5 with the "{}front"{} via ~\newline
~\newline
 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Front\ of\ leaflet:\ face\ 0}}
\DoxyCodeLine{face=0;\ }
\DoxyCodeLine{FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ (\textcolor{keyword}{this},5,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }

\end{DoxyCode}
 ~\newline
 and mesh boundary 4 with the "{}back"{} via ~\newline
~\newline
 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Back\ of\ leaflet:\ face\ 1}}
\DoxyCodeLine{face=1;\ }
\DoxyCodeLine{FSI\_functions::setup\_fluid\_load\_info\_for\_solid\_elements<ELEMENT,2>}
\DoxyCodeLine{\ (\textcolor{keyword}{this},4,Fluid\_mesh\_pt,Wall\_mesh\_pt,face);\ }

\end{DoxyCode}
 ~\newline
 the code gives the right results again (make sure you change the code in the problem constructor and in the actions after adaptation!) -- sometimes two wrongs do cancel each other out! ~\newline
~\newline

\item \href{../figures/fsi_channel_with_leaflet_flow.avi}{\texttt{ The animation}} of the flow field shows that the outflow boundary condition is applied "{}too close"{} to the leaflet\+: in the relatively short domain chosen here, the outflow is far from fully developed and as a result the imposition of a parallel flow leads to the development of a artificial outflow boundary layer. ~\newline
~\newline
 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{outflow_bl}
\doxyfigcaption{Artificial outflow boundary layer. }
\end{DoxyImage}
 Confirm that an increase in the downstream length of the domain (or a reduction in the Reynolds number) improves the situation. ~\newline
~\newline

\item The algebraic node-\/update technique employed in the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}} forces {\itshape all} fluid nodes to move when the leaflet deforms. An increase in the downstream length of the fluid domain therefore leads to a significant increase in computational cost. Use the improved node-\/update technique suggested in the \href{../../../navier_stokes/channel_with_leaflet/html/index.html\#ex}{\texttt{ corresponding Navier-\/\+Stokes example}} (only move the nodes in the vicinity of the leaflet) to improve the efficiency of the code.
\end{DoxyEnumerate}\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_ackn}{}\doxysection{\texorpdfstring{Acknowledgements}{Acknowledgements}}\label{index_ackn}

\begin{DoxyItemize}
\item This code was originally developed by Floraine Cordier.
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/interaction/fsi_channel_with_leaflet/
}{\texttt{ demo\+\_\+drivers/interaction/fsi\+\_\+channel\+\_\+with\+\_\+leaflet/ }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/interaction/fsi_channel_with_leaflet/fsi_channel_with_leaflet.cc
}{\texttt{ demo\+\_\+drivers/interaction/fsi\+\_\+channel\+\_\+with\+\_\+leaflet/fsi\+\_\+channel\+\_\+with\+\_\+leaflet.\+cc }} \end{center} 
\end{DoxyItemize}\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
