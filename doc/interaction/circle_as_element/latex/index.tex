\chapter{Demo problem\+: Upgrading a Geom\+Object to a Generalised\+Element -- how to parametrise unknown domain boundaries}
\hypertarget{index}{}\label{index}\index{Demo problem: Upgrading a GeomObject to a GeneralisedElement -- how to parametrise unknown domain boundaries@{Demo problem: Upgrading a GeomObject to a GeneralisedElement -- how to parametrise unknown domain boundaries}}
In many previous examples we demonstrated how to use {\ttfamily Geom\+Objects} to parametrise curvilinear, moving domain boundaries. We used this functionality extensively to perform simulations of problems in moving domains. The techniques illustrated in these examples are adequate for problems in which the motion of the boundary is prescribed; see e.\+g. the ~\newline
 \href{../../../navier_stokes/collapsible_channel/html/index.html}{\texttt{ simulation of fluid flow in a 2D channel in which a part of one channel wall performs a prescribed oscillation}}.

Here we shall demonstrate how to use {\ttfamily Geom\+Objects} to parametrise curvilinear, moving domain boundaries in problem in which the position of the boundary is unknown and has to be determined as part of the overall solution. We will also address the following questions\+:
\begin{DoxyItemize}
\item What is a {\ttfamily Geom\+Object\textquotesingle{}s} geometric {\ttfamily Data}?
\item What is a {\ttfamily Generalised\+Element\textquotesingle{}s} external and internal {\ttfamily Data}?
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_geom_data}{}\doxysection{\texorpdfstring{Part 1\+: A closer look at the Geom\+Object class\+: Geometric Data}{Part 1: A closer look at the GeomObject class: Geometric Data}}\label{index_geom_data}
In an \href{../../../poisson/fish_poisson2/html/index.html}{\texttt{ earlier example}}, we introduced the {\ttfamily Geom\+Object} as a base class for all objects that provide an analytical parametrisation of a geometric object by specifying its Eulerian coordinates (i.\+e. the position vector to "{}material points"{} in the object, $ {\bf r}$) as a function of some intrinsic (Lagrangian) coordinates, $ {\bf \zeta} $, so that $ {\bf r} = {\bf r}({\bf
\zeta})$. Every specific {\ttfamily Geom\+Object} must implement the pure virtual function


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ GeomObject::position(\textcolor{keyword}{const}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}});}

\end{DoxyCode}


where the number of Lagrangian and Eulerian coordinates involved in the parametrisation (i.\+e. the sizes of the vectors {\ttfamily zeta} and {\ttfamily r}) are stored as unsigned integers in the protected member data, {\ttfamily Geom\+Object\+::\+NLagrangian} and {\ttfamily Geom\+Object\+::\+Ndim}, respectively.

Most specific geometric objects store some additional parameters as private data members. For instance, a {\ttfamily Geom\+Object} that represents a 2D circle, parametrised by the 1D Lagrangian coordinate $ \zeta $ as  \[ {\bf r}(\zeta)= \left( \begin{array}{c} X_c + R \cos(\zeta) \\
 Y_c + R \sin(\zeta)
\end{array} \right)
\] may be implemented as follows\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=====start\_of\_circle=====================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Simple\ circle\ in\ 2D\ space.}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ x\ =\ X\_c\ +\ R\ \(\backslash\)cos(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ y\ =\ Y\_c\ +\ R\ \(\backslash\)sin(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }SimpleCircle\ :\ \textcolor{keyword}{public}\ GeomObject}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ \ Pass\ x\ and\ y-\/coords\ of\ centre\ and\ radius}}
\DoxyCodeLine{\textcolor{comment}{}\ SimpleCircle(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_c,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ y\_c,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\ :\ GeomObject(1,2),\ X\_c(x\_c),\ Y\_c(y\_c),\ R(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})}
\DoxyCodeLine{\ \ \{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Position\ Vector\ at\ Lagrangian\ coordinate\ zeta\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ position(\textcolor{keyword}{const}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Position\ vector}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[0]\ =\ X\_c+R*\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{cos}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}[0]);}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[1]\ =\ Y\_c+R*\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{sin}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}[0]);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Position\ Vector\ at\ Lagrangian\ coordinate\ zeta\ \ at\ time\ level\ t}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ (t=0:\ present;\ t>0:\ previous\ level).\ Steady\ object,\ so\ we\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ simply\ forward\ the\ call\ to\ the\ steady\ version.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ position(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{t}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{position(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}});\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{protected}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ X-\/coordinate\ of\ centre}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ X\_c;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Y-\/coordinate\ of\ centre}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ Y\_c;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Radius}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ R;}
\DoxyCodeLine{}
\DoxyCodeLine{\};\ \textcolor{comment}{//\ end\ of\ SimpleCircle\ class}}

\end{DoxyCodeInclude}


The shape and position of this {\ttfamily Geom\+Object} is defined by the parameters $ X_c, Y_c $ and $ R $ which are stored as double precision numbers in the object\textquotesingle{}s private member data.

In many applications (e.\+g. in free-\/boundary problems) it is necessary to regard some (or all) of the parameters that specify the object\textquotesingle{}s shape as (an) unknown(s) in the overall problem. Within {\ttfamily oomph-\/lib} all unknowns are values in {\ttfamily Data} objects. We refer to any {\ttfamily Data} objects whose values affect the shape of a {\ttfamily Geom\+Object} as the {\ttfamily Geom\+Object\textquotesingle{}s} geometric {\ttfamily Data}. The {\ttfamily Geom\+Object} class defines interfaces for two functions that provide access to such {\ttfamily Data}. The function


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{virtual}\ \textcolor{keywordtype}{unsigned}\ GeomObject::ngeom\_data()\ \textcolor{keyword}{const};}

\end{DoxyCode}


should return the number of geometric {\ttfamily Data} objects that affect a {\ttfamily Geom\+Object\textquotesingle{}s} shape and position. The function


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{virtual}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}*\ GeomObject::geom\_data\_pt(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{j}});}

\end{DoxyCode}


should return a pointer to the {\ttfamily Geom\+Object\textquotesingle{}s} {\ttfamily j} -\/ th geometric {\ttfamily Data} object. Both functions are implemented as "{}broken"{} virtual functions in the {\ttfamily Geom\+Object} base class in order to facilitate the creation of new {\ttfamily Geom\+Objects}. The functions should be overloaded in {\ttfamily Geom\+Objects} that actually contain geometric {\ttfamily Data}. If this is not done, the broken versions in the base class issue a suitable explanation before throwing an error.

Here is a re-\/implementation of the above {\ttfamily Geom\+Object} in a form that allows the the parameters $ X_c, Y_c $ and $ R $ to be regarded as unknowns, by storing them as values in a suitable {\ttfamily Data} object\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ GeneralCircle\ in\ 2D\ space.}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ x\ =\ X\_c\ +\ R\ \(\backslash\)cos(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ y\ =\ Y\_c\ +\ R\ \(\backslash\)sin(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ The\ three\ parameters\ \(\backslash\)f\$\ X\_c,\ Y\_c\ \(\backslash\)f\$\ and\ \(\backslash\)f\$\ R\ \(\backslash\)f\$\ are\ represented}}
\DoxyCodeLine{\textcolor{comment}{///\ by\ Data\ and\ can\ therefore\ be\ unknowns\ in\ the\ problem.}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }GeneralCircle\ :\ \textcolor{keyword}{public}\ GeomObject}
\DoxyCodeLine{\{}

\end{DoxyCodeInclude}
 The object has two constructors which we will discuss separately. The arguments to the first constructor specify the x-\/ and y-\/coordinates of the ring\textquotesingle{}s centre ( $ X_c$ and $ Y_c$), and its radius, $ R $, as double-\/precision numbers. The constructor creates storage for these values in the {\ttfamily Geom\+\_\+data\+\_\+pt} vector which is stored in the object\textquotesingle{}s protected member data. First, the {\ttfamily Geom\+\_\+data\+\_\+pt} vector (empty by default) is resized to provide storage for a (pointer to a) single Data item. Next we create a Data object that provides storage for three values and store the pointer to this {\ttfamily Data} object in the first (and only) component of the {\ttfamily Geom\+\_\+data\+\_\+pt} vector. Finally, we set the values to those specified by the arguments and pin them to reflect the fact that, by default, the values are constants rather than unknowns in the problem. \mbox{[}{\bfseries{Note\+:}} Clearly, there is some ambiguity as to how to distribute the values of the geometric parameters among the geometric {\ttfamily Data}. Here we chose to store the three values in a single {\ttfamily Data} object, but we could also have stored each value in its own {\ttfamily Data} object.\mbox{]}


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ \ Pass\ x\ and\ y-\/coords\ of\ centre\ and\ radius\ (all\ pinned)}}
\DoxyCodeLine{\ GeneralCircle(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_c,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ y\_c,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\ :\ GeomObject(1,2)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Create\ Data:\ We\ have\ one\ Data\ item\ with\ 3\ values.\ The\ Data\ object}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ stores\ the\ x\ position\ of\ the\ circle's\ centre\ as\ value\ 0,}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ the\ y\ position\ of\ the\ circle's\ centre\ as\ value\ 1,\ and\ the\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ circle's\ radius\ as\ value\ 2.}}
\DoxyCodeLine{\ \ \ Geom\_data\_pt.resize(1);}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}(3);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Assign\ data:\ X\_c\ -\/-\/\ the\ value\ is\ free\ by\ default:\ Need\ to\ pin\ it.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Pin\ the\ data}}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>pin(0);\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Give\ it\ a\ value:\ }}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>set\_value(0,x\_c);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Assign\ data:\ Y\_c\ -\/-\/\ the\ value\ is\ free\ by\ default:\ Need\ to\ pin\ it.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Pin\ the\ data}}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>pin(1);\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Give\ it\ a\ value:\ }}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>set\_value(1,y\_c);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Assign\ data:\ R\ -\/-\/\ the\ value\ is\ free\ by\ default:\ Need\ to\ pin\ it.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Pin\ the\ data}}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>pin(2);\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Give\ it\ a\ value:\ }}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]-\/>set\_value(2,\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ I've\ created\ the\ data,\ I\ need\ to\ clean\ up}}
\DoxyCodeLine{\ \ \ Must\_clean\_up=\textcolor{keyword}{true};\ }
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 With this constructor, the geometric {\ttfamily Data} that controls the shape of the object is created internally -- the "{}user"{} only specifies the values of the parameters. Their values are accessible via the access functions


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ to\ x-\/coordinate\ of\ centre\ of\ circle}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\&\ x\_c()\{\textcolor{keywordflow}{return}\ *Geom\_data\_pt[0]-\/>value\_pt(0);\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ to\ y-\/coordinate\ of\ centre\ of\ circle}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\&\ y\_c()\{\textcolor{keywordflow}{return}\ *Geom\_data\_pt[0]-\/>value\_pt(1);\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ to\ radius\ of\ circle}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\&\ R()\{\textcolor{keywordflow}{return}\ *Geom\_data\_pt[0]-\/>value\_pt(2);\}}

\end{DoxyCodeInclude}
 but their internal representation as (pinned) values of a {\ttfamily Data} object remains hidden. Access to the geometric {\ttfamily Data} is, however, possible via the functions


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ How\ many\ items\ of\ Data\ does\ the\ shape\ of\ the\ object\ depend\ on?}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ngeom\_data()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ Geom\_data\_pt.size();\}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Return\ pointer\ to\ the\ j-\/th\ Data\ item\ that\ the\ object's\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ shape\ depends\ on\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}*\ geom\_data\_pt(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{j}})\ \{\textcolor{keywordflow}{return}\ Geom\_data\_pt[\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{j}}];\}}

\end{DoxyCodeInclude}
 which overload the broken versions in the {\ttfamily Geom\+Object} base class. Both functions access the protected vector of pointers to the object\textquotesingle{}s geometric {\ttfamily Data\+:} 


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{keyword}{protected}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Vector\ of\ pointers\ to\ Data\ items\ that\ affects\ the\ object's\ shape}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<Data*>}}\ Geom\_data\_pt;}

\end{DoxyCodeInclude}
 The second constructor is appropriate for cases in which the {\ttfamily Data} object that specifies the object\textquotesingle{}s shape has already been created elsewhere. In this case, we simply pass the pointer to the Data object to the constructor and store it in the first entry of the {\ttfamily Geom\+\_\+data\+\_\+pt} vector\+:  
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Alternative\ constructor:\ \ Pass\ x\ and\ y-\/coords\ of\ centre\ and\ radius}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ (all\ as\ part\ of\ Data)}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ \(\backslash\)code\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Geom\_data\_pt[0]-\/>value(0)\ =\ X\_c;}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Geom\_data\_pt[0]-\/>value(1)\ =\ Y\_c;}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Geom\_data\_pt[0]-\/>value(2)\ =\ R;}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ \(\backslash\)endcode}}
\DoxyCodeLine{\textcolor{comment}{}\ GeneralCircle(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}*\ geom\_data\_pt)\ :\ GeomObject(1,2)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ PARANOID}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (geom\_data\_pt-\/>nvalue()!=3)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ std::ostringstream\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}};}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}}\ <<\ \textcolor{stringliteral}{"{}Geometric\ Data\ must\ have\ 3\ values,\ not\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ geom\_data\_pt-\/>nvalue()\ <<\ std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OomphLibError}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}}.str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_CURRENT\_FUNCTION}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_EXCEPTION\_LOCATION}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\ \ \ Geom\_data\_pt.resize(1);}
\DoxyCodeLine{\ \ \ Geom\_data\_pt[0]=geom\_data\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Data\ has\ been\ created\ externally:\ Must\ not\ clean\ up}}
\DoxyCodeLine{\ \ \ Must\_clean\_up=\textcolor{keyword}{false};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//end\ of\ alternative\ constructor}}

\end{DoxyCodeInclude}


The boolean flag {\ttfamily Must\+\_\+clean\+\_\+up} is stored as private member data in the class. It is used in the destructor to decide if the geometric {\ttfamily Data} should be deleted. If the {\ttfamily Data} was created internally by the object (i.\+e. if the first constructor was used), the {\ttfamily Data} must also be deleted by the object; if the {\ttfamily Data} was created externally (i.\+e. if the second constructor was used), the {\ttfamily Data} must not be deleted as it may still be required in other parts of the code.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor:\ \ Clean\ up\ if\ necessary}}
\DoxyCodeLine{\ \textcolor{keyword}{virtual}\ \string~GeneralCircle()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Do\ I\ need\ to\ clean\ up?}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (Must\_clean\_up)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ ngeom\_data=Geom\_data\_pt.size();}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}=0;\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}<ngeom\_data;\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}++)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ Geom\_data\_pt[\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}];}
\DoxyCodeLine{\ \ \ \ \ \ \ Geom\_data\_pt[\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}]=0;}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ destructor}}

\end{DoxyCodeInclude}
 The function {\ttfamily Geom\+Object\+::position(...)} simply extracts the relevant parameters ( $ X_c, Y_c, R $) from the {\ttfamily Geom\+\_\+data\+\_\+pt} vector and computes the position vector as a function of the 1D Lagrangian coordinate $ \zeta $\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Position\ Vector\ at\ Lagrangian\ coordinate\ zeta\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{void}\ position(\textcolor{keyword}{const}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Extract\ data}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ X\_c=\ Geom\_data\_pt[0]-\/>value(0);}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ Y\_c=\ Geom\_data\_pt[0]-\/>value(1);}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ R=\ Geom\_data\_pt[0]-\/>value(2);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Position\ vector}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[0]\ =\ X\_c+R*\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{cos}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}[0]);}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[1]\ =\ Y\_c+R*\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{sin}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}[0]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ position(...)}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_example}{}\doxysection{\texorpdfstring{Part 2\+: Upgrading a Geom\+Object to a Generalised\+Element}{Part 2: Upgrading a GeomObject to a GeneralisedElement}}\label{index_example}
We will now consider a (toy!) problem in which the ability to treat a parameter that specifies the shape and/or the position of a geometric object as an unknown (i.\+e. as a value in a {\ttfamily Data} object) is essential\+: A circular ring of radius $ R $ is mounted on a linearly elastic spring of stiffness $ k_{stiff} $. We wish to find the ring\textquotesingle{}s equilibrium position when it is subjected to a vertical load, $ f_{load} $.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{circle_as_element_sketch}
\doxyfigcaption{Sketch of the example problem. }
\end{DoxyImage}


To solve this problem with {\ttfamily oomph-\/lib} \mbox{[}Yes, the solution is $ Y_c = f_{load}/k_{stiff}$ but let\textquotesingle{}s pretend we don\textquotesingle{}t know this...\mbox{]}, we employ C++ inheritance to "{}upgrade"{} the {\ttfamily General\+Circle} object, discussed above, to a {\ttfamily Generalised\+Element} in which the vertical position of the ring, $ Y_c
$, is one of the unknowns whose value is determined by the equilibrium equation (in residual form),  \[
 f_{load} - Y_c \ k_{stiff} = 0. \ \ \ \ \ \ \ \ \ \ \ (1)
\] In the present problem, the load on the ring is a control parameter, but in different applications it may be an unknown whose value has to be determined as part of the solution. (For instance, in fluid-\/structure interaction problems, the load on an elastic structure depends on the unknowns in the adjacent fluid elements.) Therefore, we also represent $ f_{load} $ by a {\ttfamily Data} object.

To solve the above problem with {\ttfamily oomph-\/lib}, the residual equation (1) must be implemented in the {\ttfamily get\+\_\+residuals(...)} function of a suitable {\ttfamily Generalised\+Element}. Recall that the elemental residual vector computed by a {\ttfamily Generalised\+Element} can depend on two types of {\ttfamily Data\+:} 
\begin{DoxyItemize}
\item {\bfseries{Internal {\itshape Data}}} stores values that are "{}internal"{} to the element, i.\+e. values that the element is "{}in charge of"{}. Such {\ttfamily Data} is accessible via the pointer-\/based access function {\ttfamily Generalised\+Element\+::internal\+\_\+data\+\_\+pt(...)} 
\item {\bfseries{External {\itshape Data}}} stores values that are "{}external"{} to the element. The values stored in such {\ttfamily Data} {\itshape affect} the element\textquotesingle{}s residual vector but its values are not determined {\itshape by} the element. Such {\ttfamily Data} is accessible via the pointer-\/based access function {\ttfamily Generalised\+Element\+::external\+\_\+data\+\_\+pt(...)} 
\end{DoxyItemize}In the present context, it is most natural to regard the {\ttfamily General\+Circle\textquotesingle{}s} geometric {\ttfamily Data} as internal to the element and the load {\ttfamily Data} as external.

Here is the class definition for the {\ttfamily Elastically\+Supported\+Ring\+Element} which combines the {\ttfamily Generalised\+Element} and {\ttfamily General\+Circle} classes by multiple inheritance. Its role as a {\ttfamily Geom\+Object} allows the object to be used in the parametrisation of domain boundaries; its role as a {\ttfamily Generalised\+Element} allows the value of $ Y_c $ to be determined as part of the solution.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//===========start\_of\_general\_circle=========================================}}
\DoxyCodeLine{\textcolor{comment}{///\ GeneralCircle\ "{}upgraded"{}\ to\ a\ GeneralisedElement:\ Circular\ }\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ ring\ whose\ position\ is\ given\ by}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ x\ =\ X\_c\ +\ R\ \(\backslash\)cos(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[\ y\ =\ Y\_c\ +\ R\ \(\backslash\)sin(\(\backslash\)zeta)\ \ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ The\ ring's\ vertical\ position\ \(\backslash\)f\$\ Y\_c\ \(\backslash\)f\$\ is}}
\DoxyCodeLine{\textcolor{comment}{///\ determined\ by\ "{}pseudo\ elasticity"{}:}}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f[}}
\DoxyCodeLine{\textcolor{comment}{///\ 0\ =\ f\_\{load\}\ -\/\ Y\_c\ \(\backslash\)\ k\_\{stiff\}\ }}
\DoxyCodeLine{\textcolor{comment}{///\ \(\backslash\)f]}}
\DoxyCodeLine{\textcolor{comment}{///\ This\ simulates\ the\ case\ where\ the\ centre\ of\ the\ ring\ is\ mounted\ on\ }}
\DoxyCodeLine{\textcolor{comment}{///\ an\ elastic\ spring\ of\ stiffness\ \(\backslash\)f\$\ k\_\{stiff\}\ \(\backslash\)f\$\ and\ loaded\ by\ }}
\DoxyCodeLine{\textcolor{comment}{///\ the\ force\ \(\backslash\)f\$\ f\_\{load\}.\ \(\backslash\)f\$\ The\ "{}load"{}\ is\ specified\ by\ the\ }}
\DoxyCodeLine{\textcolor{comment}{///\ Data\ object\ \(\backslash\)c\ load\_pt().\ }}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{GeneralisedElement}},\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ GeneralCircle}

\end{DoxyCodeInclude}


The arguments to the constructor specify the initial geometric parameters, $ X_c, Y_c $ and $ R $. We pass them to the constructor of the {\ttfamily General\+Circle} object and assign a default value for the spring stiffness $ k_{stiff}$ (stored as a private data member of the class; see below)\+:  
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ Build\ \ ring\ from\ doubles\ that\ describe\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ geometry:\ x\ and\ y\ positions\ of\ centre\ and\ the\ radius.}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Initialise\ stiffness\ to\ 1.0.\ By\ default,\ no\ load\ is\ set.}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_c,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ y\_c,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}})\ :\ }
\DoxyCodeLine{\ \ GeneralCircle(x\_c,y\_c,\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}),\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{K\_stiff}}(1.0),\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Load\_data\_has\_been\_set}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{false}})}

\end{DoxyCodeInclude}
 Next, we add the {\ttfamily General\+Circle\textquotesingle{}s} geometric {\ttfamily Data} (created automatically by the constructor of the {\ttfamily General\+Circle} object; see above) into the element\textquotesingle{}s storage for its internal {\ttfamily Data}. This ensures that the geometric {\ttfamily Data} is included in the element\textquotesingle{}s equation numbering procedures. Within the context of the {\ttfamily General\+Circle}, all geometric parameters were regarded as constants and their values were pinned. Here, the vertical position \mbox{[}stored in the second entry in the geometric {\ttfamily Data}\mbox{]} is unknown, therefore we un-\/pin it.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ The\ geometric\ data\ is\ internal\ to\ the\ element\ -\/-\/\ we\ copy\ the\ pointers}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ to\ the\ GeomObject's\ geometric\ data\ to\ the\ element's\ internal\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ data\ to\ ensure\ that\ any\ unknown\ values\ of\ geometric\ data\ are\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ given\ global\ equation\ numbers.\ The\ add\_internal\_data(...)}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ function\ returns\ the\ index\ by\ which\ the\ added\ Data\ item}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ is\ accessible\ from\ internal\_data\_pt(...).\ }}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Internal\_geometric\_data\_index}}=\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{add\_internal\_data}}(Geom\_data\_pt[0]);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Geometric\ Data\ for\ the\ GeomObject\ has\ been\ set\ up\ (and\ pinned)\ in}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ constructor\ for\ geometric\ object.\ Now\ free\ the\ y-\/position\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ of\ the\ centre\ because\ we\ want\ to\ determine\ it\ as\ an\ unknown}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{internal\_data\_pt}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Internal\_geometric\_data\_index}})-\/>unpin(1);}

\end{DoxyCodeInclude}
 Once {\ttfamily Data} has been added to a {\ttfamily Generalised\+Element\textquotesingle{}s} internal {\ttfamily Data}, it is deleted by the destructor of the {\ttfamily Generalised\+Element} when the {\ttfamily Generalised\+Element} goes out of scope. The {\ttfamily Data} must therefore not be deleted again by the destructor of the {\ttfamily General\+Circle} class, and we change the cleanup responsibilities accordingly\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Change\ cleanup\ responsibilities:\ The\ GeomData\ will\ now\ be\ killed}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ by\ the\ GeneralisedElement\ when\ it\ wipes\ its\ internal\ Data}}
\DoxyCodeLine{\ \ \ Must\_clean\_up=\textcolor{keyword}{false};}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}


Since the {\ttfamily Generalised\+Element\textquotesingle{}s} destructor will delete the internal {\ttfamily Data}, the destructor can remain empty\+: 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor:\ }}
\DoxyCodeLine{\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{\string~ElasticallySupportedRingElement}}()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ The\ GeomObject's\ GeomData\ is\ mirrored\ in\ the\ element's}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Internal\ Data\ and\ therefore\ gets\ wiped\ in\ the}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ destructor\ of\ GeneralisedElement\ -\/-\/>\ No\ need\ to\ kill\ it\ here}}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 The {\ttfamily Data} whose one-\/and-\/only value represents the load must be set by the "{}user"{}, using the function {\ttfamily set\+\_\+load\+\_\+pt(...)} As discussed above, we store the pointer to the load {\ttfamily Data} object in the {\ttfamily Generalised\+Element\textquotesingle{}s} external {\ttfamily Data} and record its index within that storage scheme.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Set\ pointer\ to\ Data\ object\ that\ specifies\ the\ "{}load"{}}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ on\ the\ ElasticallySupportedRingElement}}
\DoxyCodeLine{\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{set\_load\_pt}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}*\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{load\_pt}})}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ PARANOID}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{load\_pt}}-\/>nvalue()!=1)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ std::ostringstream\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}};}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}}\ <<\ \textcolor{stringliteral}{"{}The\ data\ object\ that\ stores\ the\ load\ on\ the\ "{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}ElasticallySupportedRingElement\(\backslash\)n"{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}should\ only\ contain\ a\ single\ data\ value\(\backslash\)n"{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}This\ one\ contains\ "{}}\ <<\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{load\_pt}}-\/>nvalue()\ <<\ std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OomphLibError}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{error\_stream}}.str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_CURRENT\_FUNCTION}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_EXCEPTION\_LOCATION}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Add\ load\ to\ the\ element's\ external\ data\ and\ store}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ its\ index\ within\ that\ storage\ scheme:\ Following\ this\ assignment,\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ the\ load\ Data\ is\ accessible\ from}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ GeneralisedElement::external\_data\_pt(External\_load\_index)}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{External\_load\_index}}\ =\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{add\_external\_data}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{load\_pt}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Load\ has\ now\ been\ set}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Load\_data\_has\_been\_set}}=\textcolor{keyword}{true};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ set\_load\_pt(...)}}

\end{DoxyCodeInclude}
 \mbox{[}Note the sanity check which asserts that the load {\ttfamily Data} object only contains a single value; see \doxysectlink{index_notes}{Comments and Exercises}{1} for a further discussion of this aspect.\mbox{]}

The {\ttfamily load()} function provides access to the load specified by the load {\ttfamily Data}. It returns zero if no load was set -- a sensible default.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ "{}Load"{}\ acting\ on\ the\ ring}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ load()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Return\ the\ load\ if\ it\ has\ been\ set}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Load\_data\_has\_been\_set}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{external\_data\_pt}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{External\_load\_index}})-\/>value(0);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ ...otherwise\ return\ zero\ load}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ load()}}

\end{DoxyCodeInclude}


Next, we provide an access functions to the spring stiffness parameter, 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ for\ the\ spring\ stiffness}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{k\_stiff}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{K\_stiff}};\}}

\end{DoxyCodeInclude}
 and functions that allow the vertical displacement of the ring to be pinned and un-\/pinned\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pin\ the\ vertical\ displacement}}
\DoxyCodeLine{\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{pin\_yc}}()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Vertical\ position\ of\ centre\ is\ stored\ as\ value\ 1\ in\ the}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ element's\ one\ and\ only\ internal\ Data\ object.}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{internal\_data\_pt}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Internal\_geometric\_data\_index}})-\/>pin(1);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Unpin\ the\ vertical\ displacement}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{unpin\_yc}}()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Vertical\ position\ of\ centre\ is\ stored\ as\ value\ 1\ in\ the}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ element's\ one\ and\ only\ internal\ Data\ object.}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{internal\_data\_pt}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Internal\_geometric\_data\_index}})-\/>unpin(1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ unpin\_yc()}}

\end{DoxyCodeInclude}
 Finally, we implement the pure virtual functions {\ttfamily Generalised\+Element\+::get\+\_\+jacobian(...)} and {\ttfamily Generalised\+Element\+::get\+\_\+residuals(...)} which are required to make the element functional. These functions must compute the element\textquotesingle{}s contributions to the {\ttfamily Problem\textquotesingle{}s} global residual vector and Jacobian matrix. As usual, we implement them as wrappers to a single function that computes the residual and (optionally) the Jacobian matrix\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Compute\ element\ residual\ vector\ (wrapper)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{get\_residuals}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\ \&\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}})}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Initialise\ residuals\ to\ zero}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}}.initialise(0.0);}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Create\ a\ dummy\ matrix}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{DenseMatrix<double>}}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{dummy}}(1);}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Call\ the\ generic\ residuals\ function\ with\ flag\ set\ to\ 0}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{fill\_in\_generic\_residual\_contribution}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{dummy}},0);}
\DoxyCodeLine{\ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Compute\ element\ residual\ Vector\ and\ element\ Jacobian\ matrix\ (wrapper)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{get\_jacobian}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\ \&\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{DenseMatrix<double>}}\ \&\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}})}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Initialise\ residuals\ to\ zero}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}}.initialise(0.0);}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Initialise\ the\ jacobian\ matrix\ to\ zero}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}}.initialise(0.0);}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Call\ the\ generic\ routine\ with\ the\ flag\ set\ to\ 1}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{fill\_in\_generic\_residual\_contribution}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}},1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ get\_jacobian(...)}}

\end{DoxyCodeInclude}
 The "{}real work"{} is done in the protected member function {\ttfamily get\+\_\+residuals\+\_\+generic(...)}, where we distinguish two cases.
\begin{DoxyEnumerate}
\item The load is prescribed, i.\+e. the (single) value in the load {\ttfamily Data} object is pinned. In this case, the element\textquotesingle{}s {\ttfamily Data} contains only one unknown -- the vertical displacement $ Y_c $, stored as value 1 in the internal {\ttfamily Data}. The element\textquotesingle{}s residual vector has a single entry, given by  \[
   {\tt r}_0 = f_{load} - Y_c \ k_{stiff}
   \] and the element\textquotesingle{}s Jacobian matrix is a 1x1 matrix whose single entry is given by  \[  
   {\tt J}_{00} = \frac{\partial {\tt r}_0}{\partial Y_c} =  - k_{stiff} 
   \]~\newline

\item If the load is unknown (i.\+e. an unknown in the overall problem) the element\textquotesingle{}s {\ttfamily Data} contains two unknowns. Recall that an element only makes a contribution to the residuals associated with unknowns that it is "{}in charge of"{} -- the external {\ttfamily Data} is assumed to be "{}determined"{} by another element. Therefore, the elements residual vectors (i.\+e. its contribution to the {\ttfamily Problem\textquotesingle{}s} global residual vector) is given by  \[
   \left( \begin{array}{c}
   {\tt r}_0 \\
   {\tt r}_1
   \end{array} \right)
   =
   \left( \begin{array}{c}
   f_{load} - Y_c \ k_{stiff}\\
   0
   \end{array} \right).
   \] The element\textquotesingle{}s 2x2 Jacobian matrix contains the derivatives of the residuals with respect to the element\textquotesingle{}s unknowns, $ Y_c
   $ and $ f_{load}$,  \[  
   \left( \begin{array}{cc}
   {\tt J}_{00} &    {\tt J}_{01} \\
   {\tt J}_{10} &    {\tt J}_{11} 
   \end{array} \right)
   =
   \left( \begin{array}{cc}
   \partial {\tt r}_0 / \partial Y_c&
   \partial {\tt r}_0 / \partial f_{load}   \\
   \partial {\tt r}_1 / \partial Y_c  &
   \partial {\tt r}_1 / \partial f_{load}  
   \end{array} \right)
   =
   \left( \begin{array}{cc}
   - k_{stiff} & 1 \\
   0 & 0
   \end{array} \right)
   \]~\newline

\end{DoxyEnumerate}Note that we have (correctly!) assumed that the (fully automatic) local equation numbering procedure, implemented in {\ttfamily Generalised\+Element\+::assign\+\_\+local\+\_\+eqn\+\_\+numbers()}, regards the internal degree of freedom as local unknown "{}0"{} and the external one (if it exists) as unknown "{}1"{}. However, to be on the safe side, we determine the local equation numbers via the access functions {\ttfamily internal\+\_\+local\+\_\+eqn(i,j)} and {\ttfamily external\+\_\+local\+\_\+eqn(i,j)}, which return the local equation numbers of the j-\/th value, stored in the element\textquotesingle{}s i-\/th internal (or external) {\ttfamily Data} object\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Compute\ element\ residual\ Vector\ (only\ if\ flag=0)\ and\ also}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ element\ Jacobian\ matrix\ (if\ flag=1)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{fill\_in\_generic\_residual\_contribution}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\ \&\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{DenseMatrix<double>}}\ \&\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{flag}})}
\DoxyCodeLine{\ \ \{\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Find\ out\ how\ may\ dofs\ there\ are\ in\ the\ element}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{n\_dof}}\ =\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ndof}}();}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//If\ everything\ is\ pinned\ return\ straight\ away}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{n\_dof}}==0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Pseudo-\/elastic\ force\ balance\ to\ determine\ the\ position\ of\ the}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ ring's\ centre\ for\ a\ given\ load.}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ What's\ the\ local\ equation\ number\ of\ the\ force\ balance\ equation}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ [It's\ the\ equation\ that\ "{}determines"{}\ the\ value\ of\ the\ internal}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ dof,\ y\_c,\ which\ is\ stored\ as\ the\ second\ value\ of\ the\ one-\/and-\/only}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ internal\ data\ object\ in\ this\ element]}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_yc}}\ =\ }
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{internal\_local\_eqn}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Internal\_geometric\_data\_index}},1);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Add\ residual\ to\ appropriate\ entry\ in\ the\ element's\ residual}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ vector:}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{residuals}}[\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_yc}}]=load()-\/\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{K\_stiff}}*y\_c();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Work\ out\ Jacobian:\ }}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{flag}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Derivative\ of\ residual\ w.r.t.\ the\ internal\ dof,\ i.e.\ the\ vertical}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ position\ of\ the\ ring's\ centre:\ d\ residual[0]/d\ y\_c}}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_yc}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_yc}})\ =\ -\/\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{K\_stiff}};}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Derivative\ with\ respect\ to\ external\ dof,\ i.e.\ the\ applied\ }}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ load:\ d\ residual[0]/d\ load\ -\/-\/\ but\ only\ if\ the\ load\ is\ an\ unknown}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{n\_dof}}==2)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ What's\ the\ local\ equation\ number\ of\ the\ load\ parameter?}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ It's\ stored\ as\ the\ 0th\ value\ in\ the\ the\ element's}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ one-\/and-\/only\ external\ data\ item:}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_load}}\ =\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{external\_local\_eqn}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{External\_load\_index}},0);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#ifdef\ PARANOID}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_load}}<0)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OomphLibError}}(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Load\ is\ pinned\ and\ yet\ n\_dof=2?\(\backslash\)n\ This\ is\ very\ fishy!\(\backslash\)n"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_CURRENT\_FUNCTION}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{OOMPH\_EXCEPTION\_LOCATION}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ entry\ into\ element\ Jacobian}}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{jacobian}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_yc}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{local\_eqn\_number\_for\_load}})\ =\ 1.0;}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ of\ get\_residuals\_generic(...)}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_driver}{}\doxysection{\texorpdfstring{Part 3\+: The driver code}{Part 3: The driver code}}\label{index_driver}
Finally, we provide an example that shows our {\ttfamily Elastically\+Supported\+Ring\+Element} in action. The animation below shows the result of the computational simulation of the toy problem described at the beginning of the previous section\+: An elastically supported ring, subjected to a vertical load. The animation shows the position of the ring for various values of the load.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{circle_as_element}
\doxyfigcaption{Vertical displacement of a Circle, mounted on an elastic support. }
\end{DoxyImage}


\DoxyHorRuler{0}
\hypertarget{index_main}{}\doxysubsection{\texorpdfstring{The driver code}{The driver code}}\label{index_main}
The driver builds the {\ttfamily Problem} object and solves the problem for various load levels\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//===============start\_of\_driver==========================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Driver\ }}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{circle_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ up\ the\ problem\ }}
\DoxyCodeLine{\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem}{GeomObjectAsGeneralisedElementProblem}}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}};}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Initial\ value\ for\ the\ load\ }}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}}.\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a47149c35c94b2ab99507a0a74fe35823}{load}}()=-\/0.3;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ for\ different\ loads}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ steps}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{nstep}}=5;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Increment\ in\ load}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{dp}}=0.6/\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{double}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{nstep}}-\/1);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{istep}}=0;\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{istep}}<\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{nstep}};\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{istep}}++)}
\DoxyCodeLine{\ \ \{\ \ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Solve/doc}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}}.newton\_solve();}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}}.doc\_solution();}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Increment\ counter\ for\ solutions\ }}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}}.doc\_info().number()++;\ \ \ \ }
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Change\ load\ on\ ring}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{problem}}.load()+=\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{dp}};}
\DoxyCodeLine{\ \ \}\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\ of\ driver}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
\hypertarget{index_class}{}\doxysubsection{\texorpdfstring{The problem class definition}{The problem class definition}}\label{index_class}
Here is the problem class definition which requires little comment\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//======start\_of\_problem==============================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Problem\ to\ demonstrate\ the\ use\ of\ a\ GeomObject\ as\ a\ }\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ GeneralisedElement:\ A\ geometric\ object\ (a\ Circle)\ is\ "{}upgraded"{}}}
\DoxyCodeLine{\textcolor{comment}{///\ to\ a\ GeneralisedElement.\ The\ position\ of\ the\ Circle\ is}}
\DoxyCodeLine{\textcolor{comment}{///\ determined\ by\ a\ balance\ of\ forces,\ assuming\ that\ the}}
\DoxyCodeLine{\textcolor{comment}{///\ Circle\ is\ mounted\ on\ an\ elastic\ spring\ of\ specified}}
\DoxyCodeLine{\textcolor{comment}{///\ stiffness\ and\ loaded\ by\ a\ vertical\ "{}load"{}.\ }}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem}{GeomObjectAsGeneralisedElementProblem}}\ :\ \textcolor{keyword}{public}\ Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ad1f15fcb6c055c58d1f71b522f1f7bd6}{GeomObjectAsGeneralisedElementProblem}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ the\ problem\ specs\ after\ solve\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_af396d1789e2552c43e0c68561d88d473}{actions\_after\_newton\_solve}}()\{\}}
\DoxyCodeLine{\ \ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ the\ problem\ specs\ before\ solve\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a4ae01862ddbbeeacca1ce7a444e28931}{actions\_before\_newton\_solve}}()\ \{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a5092be8e6172d6c9147115bdd485db35}{doc\_solution}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Return\ value\ of\ the\ "{}load"{}\ on\ the\ elastically\ supported\ ring}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a47149c35c94b2ab99507a0a74fe35823}{load}}()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ *\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ac04469b2dbce010fff3f5b2cf5591bcd}{Load\_pt}}-\/>value\_pt(0);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ to\ DocInfo\ object}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{DocInfo}}\&\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_af21708459753b56b407f4e70d1cfe795}{doc\_info}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a89a7f5fa555839193166f802d6ff6be2}{Doc\_info}};\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Trace\ file}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ofstream}}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ad6261e556a52596ba8904ee902ea6d70}{Trace\_file}};}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ data\ item\ that\ stores\ the\ "{}load"{}\ on\ the\ ring}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}*\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ac04469b2dbce010fff3f5b2cf5591bcd}{Load\_pt}};}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ info\ object}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{DocInfo}}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a89a7f5fa555839193166f802d6ff6be2}{Doc\_info}};}
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
\hypertarget{index_constructor}{}\doxysubsection{\texorpdfstring{The problem constructor}{The problem constructor}}\label{index_constructor}
In the problem constructor, we create the (single) {\ttfamily Elastically\+Supported\+Ring\+Element} and and assign a value to its "{}spring stiffness"{} parameter. 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=============================start\_of\_problem\_constructor===============}}
\DoxyCodeLine{\textcolor{comment}{///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ad1f15fcb6c055c58d1f71b522f1f7bd6}{GeomObjectAsGeneralisedElementProblem::GeomObjectAsGeneralisedElementProblem}}()}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ coordinates\ and\ radius\ for\ the\ circle}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ x\_c=0.5;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ y\_c=0.0;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ R=1.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ GeomObject\ that's\ been\ upgraded\ to\ a\ GeneralisedElement}}
\DoxyCodeLine{\ \textcolor{comment}{//\ GeneralisedElement*\ }}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}*\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{geom\_object\_element\_pt}}\ =\ }
\DoxyCodeLine{\ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}(x\_c,y\_c,R);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ the\ stiffness\ of\ the\ elastic\ support}}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{geom\_object\_element\_pt}}-\/>k\_stiff()=0.3;}

\end{DoxyCodeInclude}
 Next, we create the problem\textquotesingle{}s mesh\+: We start by creating an (empty) {\ttfamily Mesh} object and then add the (pointer to the) newly created {\ttfamily Elastically\+Supported\+Ring\+Element} (in its incarnation as a {\ttfamily Generalised\+Element}) to it\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ mesh}}
\DoxyCodeLine{\ mesh\_pt()=\textcolor{keyword}{new}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Mesh}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ So\ far,\ the\ mesh\ is\ completely\ empty.\ Let's\ add\ the\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ one\ (and\ only!)\ GeneralisedElement\ to\ it:}}
\DoxyCodeLine{\ mesh\_pt()-\/>add\_element\_pt(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{geom\_object\_element\_pt}});}

\end{DoxyCodeInclude}
 As discussed in the previous section, the load must be specified as a {\ttfamily Data} object that stores a single value. In our example, the load is prescribed (i.\+e. not an unknown in the problem) therefore the value must be pinned\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \textcolor{comment}{//\ Create\ the\ load\ (a\ Data\ object\ with\ a\ single\ value)}}
\DoxyCodeLine{\ Load\_pt=\textcolor{keyword}{new}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Data}}(1);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \textcolor{comment}{//\ The\ load\ is\ prescribed\ so\ its\ one-\/and-\/only\ value\ is\ pinned}}
\DoxyCodeLine{\ Load\_pt-\/>pin(0);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ the\ pointer\ to\ the\ Data\ object\ that\ specifies\ the\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ load\ on\ the\ ring}}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{geom\_object\_element\_pt}}-\/>set\_load\_pt(Load\_pt);}

\end{DoxyCodeInclude}
 Finally, we set up the equation numbering scheme, set the output directory and open a trace file in which we will document the load/displacement characteristics.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ equation\ numbering\ scheme.}}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{cout}}\ <<\textcolor{stringliteral}{"{}Number\ of\ equations:\ "{}}\ <<\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{assign\_eqn\_numbers}}()\ <<\ std::endl;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ output\ directory}}
\DoxyCodeLine{\ Doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT"{}});\ }
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Open\ trace\ file}}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}}[100];}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{sprintf}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}},\textcolor{stringliteral}{"{}\%s/trace.dat"{}},Doc\_info.directory().c\_str());}
\DoxyCodeLine{\ Trace\_file.open(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}});}
\DoxyCodeLine{\ Trace\_file\ <<\ \textcolor{stringliteral}{"{}VARIABLES=\(\backslash\)"{}load\(\backslash\)"{},\(\backslash\)"{}y<sub>circle</sub>\(\backslash\)"{}"{}}\ <<\ std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\ of\ constructor}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
\hypertarget{index_post}{}\doxysubsection{\texorpdfstring{The post-\/processing function}{The post-processing function}}\label{index_post}
The post-\/processing routine is straightforward and is listed only to highlight the need to cast the pointer to the {\ttfamily Generalised\+Element} (as returned by {\ttfamily Mesh\+::element\+\_\+pt(...)}) to the specific element used here -- obviously, a {\ttfamily Generalised\+Element} does not have member functions that return the load on the ring or its vertical displacement.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//===========================start\_of\_doc\_solution========================}}
\DoxyCodeLine{\textcolor{comment}{///\ Doc\ the\ solution\ in\ tecplot\ format.}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a5092be8e6172d6c9147115bdd485db35}{GeomObjectAsGeneralisedElementProblem::doc\_solution}}()}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ofstream}}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{some\_file}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}}[100];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ plot\ points}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{npts}}=100;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Lagrangian\ coordinate\ and\ position\ vector\ (both\ as\ vectors)}}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}(1);}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{Vector<double>}}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}(2);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ solution\ }}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{sprintf}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}},\textcolor{stringliteral}{"{}\%s/soln\%i.dat"{}},\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a89a7f5fa555839193166f802d6ff6be2}{Doc\_info}}.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a89a7f5fa555839193166f802d6ff6be2}{Doc\_info}}.number());}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{some\_file}}.open(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{filename}});}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}=0;\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}<\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{npts}};\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}}++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}}[0]=2.0*MathematicalConstants::Pi*\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{double}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{i}})/\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{double}}(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{npts}}-\/1);}
\DoxyCodeLine{\ \ \ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}*\textcolor{keyword}{>}(mesh\_pt()-\/>element\_pt(0))-\/>}
\DoxyCodeLine{\ \ \ \ position(\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{zeta}},\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}});\ \ }
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{some\_file}}\ <<\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[0]\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{r}}[1]\ <<\ std::endl;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{some\_file}}.close();}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Write\ "{}load"{}\ and\ vertical\ position\ of\ the\ ring's\ centre}}
\DoxyCodeLine{\ \mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_ad6261e556a52596ba8904ee902ea6d70}{Trace\_file}}\ }
\DoxyCodeLine{\ \ <<\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\ \ \ mesh\_pt()-\/>element\_pt(0))-\/>\mbox{\hyperlink{classGeomObjectAsGeneralisedElementProblem_a47149c35c94b2ab99507a0a74fe35823}{load}}()}
\DoxyCodeLine{\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ <<\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{algebraic__free__boundary__poisson_8cc_abb923e967929c29b3a4fa1693604952a}{ElasticallySupportedRingElement}}*\textcolor{keyword}{>}(}
\DoxyCodeLine{\ \ \ mesh\_pt()-\/>element\_pt(0))-\/>y\_c()}
\DoxyCodeLine{\ \ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{\ \ <<\ std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\ of\ doc\_solution}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_notes}{}\doxysection{\texorpdfstring{Comments and Exercises}{Comments and Exercises}}\label{index_notes}
\hypertarget{index_ex}{}\doxysubsection{\texorpdfstring{Exercises}{Exercises}}\label{index_ex}

\begin{DoxyEnumerate}
\item In the current implementation of the {\ttfamily Elastically\+Supported\+Ring\+Element}, the load {\ttfamily Data} must only store a single value\+: Generalise this to the case where the {\ttfamily Data} object can contain an arbitrary number of values. You could add an additional argument to the {\ttfamily set\+\_\+load\+\_\+pt(...)} function to specify which value in the {\ttfamily Data} object represents the load. Think carefully in which other parts of the code this index will be required. ~\newline
~\newline

\end{DoxyEnumerate}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/interaction/free_boundary_poisson/
}{\texttt{ demo\+\_\+drivers/interaction/free\+\_\+boundary\+\_\+poisson/ }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/interaction/free_boundary_poisson/geom_object_element.cc
}{\texttt{ demo\+\_\+drivers/interaction/free\+\_\+boundary\+\_\+poisson/geom\+\_\+object\+\_\+element.\+cc }} \end{center} 
\end{DoxyItemize}\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
