\chapter{Mesh generation based on Geompack++}
\hypertarget{index}{}\label{index}\index{Mesh generation based on Geompack++@{Mesh generation based on Geompack++}}
In this document we demonstrate how to generate quadrilateral {\ttfamily oomph-\/lib} meshes, based on the output from Barry Joe\textquotesingle{}s mesh generator \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++}, }} available as freeware at \href{http://members.shaw.ca/bjoe/}{\texttt{ http\+://members.\+shaw.\+ca/bjoe/.}} The mesh generation is performed in a two-\/stage process. First we use \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} to generate the mesh "{}offline"{}. Then we process the output files generated by ~\newline
 \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} to generate an {\ttfamily oomph-\/lib} mesh.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_geompack_use}{}\doxysection{\texorpdfstring{Example of the use of Geompack++}{Example of the use of Geompack++}}\label{index_geompack_use}
The documents {\ttfamily meshoper.\+pdf} and {\ttfamily regmesh.\+pdf} distributed with \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} contain a comprehensive User\textquotesingle{}s Guide for the code and its many options. \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} is a very sophisticated mesh generator and can be used to create 2D and 3D meshes with a wide variety of element types. Here we only discuss how to use \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} to generate 2D quadrilateral meshes. \mbox{[}The development of of {\ttfamily oomph-\/lib} meshes that process \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++\textquotesingle{}s} }} output for other element types should be straightforward but is still on our "{}\+To Do"{} list -- any volunteers?\mbox{]}

\href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} creates quadrilateral meshes, based on the information about the mesh boundaries (nodes and curves) provided in two input files, {\ttfamily filename.\+rg2} and {\ttfamily filename.\+cs2}, say. An output file, {\ttfamily filename.\+1.\+mh2} is created. It contains the information about the mesh boundaries, the nodal positions and the element connectivity lists.

\DoxyHorRuler{0}
\hypertarget{index_geomview}{}\doxysubsection{\texorpdfstring{How to visualise a mesh generated by Geompack++}{How to visualise a mesh generated by Geompack++}}\label{index_geomview}
To visualise the mesh, the program {\ttfamily Geomview} is available. ({\ttfamily Geomview} can be downloaded from the \href{http://www.geomview.org/}{\texttt{ {\ttfamily Geomview} home page }}.) The \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} output file cannot be processed directly by \href{http://www.geomview.org/}{\texttt{ {\ttfamily Geomview} }} but a simple program that converts the file {\ttfamily filename.\+mh2} to a format that is readable by \href{http://www.geomview.org/}{\texttt{ {\ttfamily Geomview} }} is \href{../../../../demo_drivers/meshing/mesh_from_geompack/convert_geom_file.cc}{\texttt{ available.}}

\DoxyHorRuler{0}
\hypertarget{index_example}{}\doxysubsection{\texorpdfstring{The example\+: A rectangle with a hole}{The example: A rectangle with a hole}}\label{index_example}
As an example we demonstrate how to use \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} to generate a mesh for the rectangular domain with a hole shown in the figure below. The domain is defined by eight nodes and eight curves (straight lines) which connect the nodes and define two boundaries. ~\newline
 The boundary numbers shown in the sketch correspond to those in the \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} input region file \href{../../../../demo_drivers/meshing/mesh_from_geompack/box_hole.rg2}{\texttt{ box\+\_\+hole.\+rg2 }} and in the curve input file \href{../../../../demo_drivers/meshing/mesh_from_geompack/box_hole.cs2}{\texttt{ box\+\_\+hole.\+cs2.}} In the corresponding {\ttfamily oomph-\/lib} mesh, the boundaries are numbered from zero.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{box_hole_2}
\doxyfigcaption{A rectangular domain with a hole. }
\end{DoxyImage}


The desired mesh characteristics are defined in the file \href{../../../../demo_drivers/meshing/mesh_from_geompack/box_hole.m2}{\texttt{ box\+\_\+hole.\+m2}} which specifies that the final mesh should contain approximately 200 elements. When processed with the command 
\begin{DoxyCode}{0}
\DoxyCodeLine{./geompack++\ box\_hole.m2\ error.log}

\end{DoxyCode}
 \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++ }}} creates the output file \href{../../../../demo_drivers/meshing/mesh_from_geompack/box_hole.mh2}{\texttt{ box\+\_\+hole.\+mh2.}}

Here is a sketch of the resulting discretisation, as displayed by {\ttfamily geomview} \+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{geomview_box_screenshot}
\doxyfigcaption{Screenshot of geomview, showing the discretisation of the rectangular domain with a hole. }
\end{DoxyImage}


\DoxyHorRuler{0}
\hypertarget{index_oomph_use}{}\doxysection{\texorpdfstring{Creating an oomph-\/lib mesh based on output files generated by Geompack++}{Creating an oomph-lib mesh based on output files generated by Geompack++}}\label{index_oomph_use}
{\ttfamily oomph-\/lib} provides a mesh, {\ttfamily Geompack\+Quad\+Mesh}, that uses the output from \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} to generate an {\ttfamily oomph-\/lib} Mesh containing {\ttfamily QElement$<$2,2$>$} four-\/node quadrilateral elements. The relevant interface is\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \textcolor{comment}{//=========start\_of\_geompackquadmesh\_class================================}}
\DoxyCodeLine{\textcolor{comment}{\ \ ///\ Quadrilateral\ mesh\ generator;\ Uses\ input\ from\ Geompack++.}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ \ ///\ See:\ http://members.shaw.ca/bjoe/}}
\DoxyCodeLine{\textcolor{comment}{\ \ ///\ Currently\ only\ for\ four-\/noded\ quads\ -\/-\/\ extension\ to\ higher-\/order}}
\DoxyCodeLine{\textcolor{comment}{\ \ ///\ quads\ should\ be\ trivial\ (see\ the\ corresponding\ classes\ for}}
\DoxyCodeLine{\textcolor{comment}{\ \ ///\ triangular\ meshes).}}
\DoxyCodeLine{\textcolor{comment}{}\ \ \textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\ \ \textcolor{keyword}{class\ }GeompackQuadMesh\ :\ \textcolor{keyword}{public}\ Mesh}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{public}:\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ \ \ \ ///\ Constructor\ with\ the\ input\ files}}
\DoxyCodeLine{\textcolor{comment}{}\ \ \ \ GeompackQuadMesh(\textcolor{keyword}{const}\ std::string\&\ mesh\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ curve\_file\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TimeStepper*\ time\_stepper\_pt\ =\ \&Mesh::Default\_TimeStepper)}

\end{DoxyCodeInclude}
 The driver code \href{../../../../demo_drivers/meshing/mesh_from_geompack/mesh_from_geompack_poisson.cc}{\texttt{ mesh\+\_\+from\+\_\+geompack\+\_\+poisson.\+cc}} demonstrates the use of this mesh for the solution of a 2D Poisson problem in the "{}rectangular domain with a hole"{}, described in the previous section.

The code expects the names of {\ttfamily \texorpdfstring{$\ast$}{*}}.{\ttfamily mh2} and \texorpdfstring{$\ast$}{*}.{\ttfamily cs2} files generated by \href{http://members.shaw.ca/bjoe/}{\texttt{ {\ttfamily Geompack++} }} as command line arguments and stores them in the namespace {\ttfamily Command\+Line\+Args} 

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{convert__geom__file_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}*\ argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{\textcolor{comment}{//\ Store\ command\ line\ arguments}}
\DoxyCodeLine{\ CommandLineArgs::setup(argc,argv);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Check\ number\ of\ command\ line\ arguments:\ Need\ exactly\ two.}}
\DoxyCodeLine{\ \textcolor{keywordflow}{if}\ (argc!=3)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ std::string\ error\_message\ =}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}Wrong\ number\ of\ command\ line\ arguments.\(\backslash\)n"{}};}
\DoxyCodeLine{\ \ \ error\_message\ +=}
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}Must\ specify\ the\ following\ file\ names\ \ \(\backslash\)n"{}};}
\DoxyCodeLine{\ \ \ error\_message\ +=\ }
\DoxyCodeLine{\ \ \ \ \textcolor{stringliteral}{"{}filename.mh2\ then\ filename.cs2\(\backslash\)n"{}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{throw}\ OomphLibError(error\_message,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OOMPH\_CURRENT\_FUNCTION,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OOMPH\_EXCEPTION\_LOCATION);}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 The names of these files are then passed to the mesh constructor. Since the rest of the \href{../../../../demo_drivers/meshing/mesh_from_geompack/mesh_from_geompack_poisson.cc}{\texttt{ driver code }} is identical to that in the \href{../../../../doc/poisson/two_d_poisson/html/index.html}{\texttt{ corresponding example with a structured mesh}}, we do not provide a detailed code listing but simply show the plot of the computed results, together with the tanh-\/shaped exact solution of the problem\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{validate}
\doxyfigcaption{Computed and exact solutions. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_geompack/}{\texttt{ demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+geompack/ }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_geompack/mesh_from_geompack_poisson.cc}{\texttt{ demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+geompack/mesh\+\_\+from\+\_\+geompack\+\_\+poisson.\+cc }} \end{center} 
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
