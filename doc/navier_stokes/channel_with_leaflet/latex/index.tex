\chapter{Demo problem\+: Flow in a 2D channel with an oscillating leaflet}
\hypertarget{index}{}\label{index}\index{Demo problem: Flow in a 2D channel with an oscillating leaflet@{Demo problem: Flow in a 2D channel with an oscillating leaflet}}
In this example we consider the flow in a 2D channel which is partially obstructed by an oscillating leaflet. We consider the case where the motion of the leaflet is prescribed -- this is a "{}warm-\/up exercise"{} for the \href{../../../interaction/fsi_channel_with_leaflet/html/index.html}{\texttt{ corresponding FSI problem }} in which the leaflet is an elastic structure.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_the_problem}{}\doxysection{\texorpdfstring{The Problem}{The Problem}}\label{index_the_problem}
The figure below shows a sketch of the problem\+: A 2D channel of height $ H^*_{tot}$ and length $ L^*_{left} + L^*_{right} $ is partially occluded by a (zero-\/thickness) leaflet of height $ H^*_{leaflet} $. The leaflet is parametrised by a Lagrangian coordinate $ \xi^* $ so that the position vector to a material point on the leaflet is given by $ {\bf R}^*_w(\xi^*,t^*) $, and we assume that the leaflet performs time-\/periodic oscillations with period $ T^*. $ Steady Poiseuille flow with average velocity $ U^* $ is imposed at the left end of the channel while we assume that the outflow is parallel and axially traction-\/free.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{channel_with_leaflet_dim}
\doxyfigcaption{Sketch of the problem in dimensional }
\end{DoxyImage}


We non-\/dimensionalise all length and coordinates on the channel width, $ H^*_{tot}
$ , time on the natural timescale of the flow, $ H^*_{tot}/U^* $, the velocities on the mean velocity, $ U^* $, and the pressure on the viscous scale. The problem is then governed by the non-\/dimensional Navier-\/\+Stokes equations  \[
Re \left( St \frac{\partial u_i}{\partial t} + 
u_j \frac{\partial u_i}{\partial x_j} \right) =
- \frac{\partial p}{\partial x_i}  +
\frac{\partial }{\partial x_j} \left[ \left(
\frac{\partial u_i}{\partial x_j} +  
\frac{\partial u_j}{\partial x_i} \right) \right],
\] where $ Re = \rho U^* H_0^* / \mu $ and $ St = 1 $, and \begin{center}  \[
\frac{\partial u_i}{\partial x_i} = 0,
\] \end{center}  subject to parabolic inflow \begin{center}  \[
{\bf u} = 6 x_2 (1-x_2) {\bf e}_1
\] \end{center}  at the inflow cross-\/section; parallel, axially-\/traction-\/free outflow at the outlet; and no-\/slip on the stationary channel walls, $ {\bf u} = {\bf 0} $. The no-\/slip condition on the leaflet is \begin{center}  \[
{\bf u} = \frac{\partial {\bf R}_w(\xi,t)}{\partial t}
\] \end{center}  and the leaflet performs oscillations with non-\/dimensional period $ T = T^* U^* / H^*_{tot} $. Here is a sketch of the non-\/dimensional version of the problem\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{channel_with_leaflet}
\doxyfigcaption{Sketch of the problem in dimensionless variables. }
\end{DoxyImage}


An interesting feature of this problem is that even though the leaflet is assumed to have negligible thickness its presence will generate a pressure jump between its two faces. (The velocities are continuous because the no-\/slip condition imposes the same velocity on both faces.) When discretising the problem with {\ttfamily QTaylor\+Hood} elements (for which the pressure varies continuously across the element boundaries), the mesh must therefore be "{}opened up"{} with a cut along the position of the leaflet. This is done in the constructor of the \href{../../../meshes/mesh_list/html/index.html\#channel_with_leaflet}{\texttt{ {\ttfamily Channel\+With\+Leaflet\+Mesh}}} which forms the basis of {\ttfamily Refineable\+Algebraic\+Channel\+With\+Leaflet\+Mesh} used to discretise this problem. (See \doxysectlink{index_comm_and_ex}{Further comments and exercises}{1} for a more detailed discussion of the mesh.)

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_results}{}\doxysection{\texorpdfstring{Results}{Results}}\label{index_results}
The figure below shows a snapshot of the flow field ~\newline
 (pressure contours and instantaneous streamlines) for a Reynolds number of $ Re=20 $ and an oscillation period of $ T=20 $, as well as the corresponding fluid mesh. Note how {\ttfamily oomph-\/lib\textquotesingle{}s} automatic mesh adaptation has refined the mesh near the tip of the leaflet where the pressure has a singularity.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{channel_with_leaflet_flow_cropped}
\doxyfigcaption{Mesh (top) and flow field (bottom). }
\end{DoxyImage}


The corresponding \href{../figures/channel_with_leaflet_flow.avi}{\texttt{ animation}} illustrates the algebraic node update strategy (implemented with an {\ttfamily Algebraic\+Mesh}, discussed in more detail in \href{../../algebraic_collapsible_channel/html/index.html}{\texttt{ another tutorial}}) and the evolution of the flow field. Note that the instantaneous streamlines intersect the (impermeable) leaflet because the leaflet is not stationary.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_parameters}{}\doxysection{\texorpdfstring{The global parameters}{The global parameters}}\label{index_parameters}
As usual we use a namespace to define the (single) global parameter, the Reynolds number.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_global\_parameters=======================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Global\ parameters}}
\DoxyCodeLine{\textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceGlobal__Physical__Variables}{Global\_Physical\_Variables}}}
\DoxyCodeLine{\{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Reynolds\ number}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Re}}=20.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_namespace}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_leaflet}{}\doxysection{\texorpdfstring{Specification of the leaflet geometry}{Specification of the leaflet geometry}}\label{index_leaflet}
We specify the leaflet geometry and its time-\/dependent motion by representing it as a {\ttfamily Geom\+Object}. The {\ttfamily Geom\+Object} has one Lagrangian and two Eulerian coordinates, and its geometry is characterised by its length, the x-\/coordinate of its origin, $ X_0 $, and the period and amplitude of the horizontal and vertical tip deflection.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//===start\_of\_leaflet\_class===========================================}}
\DoxyCodeLine{\textcolor{comment}{///\ GeomObject\ representing\ a\ vertical\ leaflet\ that\ performs}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ bending\ and\ stretching\ oscillations.\ }}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classLeaflet}{Leaflet}}\ :\ \textcolor{keyword}{public}\ GeomObject}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ Pass\ length\ (in\ Lagrangian\ coordinates),}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ amplitude\ of\ the\ horizontal\ and\ vertical\ deflection\ of\ the\ tip,}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ x-\/coordinate\ of\ the\ origin\ and\ the\ period\ of\ the\ oscillation.}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Passes\ the\ number\ of\ Lagrangian\ and\ Eulerian\ coordinates\ to\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ constructor\ of\ the\ GeomObject\ base\ class.}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classLeaflet}{Leaflet}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classLeaflet_a7a28827b7081107ac9e33087598ca868}{length}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classLeaflet_a48b7c945eca16ff01995cc70cbf54210}{d\_x}},\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classLeaflet_a8ff8044a3da540c7c9d7a89790b6ee58}{d\_y}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classLeaflet_af4a819a3ba64960f4b796dc5a0d3eb5b}{x\_0}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ period,\ Time*\ time\_pt)}
\DoxyCodeLine{\ \ :\ GeomObject(1,2),\ \mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}}(\mbox{\hyperlink{classLeaflet_a7a28827b7081107ac9e33087598ca868}{length}}),\ \mbox{\hyperlink{classLeaflet_a473b6f4ef98bfba9e2c6974027ba4f4b}{D\_x}}(\mbox{\hyperlink{classLeaflet_a48b7c945eca16ff01995cc70cbf54210}{d\_x}}),\ \mbox{\hyperlink{classLeaflet_af9c75c7aeecae4b14f7ba0fb245eb8ee}{D\_y}}(\mbox{\hyperlink{classLeaflet_a8ff8044a3da540c7c9d7a89790b6ee58}{d\_y}}),\ \mbox{\hyperlink{classLeaflet_a29a25366a0cf97ad0dd36172fdfa3d0c}{X\_0}}(\mbox{\hyperlink{classLeaflet_af4a819a3ba64960f4b796dc5a0d3eb5b}{x\_0}}),}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classLeaflet_a0d78b5fb3ec71009d4a9bcc79f8a85a9}{T}}(period),\mbox{\hyperlink{classLeaflet_ac10f13ad45456dc714ab57042861de53}{Time\_pt}}(time\_pt)\ \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor\ -\/-\/\ emtpy}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classLeaflet_a0bbfaeec2534389b203fd2a2316db859}{\string~Leaflet}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Position\ vector,\ r,\ to\ the\ point\ identified\ by\ \ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ its\ 1D\ Lagrangian\ coordinate,\ xi\ (passed\ as\ a\ 1D\ Vector)\ at\ discrete\ time}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ level\ t\ (t=0:\ present;\ t>0:\ previous).}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLeaflet_a5b78c2735652b6a5c08c6aa9d38b6232}{position}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ t,\ \textcolor{keyword}{const}\ Vector<double>\&\ xi,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Vector<double>\&\ r)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ namespace\ }MathematicalConstants;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Position}}
\DoxyCodeLine{\ \ \ \ r[0]\ =\ \ \mbox{\hyperlink{classLeaflet_a29a25366a0cf97ad0dd36172fdfa3d0c}{X\_0}}\ +\ \mbox{\hyperlink{classLeaflet_a473b6f4ef98bfba9e2c6974027ba4f4b}{D\_x}}*xi[0]*xi[0]/\mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}}/\mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}}*sin(2.0*Pi*\mbox{\hyperlink{classLeaflet_ac10f13ad45456dc714ab57042861de53}{Time\_pt}}-\/>time(t)/\mbox{\hyperlink{classLeaflet_a0d78b5fb3ec71009d4a9bcc79f8a85a9}{T}});}
\DoxyCodeLine{\ \ \ \ r[1]\ =\ xi[0]*(1.0+\mbox{\hyperlink{classLeaflet_af9c75c7aeecae4b14f7ba0fb245eb8ee}{D\_y}}/\mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}}*0.5*(1.0-\/cos(4.0*Pi*\mbox{\hyperlink{classLeaflet_ac10f13ad45456dc714ab57042861de53}{Time\_pt}}-\/>time(t)/\mbox{\hyperlink{classLeaflet_a0d78b5fb3ec71009d4a9bcc79f8a85a9}{T}})));}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Steady\ version:\ Get\ current\ shape}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLeaflet_a5b78c2735652b6a5c08c6aa9d38b6232}{position}}(\textcolor{keyword}{const}\ Vector<double>\&\ xi,\ Vector<double>\&\ r)\textcolor{keyword}{\ const}}
\DoxyCodeLine{\textcolor{keyword}{\ \ }\{}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classLeaflet_a5b78c2735652b6a5c08c6aa9d38b6232}{position}}(0,xi,r);\ }
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Number\ of\ geometric\ Data\ in\ GeomObject:\ None.}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classLeaflet_a91f2460718ec5a4ef32e302b8b14cdca}{ngeom\_data}}()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ 0;\}\ \ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Length\ of\ the\ leaflet}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a7a28827b7081107ac9e33087598ca868}{length}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}};\ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Amplitude\ of\ horizontal\ tip\ displacement}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\&\ \mbox{\hyperlink{classLeaflet_a48b7c945eca16ff01995cc70cbf54210}{d\_x}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classLeaflet_a473b6f4ef98bfba9e2c6974027ba4f4b}{D\_x}};\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Amplitude\ of\ vertical\ tip\ displacement}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a8ff8044a3da540c7c9d7a89790b6ee58}{d\_y}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classLeaflet_af9c75c7aeecae4b14f7ba0fb245eb8ee}{D\_y}};\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ x-\/coordinate\ of\ leaflet\ origin}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_af4a819a3ba64960f4b796dc5a0d3eb5b}{x\_0}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classLeaflet_a29a25366a0cf97ad0dd36172fdfa3d0c}{X\_0}};\}}
\DoxyCodeLine{\ }
\DoxyCodeLine{private\ :}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Length\ in\ terms\ of\ Lagrangian\ coordinates}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a64c27b796ceece358d09d137f15bbf20}{Length}};}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Horizontal\ displacement\ of\ tip}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a473b6f4ef98bfba9e2c6974027ba4f4b}{D\_x}};}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Vertical\ displacement\ of\ tip}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_af9c75c7aeecae4b14f7ba0fb245eb8ee}{D\_y}};}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Origin}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a29a25366a0cf97ad0dd36172fdfa3d0c}{X\_0}};}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Period\ of\ the\ oscillations}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classLeaflet_a0d78b5fb3ec71009d4a9bcc79f8a85a9}{T}};}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ the\ global\ time\ object}}
\DoxyCodeLine{\textcolor{comment}{}\ Time*\ \mbox{\hyperlink{classLeaflet_ac10f13ad45456dc714ab57042861de53}{Time\_pt}};}
\DoxyCodeLine{}
\DoxyCodeLine{\};\ \textcolor{comment}{//end\_of\_the\_GeomObject}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_main}{}\doxysection{\texorpdfstring{The driver code}{The driver code}}\label{index_main}
We store the command line arguments, create a {\ttfamily Doc\+Info} object, and assign the parameters that specify the domain and the leaflet geometry\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//======start\_of\_main==================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Driver\ code\ -\/-\/\ pass\ a\ command\ line\ argument\ if\ you\ want\ to\ run}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ the\ code\ in\ validation\ mode\ where\ it\ only\ performs\ a\ few\ steps}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{channel__with__leaflet_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int}\ argc,\ \textcolor{keywordtype}{char}*\ argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Store\ command\ line\ arguments}}
\DoxyCodeLine{\ CommandLineArgs::setup(argc,argv);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ up\ doc\ info}}
\DoxyCodeLine{\ DocInfo\ doc\_info;\ }
\DoxyCodeLine{\ doc\_info.set\_directory(\textcolor{stringliteral}{"{}RESLT"{}});}
\DoxyCodeLine{\ doc\_info.number()=0;}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Parameters\ for\ the\ leaflet}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Height}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ h\_leaflet\ =\ 0.5;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Tip\ deflection}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ d\_x\ =\ 0.25;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ d\_y\ =\ -\/0.05;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ x-\/positon\ of\ root}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ x\_0\ =\ 3.0;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Period\ of\ the\ oscillation\ on\ the\ natural\ timescale\ of\ the\ flow}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ period\ =\ 20.0;}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Parameters\ for\ the\ domain}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Length\ of\ the\ mesh\ to\ right\ and\ left\ of\ the\ leaflet}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ l\_left\ =2.0;}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ l\_right=\ 3.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Total\ height\ of\ domain\ (unity\ because\ lengths\ have\ been\ scaled\ on\ it)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ h\_tot=1.0;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Initial\ number\ of\ element\ rows/columns\ in\ various\ mesh\ regions}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nleft=8;}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nright=12;}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ny1=2;}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ny2=2;\ }

\end{DoxyCodeInclude}
 Next we build the problem and assign the time-\/stepping parameters (as usual, fewer timesteps are used during a validation run which is identified by a non-\/zero number of command line arguments)\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Build\ the\ problem}}
\DoxyCodeLine{\ \mbox{\hyperlink{classChannelWithLeafletProblem}{ChannelWithLeafletProblem<AlgebraicElement<RefineableQTaylorHoodElement<2>}}\ >\ >}
\DoxyCodeLine{\ \ problem(l\_left,\ l\_right,\ h\_leaflet,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ h\_tot,nleft,\ nright,ny1,ny2,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ d\_x,\ d\_y,\ x\_0,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ period);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ timesteps\ per\ period}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nsteps\_per\_period=40;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ periods}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nperiod=3;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ timesteps\ (reduced\ for\ validation)}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ nstep=nsteps\_per\_period*nperiod;}
\DoxyCodeLine{\ \textcolor{keywordflow}{if}\ (CommandLineArgs::Argc>1)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ nstep=3;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Timestep:\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ dt=period/double(nsteps\_per\_period);}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Initialise\ timestep\ }}
\DoxyCodeLine{\textcolor{comment}{}\ problem.initialise\_dt(dt);}

\end{DoxyCodeInclude}


We start the simulation with a steady solve, allowing up to five levels of adaptive refinement (fewer if we are performing a validation run)\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Set\ max.\ number\ of\ adaptations\ (reduced\ for\ validation)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{unsigned}\ max\_adapt=5;}
\DoxyCodeLine{\ \textcolor{keywordflow}{if}\ (CommandLineArgs::Argc>1)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ max\_adapt=2;}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Do\ steady\ solve\ first\ -\/-\/\ this\ also\ sets\ the\ history\ values}}
\DoxyCodeLine{\ \textcolor{comment}{//\ to\ those\ corresponding\ to\ an\ impulsive\ start\ from\ the}}
\DoxyCodeLine{\ \textcolor{comment}{//\ steady\ solution}}
\DoxyCodeLine{\ problem.steady\_newton\_solve(max\_adapt);}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Output\ steady\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ problem.doc\_solution(doc\_info);}
\DoxyCodeLine{\ doc\_info.number()++;}

\end{DoxyCodeInclude}
 Finally, we enter the proper timestepping loop, allowing one spatial adaptation per timestep and suppressing the re-\/assignment of initial conditions following an adaptation by setting the parameter {\ttfamily first} to false (see the discussion of timestepping with automatic mesh adaptation in \href{../../../unsteady_heat/two_d_unsteady_heat_adapt/html/index.html}{\texttt{ another tutorial}}.)


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Reduce\ the\ max\ number\ of\ adaptations\ for\ time-\/dependent\ simulation}}
\DoxyCodeLine{\textcolor{comment}{}\ max\_adapt=1;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ We\ don't\ want\ to\ re-\/assign\ the\ initial\ condition\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{bool}\ first=\textcolor{keyword}{false};}
\DoxyCodeLine{\ }
\DoxyCodeLine{\textcolor{comment}{//\ Timestepping\ loop}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ istep=0;istep<nstep;istep++)}
\DoxyCodeLine{\ \ \{\ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Solve\ the\ problem}}
\DoxyCodeLine{\ \ \ problem.unsteady\_newton\_solve(dt,max\_adapt,first);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Output\ the\ solution}}
\DoxyCodeLine{\ \ \ problem.doc\_solution(doc\_info);}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Step\ number}}
\DoxyCodeLine{\ \ \ doc\_info.number()++;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\}\textcolor{comment}{//end\ of\ main}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_problem}{}\doxysection{\texorpdfstring{The Problem class}{The Problem class}}\label{index_problem}
The problem class has the usual member functions to perform actions after the mesh adaptation and before every implicit timestep\+:

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_problem\_class===========================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Problem\ class}}
\DoxyCodeLine{\textcolor{comment}{//===================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classChannelWithLeafletProblem}{ChannelWithLeafletProblem}}\ :\ \textcolor{keyword}{public}\ Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ Pass\ the\ length\ of\ the\ domain\ at\ the\ left}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ leaflet\ lleft,the\ length\ of\ the\ domain\ at\ the\ right\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ lright,the\ height\ of\ the\ leaflet\ hleaflet,\ the\ total\ height}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ domain\ htot,\ the\ number\ of\ macro-\/elements\ at\ the\ left\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ nleft,\ the\ number\ of\ macro-\/elements\ at\ the\ right\ of\ the}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ leaflet\ nright,\ the\ number\ of\ macro-\/elements\ under\ hleaflet\ ny1,}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ the\ number\ of\ macro-\/elements\ above\ hleaflet\ ny2,the\ x-\/displacement}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ leaflet\ d\_x,the\ y-\/displacement\ of\ the\ leaflet\ d\_y,the\ abscissa\ }}
\DoxyCodeLine{\textcolor{comment}{\ ///\ of\ the\ origin\ of\ the\ leaflet\ x\_0,\ the\ period\ of\ the\ moving\ leaflet.}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classChannelWithLeafletProblem}{ChannelWithLeafletProblem}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ l\_left,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ l\_right,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ h\_leaflet,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ h\_tot,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nleft,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nright,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ ny1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \ ny2,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ d\_x,\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ d\_y,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_0,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ period);\ \ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classChannelWithLeafletProblem_a5dec8333d345e4bcaac7fcd5b463eafc}{\string~ChannelWithLeafletProblem}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Overloaded\ access\ function\ to\ specific\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>*\ \mbox{\hyperlink{classChannelWithLeafletProblem_acfb056c1240242094b953a80bbc36c4e}{mesh\_pt}}()\ }
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ from\ pointer\ to\ the\ Mesh\ base\ class\ to\ the\ specific\ }}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ element\ type\ that\ we're\ using\ here.}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{dynamic\_cast<}RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>*\textcolor{keyword}{>}(}
\DoxyCodeLine{\ \ \ \ Problem::mesh\_pt());}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ after\ solve\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_a2fcba9dc98f40bbca1919a715fa087d7}{actions\_after\_newton\_solve}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ before\ solve\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_a5721dfad66d13a1ae60adce7801dcb12}{actions\_before\_newton\_solve}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Actions\ after\ adaptation:\ Pin\ redundant\ pressure\ dofs}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_a7978755f073d950e5012951ced9e455e}{actions\_after\_adapt}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Update\ the\ velocity\ boundary\ condition\ on\ the\ moving\ leaflet}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_acef6ec771775162f77295a8f92d695ac}{actions\_before\_implicit\_timestep}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_adb8e1420844f7b40d71beae81111c4d0}{doc\_solution}}(DocInfo\&\ doc\_info);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pointer\ to\ the\ GeomObject}}
\DoxyCodeLine{\textcolor{comment}{}\ GeomObject*\ \mbox{\hyperlink{classChannelWithLeafletProblem_ac32f0451749ec4e85d39246f5823a5f2}{Leaflet\_pt}};}
\DoxyCodeLine{\ }
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_constructor}{}\doxysection{\texorpdfstring{The problem constructor}{The problem constructor}}\label{index_constructor}
We construct the timestepper and the {\ttfamily Geom\+Object} that represents the leaflet, and pass it pointers to them to the constructor of the {\ttfamily Refineable\+Algebraic\+Channel\+With\+Leaflet\+Mesh} (discussed in more detail in \doxysectlink{index_comm_and_ex}{Further comments and exercises}{1}).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_constructor=================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Constructor}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\mbox{\hyperlink{classChannelWithLeafletProblem_a3c5a4c97ec66fe53bc130005c74a47b5}{ChannelWithLeafletProblem<ELEMENT>::ChannelWithLeafletProblem}}(}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ l\_left,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ l\_right,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ h\_leaflet,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ h\_tot,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nleft,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ nright,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ ny1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\&\ \ ny2,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ d\_x,\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ d\_y,}
\DoxyCodeLine{\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ x\_0,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\&\ period)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Allocate\ the\ timestepper}}
\DoxyCodeLine{\ add\_time\_stepper\_pt(\textcolor{keyword}{new}\ BDF<2>);}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Create\ the\ geometric\ object\ that\ represents\ the\ leaflet}}
\DoxyCodeLine{\ Leaflet\_pt\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLeaflet}{Leaflet}}(h\_leaflet,\ d\_x,\ d\_y,\ x\_0,\ period,\ time\_pt())\ ;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Build\ the\ mesh}}
\DoxyCodeLine{Problem::mesh\_pt()=\textcolor{keyword}{new}\ RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>(}
\DoxyCodeLine{\ Leaflet\_pt,}
\DoxyCodeLine{\ l\_left,\ l\_right,}
\DoxyCodeLine{\ h\_leaflet,}
\DoxyCodeLine{\ h\_tot,nleft,}
\DoxyCodeLine{\ nright,ny1,ny2,}
\DoxyCodeLine{\ time\_stepper\_pt());\ \ \ \ \ }

\end{DoxyCodeInclude}
 Next we create the spatial error estimator and loop over the elements to set the pointers to the relevant physical parameters.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ error\ estimator}}
\DoxyCodeLine{\ Z2ErrorEstimator*\ error\_estimator\_pt=\textcolor{keyword}{new}\ Z2ErrorEstimator;}
\DoxyCodeLine{\ \textcolor{keyword}{dynamic\_cast<}RefineableAlgebraicChannelWithLeafletMesh<ELEMENT>*\textcolor{keyword}{>}(mesh\_pt())-\/>}
\DoxyCodeLine{\ \ spatial\_error\_estimator\_pt()=error\_estimator\_pt;}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ the\ elements\ to\ set\ up\ element-\/specific\ }}
\DoxyCodeLine{\ \textcolor{comment}{//\ things\ that\ cannot\ be\ handled\ by\ constructor}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ n\_element\ =\ mesh\_pt()-\/>nelement();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ e=0;e<n\_element;e++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ from\ GeneralisedElement\ to\ the\ present\ element}}
\DoxyCodeLine{\ \ \ ELEMENT*\ el\_pt\ =\ \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(mesh\_pt()-\/>element\_pt(e));}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ Reynolds\ number}}
\DoxyCodeLine{\ \ \ el\_pt-\/>re\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ Womersley\ number\ (product\ of\ Reynolds\ and\ Strouhal).}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ We're\ assuming\ a\ Strouhal\ number\ of\ one,\ corresponding\ to}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ a\ non-\/dimensionalisation\ of\ time\ on\ the\ flow's\ natural\ timescale.}}
\DoxyCodeLine{\ \ \ el\_pt-\/>re\_st\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ loop\ over\ elements}}

\end{DoxyCodeInclude}
 The velocity is prescribed everywhere apart from the outflow boundary (boundary 1; see the sketch in \doxysectlink{index_comm_and_ex}{Further comments and exercises}{1} for the enumeration of the mesh boundaries). Along the inflow (boundary 3) we apply a parabolic velocity profile with unit flux\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Pin\ the\ boundary\ nodes}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ num\_bound\ =\ mesh\_pt()-\/>nboundary();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ ibound=0;ibound<num\_bound;ibound++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=\ mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>pin(1);}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{comment}{//do\ not\ pin\ the\ x\ velocity\ of\ the\ outflow}}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ibound\ !=\ 1)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>pin(0);\ }
\DoxyCodeLine{\ \ \ \ \ \ \}\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ parabolic\ flow\ along\ the\ inflow\ boundary\ 3}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ ibound=3;\ }
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ num\_nod=\ mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ ycoord\ =\ mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>x(1);\ }
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ uy\ =\ 6.0*(ycoord/h\_tot)*(1.0-\/(ycoord/h\_tot));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(0,uy);}
\DoxyCodeLine{\ \ \ mesh\_pt()-\/>boundary\_node\_pt(ibound,inod)-\/>set\_value(1,0.0);\ \ \ \ }
\DoxyCodeLine{\ \ \}\textcolor{comment}{//\ end\ of\ setup\ boundary\ condition}}

\end{DoxyCodeInclude}
 Finally, we pin the redundant pressure degrees of freedom (see \href{../../../navier_stokes/adaptive_driven_cavity/html/index.html}{\texttt{ another tutorial}} for details), and assign the equations numbers.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ redudant\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ pin\_redundant\_nodal\_pressures(Problem::mesh\_pt()-\/>element\_pt());}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ equation\ numbering\ scheme}}
\DoxyCodeLine{\ cout\ <<\ \textcolor{stringliteral}{"{}Number\ of\ equations:\ "{}}\ <<\ assign\_eqn\_numbers()\ <<\ std::endl;\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\}\textcolor{comment}{//end\ of\ constructor}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_timestep}{}\doxysection{\texorpdfstring{Actions before the timestep}{Actions before the timestep}}\label{index_timestep}
Before each timestep we update the nodal positions in the mesh and re-\/apply the no-\/slip condition on the nodes of the moving leaflet (boundaries 4 and 5; see the sketch in \doxysectlink{index_comm_and_ex}{Further comments and exercises}{1} for the enumeration of the mesh boundaries).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//=====start\_of\_actions\_before\_implicit\_timestep=========================}}
\DoxyCodeLine{\textcolor{comment}{///\ Actions\ before\ implicit\ timestep:\ Update\ domain\ shape\ and}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ the\ velocity\ boundary\ conditions}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ELEMENT>\ }
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_acef6ec771775162f77295a8f92d695ac}{ChannelWithLeafletProblem<ELEMENT>::actions\_before\_implicit\_timestep}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Update\ the\ domain\ shape}}
\DoxyCodeLine{\ mesh\_pt()-\/>node\_update();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Moving\ leaflet:\ No\ slip;\ this\ implies\ that\ the\ velocity\ needs}}
\DoxyCodeLine{\ \textcolor{comment}{//\ to\ be\ updated\ in\ response\ to\ leaflet\ motion}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{unsigned}\ ibound=4;ibound<6;ibound++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ num\_nod=mesh\_pt()-\/>nboundary\_node(ibound);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ inod=0;inod<num\_nod;inod++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Which\ node\ are\ we\ dealing\ with?}}
\DoxyCodeLine{\ \ \ \ \ Node*\ node\_pt=mesh\_pt()-\/>boundary\_node\_pt(ibound,inod);}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Apply\ no\ slip}}
\DoxyCodeLine{\ \ \ \ \ FSI\_functions::apply\_no\_slip\_on\_moving\_wall(node\_pt);}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}\ \textcolor{comment}{//end\_of\_actions\_before\_implicit\_timestep}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_adapt}{}\doxysection{\texorpdfstring{Actions after the mesh adaptation}{Actions after the mesh adaptation}}\label{index_adapt}
Once the mesh has been adapted, we free all pressure degrees of freedom and then (re-\/)pin any redundant ones (see \href{../../../navier_stokes/adaptive_driven_cavity/html/index.html}{\texttt{ another tutorial}} for details)\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==========start\_of\_actions\_after\_adaptation============================}}
\DoxyCodeLine{\textcolor{comment}{//\ Actions\ after\ adaptation:\ Pin\ redundant\ pressure\ dofs}}
\DoxyCodeLine{\textcolor{comment}{//=======================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_a7978755f073d950e5012951ced9e455e}{ChannelWithLeafletProblem<ELEMENT>::actions\_after\_adapt}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Unpin\ all\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ unpin\_all\_pressure\_dofs(mesh\_pt()-\/>element\_pt());}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Pin\ redundant\ pressure\ dofs}}
\DoxyCodeLine{\ RefineableNavierStokesEquations<2>::}
\DoxyCodeLine{\ \ pin\_redundant\_nodal\_pressures(mesh\_pt()-\/>element\_pt());}
\DoxyCodeLine{\ }
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_actions\_after\_adapt}}

\end{DoxyCodeInclude}
 Note that the default interpolation of the (quadratic!) inflow velocity profile from father to son elements during the mesh adaptation already ensures that the inflow profile remains quadratic, therefore no further action is required.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_doc}{}\doxysection{\texorpdfstring{Post-\/processing}{Post-processing}}\label{index_doc}
The function {\ttfamily doc\+\_\+solution(...)} documents the results.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_doc\_solution=================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classChannelWithLeafletProblem_adb8e1420844f7b40d71beae81111c4d0}{ChannelWithLeafletProblem<ELEMENT>::doc\_solution}}(DocInfo\&\ doc\_info)}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ ofstream\ some\_file;}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ filename[100];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ plot\ points}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ npts;}
\DoxyCodeLine{\ npts=5;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ solution\ }}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/soln\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ mesh\_pt()-\/>output(some\_file,npts);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ boundaries}}
\DoxyCodeLine{\ sprintf(filename,\textcolor{stringliteral}{"{}\%s/boundaries\%i.dat"{}},doc\_info.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ doc\_info.number());}
\DoxyCodeLine{\ some\_file.open(filename);}
\DoxyCodeLine{\ mesh\_pt()-\/>output\_boundaries(some\_file);}
\DoxyCodeLine{\ some\_file.close();}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_doc\_solution}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_comm_and_ex}{}\doxysection{\texorpdfstring{Further comments and exercises}{Further comments and exercises}}\label{index_comm_and_ex}
\hypertarget{index_comm}{}\doxysubsection{\texorpdfstring{Further comments\+: The algebraic node update procedure}{Further comments: The algebraic node update procedure}}\label{index_comm}
The figure below illustrates the algebraic node update procedure employed in the {\ttfamily Refineable\+Algebraic\+Channel\+With\+Leaflet\+Mesh}. The mesh employs four different node update functions, depending on which region a node is located in\+: Nodes in region I (or II) are located on straight lines that connect the upstream (or downstream) boundary with the leaflet; nodes in region III (or IV) are located on straight lines that connect the upstream and (or downstream) boundary with the straight line from the tip of the leaflet to upper channel wall.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{channel_with_leaflet_mesh}
\doxyfigcaption{Sketch illustrating the algebraic node update procedure. }
\end{DoxyImage}


The implementation of the node update functions is straightforward and can be found in the source files \begin{center} \href{
../../../../src/meshes/channel_with_leaflet_mesh.template.h}{\texttt{ src/meshes/channel\+\_\+with\+\_\+leaflet\+\_\+mesh.\+template.\+h }} \end{center} ~\newline
and \begin{center} \href{
../../../../src/meshes/channel_with_leaflet_mesh.template.cc}{\texttt{ src/meshes/channel\+\_\+with\+\_\+leaflet\+\_\+mesh.\+template.\+cc }} \end{center} ~\newline
which also illustrate how the mesh is constructed by inheritance from the {\ttfamily Simple\+Rectangular\+Quad\+Mesh} (the main task being the creation of additional nodes in the interior to "{}cut open"{} the mesh along the position of the leaflet). The source files also contain other versions of the mesh in which the node update is performed with Domain/\+Macro\+Elements, using the technique described in \href{../../../poisson/fish_poisson2/html/index.html}{\texttt{ another tutorial}}.\hypertarget{index_ex}{}\doxysubsection{\texorpdfstring{Exercise}{Exercise}}\label{index_ex}
With the node update strategy illustrated above, the position of {\itshape all} nodes in the fluid mesh has to be updated when the leaflet moves. This is not a particular problem in the current application where the node-\/update is only performed once per timestep. However, in the \href{../../../interaction/fsi_channel_with_leaflet/html/index.html}{\texttt{ corresponding FSI problem }}, the approach is costly because of the of large number of shape derivatives to be computed.

As an exercise, we suggest to make the node-\/update procedure more efficient by sub-\/dividing the regions upstream and downstream of the leaflet into a central section in which the nodes move in response to the motion of the leaflet (the old regions I-\/\+IV) and two additional regions (regions V and VI) in which they remain stationary. This is easy because, as explained \href{../../algebraic_collapsible_channel/html/index.html\#comm}{\texttt{ elsewhere,}} all {\ttfamily Algebraic\+Nodes} already have a default node update function that leaves them stationary.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{channel_with_leaflet_better_mesh}
\doxyfigcaption{A better node update strategy. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_ackn}{}\doxysection{\texorpdfstring{Acknowledgements}{Acknowledgements}}\label{index_ackn}

\begin{DoxyItemize}
\item This code was originally developed by Floraine Cordier.
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/navier_stokes/channel_with_leaflet/
}{\texttt{ demo\+\_\+drivers/navier\+\_\+stokes/channel\+\_\+with\+\_\+leaflet/ }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{
../../../../
demo_drivers/navier_stokes/channel_with_leaflet/channel_with_leaflet.cc
}{\texttt{ demo\+\_\+drivers/navier\+\_\+stokes/channel\+\_\+with\+\_\+leaflet/channel\+\_\+with\+\_\+leaflet.\+cc }} \end{center} 
\end{DoxyItemize}\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
