\chapter{Demo problem\+: Fluid Mechanics on unstructured meshes}
\hypertarget{index}{}\label{index}\index{Demo problem: Fluid Mechanics on unstructured meshes@{Demo problem: Fluid Mechanics on unstructured meshes}}
This tutorial provides another quick demonstration of how to use unstructured meshes for the solution of fluid flow problems. (The \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig }}/ \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ tutorial}} already contains 2D and 3D unstructured fluid examples.)

The specific problem considered here serves as a "{}warm-\/up problem"{} for the \href{../../../interaction/unstructured_fsi/html/index.html}{\texttt{ corresponding fluid-\/structure interaction problem}} in which the part of the domain boundary is replaced by an elastic object.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_problem}{}\doxysection{\texorpdfstring{The problem}{The problem}}\label{index_problem}
Here is a sketch of the problem\+: Flow is driven through a 2D channel that is partly obstructed by an odd-\/shaped obstacle. The flow is driven by the imposed Poiseuille flow at the upstream end of the channel.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{fluid_sketch}
\doxyfigcaption{Sketch of the problem. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_mesh}{}\doxysection{\texorpdfstring{Mesh generation}{Mesh generation}}\label{index_mesh}
We use the combination of \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}, {\ttfamily oomph-\/lib\textquotesingle{}s} conversion code \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ {\ttfamily fig2poly} }}, and the unstructured mesh generator \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} to generate the mesh, using the procedure discussed in \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ another tutorial.}}

We start by drawing the outline of the fluid domain as a polyline in \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}}\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{xfig_screenshot}
\doxyfigcaption{xfig drawing of the fluid body. }
\end{DoxyImage}


(Note that we draw the domain upside-\/down because of the way \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig}} orients its coordinate axes.)

We save the figure as a \texorpdfstring{$\ast$}{*}.fig file and convert it to a \texorpdfstring{$\ast$}{*}.poly file using {\ttfamily oomph-\/lib\textquotesingle{}s} conversion code \href{../../../meshes/mesh_from_xfig/html/index.html}{\texttt{ {\ttfamily fig2poly} }} (a copy of which is located in {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily bin} directory)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classElasticTriangleMesh}{fig2poly}}\ \mbox{\hyperlink{classElasticTriangleMesh}{fluid}}.fig\ }

\end{DoxyCode}


This creates a file called {\ttfamily fluid.\+fig.\+poly} that can be processed using Triangle. For instance, to create a quality mesh with a maximum element size of \doxylink{classElasticTriangleMesh_a4c24e9abbde344d34e1e08fb3319d7b6}{0.\+03} we use 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classElasticTriangleMesh}{triangle}}\ -\/\mbox{\hyperlink{classElasticTriangleMesh}{q}}\ -\/\mbox{\hyperlink{classElasticTriangleMesh}{a0}}.03\ \mbox{\hyperlink{classElasticTriangleMesh}{fluid}}.fig.poly}

\end{DoxyCode}


Here is a plot of the mesh, generated by {\ttfamily showme} distributed with \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }}\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{showme_screenshot}
\doxyfigcaption{Visualisation of the mesh with showme. }
\end{DoxyImage}


The {\ttfamily  \texorpdfstring{$\ast$}{*}.poly, \texorpdfstring{$\ast$}{*}.ele } and {\ttfamily  \texorpdfstring{$\ast$}{*}.node } files generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }} can now be used as input to {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Triangle\+Mesh} class.

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_results}{}\doxysection{\texorpdfstring{Results}{Results}}\label{index_results}
The animation shown below illustrates the flow field (streamlines and pressure contours) for Reynolds numbers of $ Re=0, 5, 10, ... $ An increase in Reynolds number increases the length of the recirculation region behind the obstacle; furthermore, the sharp corner at the "{}leading edge"{} of the obstacle creates very low pressures just downstream of the corner.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{stream}
\doxyfigcaption{Flowfield (streamlines and pressure contours) at various Reynolds numbers. }
\end{DoxyImage}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_mesh_code}{}\doxysection{\texorpdfstring{Creating the mesh}{Creating the mesh}}\label{index_mesh_code}
In anticipation of the mesh\textquotesingle{}s use in a fluid-\/structure interaction problem, we create the mesh by multiple inheritance from {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Triangle\+Mesh} and the {\ttfamily Solid\+Mesh} base class. This will allow us to use pseudo-\/solid node-\/update techniques to update the position of the fluid nodes in response to changes in the domain boundary. In the present problem, the "{}elasticity"{} of the fluid elements plays no useful role; see \doxysectlink{index_comm_ex}{Comments and Exercises}{1} for instructions on how to remove the pseudo-\/elasticity from the problem.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//===========start\_mesh====================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Triangle-\/based\ mesh\ upgraded\ to\ become\ a\ (pseudo-\/)\ solid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{//=========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classElasticTriangleMesh}{ElasticTriangleMesh}}\ :\ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ TriangleMesh<ELEMENT>,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{virtual}\ SolidMesh\ }
\DoxyCodeLine{\{}

\end{DoxyCodeInclude}
 The constructor calls the constructor of the underlying {\ttfamily Triangle\+Mesh}, and, as usual, sets the Lagrangian coordinates to the current nodal positions, making the current configuration stress-\/free.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor:\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classElasticTriangleMesh}{ElasticTriangleMesh}}(\textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classElasticTriangleMesh}{node\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classElasticTriangleMesh}{element\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \mbox{\hyperlink{classElasticTriangleMesh}{poly\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{TimeStepper}}*\ \mbox{\hyperlink{classElasticTriangleMesh}{time\_stepper\_pt}}=}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{classElasticTriangleMesh_a4c24e9abbde344d34e1e08fb3319d7b6}{Mesh::Default\_TimeStepper}})\ :\ }
\DoxyCodeLine{\ TriangleMesh<\mbox{\hyperlink{classElasticTriangleMesh}{ELEMENT}}>(\mbox{\hyperlink{classElasticTriangleMesh}{node\_file\_name}},\mbox{\hyperlink{classElasticTriangleMesh}{element\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{poly\_file\_name}},\ \mbox{\hyperlink{classElasticTriangleMesh}{time\_stepper\_pt}})}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Assign\ the\ Lagrangian\ coordinates}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{set\_lagrangian\_nodal\_coordinates}}();}
\DoxyCodeLine{\ \ \ }
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Identify\ the\ domain\ boundaries}}
\DoxyCodeLine{\ \ \ this-\/>identify\_boundaries();}
\DoxyCodeLine{\ \ \}}

\end{DoxyCodeInclude}
 The {\ttfamily Triangle\+Mesh} constructor associates each polyline in the {\ttfamily xfig} drawing with a distinct {\ttfamily oomph-\/lib} mesh boundary. Hence the boundary nodes are initially located on the same, single boundary. The boundary conditions can be more easily applied if the boundary is divided into three boundaries, which is the task of the function {\ttfamily Triangle\+Mesh\+::identify\+\_\+boundaries()}.

We first allocate storage for three boundaries\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Function\ used\ to\ identify\ the\ domain\ boundaries}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ identify\_boundaries()}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ We\ will\ have\ three\ boundaries}}
\DoxyCodeLine{\ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{set\_nboundary}}(3);}

\end{DoxyCodeInclude}
 We loop over all nodes in the mesh and identify nodes on the left (inflow) boundary by their x-\/coordinate. We remove the node from the boundary 0 and re-\/allocate it to the new boundary 1\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{n\_node}}=this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{nnode}}();}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{j}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{j}}<\mbox{\hyperlink{classElasticTriangleMesh}{n\_node}};\mbox{\hyperlink{classElasticTriangleMesh}{j}}++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{Node}}*\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}=this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{node\_pt}}(\mbox{\hyperlink{classElasticTriangleMesh}{j}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 1\ is\ left\ (inflow)\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(0)<0.226)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ not\ on\ the\ upper\ or\ lower\ channel\ walls\ remove\ it}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ from\ boundary\ 0}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)<4.08)\&\&(\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)>0.113))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{remove\_boundary\_node}}(0,\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}

\end{DoxyCodeInclude}
 Similarly, we identify all nodes on the right (outflow) boundary and re-\/assign them to boundary 2, before re-\/generating the various boundary lookup schemes that identify which elements are located next to the various mesh boundaries\+:


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{add\_boundary\_node}}(1,\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}});}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Boundary\ 2\ is\ right\ (outflow)\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(0)>8.28)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ not\ on\ the\ upper\ or\ lower\ channel\ walls\ remove\ it}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ from\ boundary\ 0}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)<4.08)\&\&(\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)>0.113))}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{remove\_boundary\_node}}(0,\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{add\_boundary\_node}}(2,\mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}});}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ this-\/>\mbox{\hyperlink{classElasticTriangleMesh}{setup\_boundary\_element\_info}}();}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Empty\ Destructor}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classElasticTriangleMesh}{\string~ElasticTriangleMesh}}()\ \{\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_namespace}{}\doxysection{\texorpdfstring{Problem Parameters}{Problem Parameters}}\label{index_namespace}
As usual we define the various problem parameters in a global namespace. We define the Reynolds number and prepare a pointer to a constitutive equation (for the pseudo-\/elastic elements).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_namespace==============================}}
\DoxyCodeLine{\textcolor{comment}{///\ Namespace\ for\ physical\ parameters}}
\DoxyCodeLine{\textcolor{comment}{//==================================================}}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceGlobal__Physical__Variables}{Global\_Physical\_Variables}}}
\DoxyCodeLine{\{}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Reynolds\ number}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Re}}=0.0;\ }
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Pseudo-\/solid\ Poisson\ ratio}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a3962c36313826b19f216f6bbbdd6a477}{Nu}}=0.3;}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constitutive\ law\ used\ to\ determine\ the\ mesh\ deformation}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classElasticTriangleMesh}{ConstitutiveLaw}}\ *\mbox{\hyperlink{namespaceGlobal__Physical__Variables_a2a37fb040c832ee7a086bb13bb02a100}{Constitutive\_law\_pt}}=0;}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_namespace}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_main}{}\doxysection{\texorpdfstring{The driver code}{The driver code}}\label{index_main}
We specify an output directory and instantiate a constitutive equation for the pseudo-\/elasticity, specifying the Poisson ratio.

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_main======================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Driver\ for\ unstructured\ fluid\ test\ problem}}
\DoxyCodeLine{\textcolor{comment}{//=====================================================================}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ \mbox{\hyperlink{unstructured__two__d__fluid_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Label\ for\ output}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{DocInfo}}\ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}};}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Set\ the\ constitutive\ law\ for\ the\ pseudo-\/elasticity}}
\DoxyCodeLine{\ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a2a37fb040c832ee7a086bb13bb02a100}{Global\_Physical\_Variables::Constitutive\_law\_pt}}\ =\ }
\DoxyCodeLine{\ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classElasticTriangleMesh}{GeneralisedHookean}}(\&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_a3962c36313826b19f216f6bbbdd6a477}{Global\_Physical\_Variables::Nu}});}

\end{DoxyCodeInclude}
 We create the {\ttfamily Problem} object and output the domain boundaries and the initial guess for the flow field. 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ \textcolor{comment}{//\ Build\ the\ problem\ with\ TTaylorHoodElements}}
\DoxyCodeLine{\ \ \mbox{\hyperlink{classUnstructuredFluidProblem}{UnstructuredFluidProblem}}<\mbox{\hyperlink{classElasticTriangleMesh}{PseudoSolidNodeUpdateElement}}<}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{TTaylorHoodElement<2>}},\ }
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{TPVDElement<2,3>}}\ >\ >\ \mbox{\hyperlink{classElasticTriangleMesh}{problem}};}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \textcolor{comment}{//\ Output\ boundaries\ }}
\DoxyCodeLine{\ \ \mbox{\hyperlink{classElasticTriangleMesh}{problem}}.fluid\_mesh\_pt()-\/>output\_boundaries(\textcolor{stringliteral}{"{}RESLT\_TH/boundaries.dat"{}});}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \textcolor{comment}{//\ Output\ the\ initial\ guess\ for\ the\ solution}}
\DoxyCodeLine{\ \ \mbox{\hyperlink{classElasticTriangleMesh}{problem}}.doc\_solution(\mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}});}
\DoxyCodeLine{\ \ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}}.number()++;}

\end{DoxyCodeInclude}
 Finally, we perform a straightforward parameter study by slowly increasing the Reynolds number of the flow from zero.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \textcolor{comment}{//\ Parameter\ study}}
\DoxyCodeLine{\ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{re\_increment}}=5.0;}
\DoxyCodeLine{\ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{nstep}}=2;\ \textcolor{comment}{//\ 10;}}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{i}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{i}}<\mbox{\hyperlink{classElasticTriangleMesh}{nstep}};\mbox{\hyperlink{classElasticTriangleMesh}{i}}++)}
\DoxyCodeLine{\ \ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Solve\ the\ problem}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{problem}}.newton\_solve();}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Output\ the\ solution}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{problem}}.doc\_solution(\mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}});}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}}.number()++;}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ Bump\ up\ Re}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}}+=\mbox{\hyperlink{classElasticTriangleMesh}{re\_increment}};}
\DoxyCodeLine{\ \ \ \}\ \ \textcolor{comment}{//end\_of\_parameter\_study}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_class}{}\doxysection{\texorpdfstring{The Problem class}{The Problem class}}\label{index_class}
The {\ttfamily Problem} class has the usual member functions and provides explicit storage for the fluid mesh. \mbox{[}This is again slight overkill for the problem at hand, and is done mainly in anticipation of the "{}upgrade"{} of this driver code to \href{../../../interaction/unstructured_fsi/html/index.html}{\texttt{ the FSI problem}} with its multiple meshes; in the present problem we could, of course, store the pointer to the problem\textquotesingle{}s one-\/and-\/only mesh directly in {\ttfamily Problem\+::mesh\+\_\+pt()}. \mbox{]}

 
\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_problem\_class============================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Unstructured\ fluid\ problem}}
\DoxyCodeLine{\textcolor{comment}{//====================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keyword}{class\ }\mbox{\hyperlink{classUnstructuredFluidProblem}{UnstructuredFluidProblem}}\ :\ \textcolor{keyword}{public}\ Problem}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Constructor\ }}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classUnstructuredFluidProblem_a9751f4afac540e148b3d90ae43dd5187}{UnstructuredFluidProblem}}();}
\DoxyCodeLine{\ \textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Destructor\ (empty)}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classUnstructuredFluidProblem_a4d660faa6bae35197a4ea73139ac9963}{\string~UnstructuredFluidProblem}}()\{\}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Access\ function\ for\ the\ fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classElasticTriangleMesh}{ElasticTriangleMesh<ELEMENT>}}*\&\ \mbox{\hyperlink{classUnstructuredFluidProblem_add8751b8347cee3103fee5d05f9674e1}{fluid\_mesh\_pt}}()\ }
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classUnstructuredFluidProblem_a9b653c3879c846b412068d03bfe8c202}{Fluid\_mesh\_pt}};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Set\ the\ boundary\ conditions}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFluidProblem_a4e57ba31d35b62c9c657c1cfd822ecde}{set\_boundary\_conditions}}();}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFluidProblem_abcc9f0065665ae5239988b1a812e3f78}{doc\_solution}}(\mbox{\hyperlink{classElasticTriangleMesh}{DocInfo}}\&\ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{\ ///\ Fluid\ mesh}}
\DoxyCodeLine{\textcolor{comment}{}\ \mbox{\hyperlink{classElasticTriangleMesh}{ElasticTriangleMesh<ELEMENT>}}*\ \mbox{\hyperlink{classUnstructuredFluidProblem_a9b653c3879c846b412068d03bfe8c202}{Fluid\_mesh\_pt}};}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\};\ \textcolor{comment}{//\ end\_of\_problem\_class}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_constructor}{}\doxysection{\texorpdfstring{The Problem constructor}{The Problem constructor}}\label{index_constructor}
We start by building the fluid mesh, using the files created by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\texttt{ {\ttfamily Triangle} }}.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{//==start\_constructor=====================================================}}
\DoxyCodeLine{\textcolor{comment}{///\ Constructor\ }}
\DoxyCodeLine{\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\mbox{\hyperlink{classUnstructuredFluidProblem_a9751f4afac540e148b3d90ae43dd5187}{UnstructuredFluidProblem<ELEMENT>::UnstructuredFluidProblem}}()}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//Create\ fluid\ mesh}}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classElasticTriangleMesh}{fluid\_node\_file\_name}}=\textcolor{stringliteral}{"{}fluid.fig.1.node"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classElasticTriangleMesh}{fluid\_element\_file\_name}}=\textcolor{stringliteral}{"{}fluid.fig.1.ele"{}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classElasticTriangleMesh}{fluid\_poly\_file\_name}}=\textcolor{stringliteral}{"{}fluid.fig.1.poly"{}};\ }
\DoxyCodeLine{\ Fluid\_mesh\_pt\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classElasticTriangleMesh}{ElasticTriangleMesh<ELEMENT>}}(\mbox{\hyperlink{classElasticTriangleMesh}{fluid\_node\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{fluid\_element\_file\_name}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{fluid\_poly\_file\_name}});}

\end{DoxyCodeInclude}
 Next, we apply the boundary conditions for the fluid and the pseudo-\/solid equations using the function {\ttfamily set\+\_\+boundary\+\_\+conditions()}, which also completes the build of the elements by setting the appropriate pointers to the physical variables.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Set\ the\ boundary\ conditions}}
\DoxyCodeLine{\ this-\/>set\_boundary\_conditions();}

\end{DoxyCodeInclude}
 We add the fluid mesh as a single sub-\/mesh to the {\ttfamily Problem} and build the global mesh (see the comment in \doxysectlink{index_class}{The Problem class}{1} .)


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Add\ fluid\ mesh}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{add\_sub\_mesh}}(fluid\_mesh\_pt());}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Build\ global\ mesh}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{build\_global\_mesh}}();}

\end{DoxyCodeInclude}
 Finally, we assign the equation numbers


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Setup\ equation\ numbering\ scheme}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{cout}}\ <<\textcolor{stringliteral}{"{}Number\ of\ equations:\ "{}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{assign\_eqn\_numbers}}()\ <<\ std::endl;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_constructor}}

\end{DoxyCodeInclude}
 \DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_bound}{}\doxysection{\texorpdfstring{Setting the boundary conditions}{Setting the boundary conditions}}\label{index_bound}
We pin the pseudo-\/solid nodes along all domain boundaries, apply a no-\/slip condition for the fluid velocity along the solid boundary (boundary 0), pin the velocity at the inflow (boundary 1, where we will impose a Poiseuille flow profile), and impose parallel outflow at the downstream end (boundary 2). Given that the manual identification of mesh boundaries in unstructured meshes that are generated by third-\/party mesh generators is a relatively error-\/prone process, we document the boundary conditions in three separate files to allow an external sanity check; see \href{../../../solid/unstructured_solid/html/index.html\#comm_ex}{\texttt{ the comments in the corresponding solid mechanics tutorial.}} The \doxysectlink{index_comm_ex}{Comments and Exercises}{1} section of the present tutorial also has a sub-\/section that illustrates what can go wrong.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{\ }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//============start\_of\_set\_boundary\_conditions=============================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Set\ the\ boundary\ conditions\ for\ the\ problem\ and\ document\ the\ boundary}}
\DoxyCodeLine{\textcolor{comment}{///\ nodes}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//==========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFluidProblem_a4e57ba31d35b62c9c657c1cfd822ecde}{UnstructuredFluidProblem<ELEMENT>::set\_boundary\_conditions}}()}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Doc\ pinned\ nodes}}
\DoxyCodeLine{\ std::ofstream\ \mbox{\hyperlink{classElasticTriangleMesh}{solid\_bc\_file}}(\textcolor{stringliteral}{"{}pinned\_solid\_nodes.dat"{}});}
\DoxyCodeLine{\ std::ofstream\ \mbox{\hyperlink{classElasticTriangleMesh}{u\_bc\_file}}(\textcolor{stringliteral}{"{}pinned\_u\_nodes.dat"{}});}
\DoxyCodeLine{\ std::ofstream\ \mbox{\hyperlink{classElasticTriangleMesh}{v\_bc\_file}}(\textcolor{stringliteral}{"{}pinned\_v\_nodes.dat"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Set\ the\ boundary\ conditions\ for\ fluid\ problem:\ All\ nodes\ are}}
\DoxyCodeLine{\ \textcolor{comment}{//\ free\ by\ default\ -\/-\/\ just\ pin\ the\ ones\ that\ have\ Dirichlet\ conditions}}
\DoxyCodeLine{\ \textcolor{comment}{//\ here.\ }}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{nbound}}=Fluid\_mesh\_pt-\/>nboundary();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{ibound}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}<\mbox{\hyperlink{classElasticTriangleMesh}{nbound}};\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}}=Fluid\_mesh\_pt-\/>nboundary\_node(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}});}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{inod}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{inod}}<\mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}};\mbox{\hyperlink{classElasticTriangleMesh}{inod}}++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Get\ node}}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{Node}}*\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}=Fluid\_mesh\_pt-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Pin\ velocity\ everywhere\ apart\ from\ outlet\ where\ we}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ have\ parallel\ outflow}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}!=2)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Pin\ it}}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>pin(0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Doc\ it\ as\ pinned}}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{u\_bc\_file}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(0)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Pin\ it}}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>pin(1);}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Doc\ it\ as\ pinned}}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{v\_bc\_file}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(0)\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(1)\ <<\ std::endl;}
\DoxyCodeLine{\ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Pin\ pseudo-\/solid\ positions\ everywhere}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{i}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{i}}<2;\mbox{\hyperlink{classElasticTriangleMesh}{i}}++)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Pin\ the\ node}}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{SolidNode}}*\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}=Fluid\_mesh\_pt-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}});}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>pin\_position(\mbox{\hyperlink{classElasticTriangleMesh}{i}});}
\DoxyCodeLine{\ \ \ \ \ \ \ }
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ Doc\ it\ as\ pinned}}
\DoxyCodeLine{\ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{solid\_bc\_file}}\ <<\ \mbox{\hyperlink{classElasticTriangleMesh}{nod\_pt}}-\/>x(\mbox{\hyperlink{classElasticTriangleMesh}{i}})\ <<\ \textcolor{stringliteral}{"{}\ "{}};}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{solid\_bc\_file}}\ <<\ std::endl;\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}\ \textcolor{comment}{//\ end\ loop\ over\ boundaries}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Close}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{solid\_bc\_file}}.close();}

\end{DoxyCodeInclude}
 We complete the build of the elements by specifying the Reynolds number and the constitutive equation for the pseudo-\/solid equations.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Complete\ the\ build\ of\ all\ elements\ so\ they\ are\ fully\ functional}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{n\_element}}\ =\ fluid\_mesh\_pt()-\/>nelement();}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{e}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{e}}<\mbox{\hyperlink{classElasticTriangleMesh}{n\_element}};\mbox{\hyperlink{classElasticTriangleMesh}{e}}++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Upcast\ from\ GeneralisedElement\ to\ the\ present\ element}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{ELEMENT}}*\ \mbox{\hyperlink{classElasticTriangleMesh}{el\_pt}}\ =\ \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classElasticTriangleMesh}{ELEMENT}}*\textcolor{keyword}{>}(fluid\_mesh\_pt()-\/>element\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{e}}));}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//Set\ the\ Reynolds\ number}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{el\_pt}}-\/>re\_pt()\ =\ \&\mbox{\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ Set\ the\ constitutive\ law}}
\DoxyCodeLine{\ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{el\_pt}}-\/>constitutive\_law\_pt()\ =}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespaceGlobal__Physical__Variables_a2a37fb040c832ee7a086bb13bb02a100}{Global\_Physical\_Variables::Constitutive\_law\_pt}};}
\DoxyCodeLine{\ \ \}\ }

\end{DoxyCodeInclude}
 Finally, we impose a Poiseuille profile at the inflow boundary (boundary 1).


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Apply\ fluid\ boundary\ conditions:\ Poiseuille\ at\ inflow}}
\DoxyCodeLine{\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Find\ max.\ and\ min\ y-\/coordinate\ at\ inflow}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{ibound}}=1;}
\DoxyCodeLine{\ \textcolor{comment}{//Initialise\ y\_min\ and\ y\_max\ to\ y-\/coordinate\ of\ first\ node\ on\ boundary}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{y\_min}}=fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},0)-\/>x(1);}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{y\_max}}=\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}};}
\DoxyCodeLine{\ \textcolor{comment}{//Loop\ over\ the\ rest\ of\ the\ nodes}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}}=\ fluid\_mesh\_pt()-\/>nboundary\_node(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}});}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{inod}}=1;\mbox{\hyperlink{classElasticTriangleMesh}{inod}}<\mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}};\mbox{\hyperlink{classElasticTriangleMesh}{inod}}++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{y}}=fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>x(1);}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{y}}>\mbox{\hyperlink{classElasticTriangleMesh}{y\_max}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{y\_max}}=\mbox{\hyperlink{classElasticTriangleMesh}{y}};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{y}}<\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}})}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{y\_min}}=\mbox{\hyperlink{classElasticTriangleMesh}{y}};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{y\_mid}}=0.5*(\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}}+\mbox{\hyperlink{classElasticTriangleMesh}{y\_max}});}
\DoxyCodeLine{\ }
\DoxyCodeLine{\ \textcolor{comment}{//\ Loop\ over\ all\ boundaries}}
\DoxyCodeLine{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{ibound}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}<fluid\_mesh\_pt()-\/>nboundary();\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}++)}
\DoxyCodeLine{\ \ \{}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}}=\ fluid\_mesh\_pt()-\/>nboundary\_node(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}});}
\DoxyCodeLine{\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{inod}}=0;\mbox{\hyperlink{classElasticTriangleMesh}{inod}}<\mbox{\hyperlink{classElasticTriangleMesh}{num\_nod}};\mbox{\hyperlink{classElasticTriangleMesh}{inod}}++)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Parabolic\ inflow\ at\ the\ left\ boundary\ (boundary\ 1)}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}==1)}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{y}}=fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>x(1);}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classElasticTriangleMesh}{veloc}}=1.5/(\mbox{\hyperlink{classElasticTriangleMesh}{y\_max}}-\/\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}})*}
\DoxyCodeLine{\ \ \ \ \ \ \ \ (\mbox{\hyperlink{classElasticTriangleMesh}{y}}-\/\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}})*(\mbox{\hyperlink{classElasticTriangleMesh}{y\_max}}-\/\mbox{\hyperlink{classElasticTriangleMesh}{y}})/((\mbox{\hyperlink{classElasticTriangleMesh}{y\_mid}}-\/\mbox{\hyperlink{classElasticTriangleMesh}{y\_min}})*(\mbox{\hyperlink{classElasticTriangleMesh}{y\_max}}-\/\mbox{\hyperlink{classElasticTriangleMesh}{y\_mid}}));}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>set\_value(0,\mbox{\hyperlink{classElasticTriangleMesh}{veloc}});}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>set\_value(1,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{comment}{//\ Zero\ flow\ elsewhere\ apart\ from\ x-\/velocity\ on\ outflow\ boundary}}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}}!=2)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>set\_value(0,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ fluid\_mesh\_pt()-\/>boundary\_node\_pt(\mbox{\hyperlink{classElasticTriangleMesh}{ibound}},\mbox{\hyperlink{classElasticTriangleMesh}{inod}})-\/>set\_value(1,0.0);}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}\ \textcolor{comment}{//\ end\_of\_set\_boundary\_conditions}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_doc}{}\doxysection{\texorpdfstring{Post-\/processing}{Post-processing}}\label{index_doc}
The post-\/processing routine outputs the flow field.


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//==start\_of\_doc\_solution=================================================}\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{///\ Doc\ the\ solution}}
\DoxyCodeLine{\textcolor{comment}{}\textcolor{comment}{//========================================================================}}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class}\ ELEMENT>}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUnstructuredFluidProblem_abcc9f0065665ae5239988b1a812e3f78}{UnstructuredFluidProblem<ELEMENT>::doc\_solution}}(\mbox{\hyperlink{classElasticTriangleMesh}{DocInfo}}\&\ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}})}
\DoxyCodeLine{\{\ }
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{ofstream}}\ \mbox{\hyperlink{classElasticTriangleMesh}{some\_file}};}
\DoxyCodeLine{\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classElasticTriangleMesh}{filename}}[100];}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Number\ of\ plot\ points}}
\DoxyCodeLine{\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classElasticTriangleMesh}{npts}};}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{npts}}=5;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//\ Output\ solution\ }}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{sprintf}}(\mbox{\hyperlink{classElasticTriangleMesh}{filename}},\textcolor{stringliteral}{"{}\%s/soln\%i.dat"{}},\mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}}.directory().c\_str(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classElasticTriangleMesh}{doc\_info}}.number());}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{some\_file}}.open(\mbox{\hyperlink{classElasticTriangleMesh}{filename}});}
\DoxyCodeLine{\ fluid\_mesh\_pt()-\/>output(\mbox{\hyperlink{classElasticTriangleMesh}{some\_file}},\mbox{\hyperlink{classElasticTriangleMesh}{npts}});}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{some\_file}}.close();}
\DoxyCodeLine{\}\ \textcolor{comment}{//end\_of\_doc\_solution}}

\end{DoxyCodeInclude}


\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_comm_ex}{}\doxysection{\texorpdfstring{Comments and Exercises}{Comments and Exercises}}\label{index_comm_ex}
\DoxyHorRuler{0}
\hypertarget{index_reynolds}{}\doxysubsection{\texorpdfstring{What is the Reynolds number?}{What is the Reynolds number?}}\label{index_reynolds}
The problem considered here is a "{}toy"{}-\/problem, devised to illustrate the use of unstructured meshes in fluids problems. The specific non-\/dimensionalisation and parameter values are therefore of secondary importance. However, since {\ttfamily oomph-\/lib\textquotesingle{}s} implementation of the Navier-\/\+Stokes equations is based on their non-\/dimensional form it is important to clarify the meaning of the Reynolds number in the present problem.

\href{../../driven_cavity/html/index.html\#equation}{\texttt{ Recall}} that the Reynolds number is defined as  \[
Re = \frac{\rho {\cal U} {\cal L}}{\mu}
\] where $ \rho $ and $ \mu $ are the fluid density and viscosity, respectively. $ {\cal L} $ is the reference length chosen for the non-\/dimensionalisation of the coordinates. In the present problem, where the domain boundaries were simply drawn in \href{http://en.wikipedia.org/wiki/Xfig}{\texttt{ xfig }}, no specific reference length was identified, but inspection of the maximum and minimum y-\/coordinates of the inflow boundary in the mesh plot shows that the inflow boundary has a (dimensional) length of $ (4.0875 - 0.1125) {\cal L} = 3.975 {\cal L}. $ In the non-\/dimensional version of the Navier-\/\+Stokes equations, all velocities are non-\/dimensionalised with a reference velocity $ {\cal U} $. When we applied the inflow boundary conditions, we chose the (dimensionless) inflow profile such that its integral over the inflow boundary yields a value of 1. The velocity scale $ {\cal U} $ may therefore be interpreted as a (dimensional) average inflow velocity through the channel, \doxylink{classElasticTriangleMesh_a4c24e9abbde344d34e1e08fb3319d7b6}{i.\+e}. the volume flux divided by the reference length scale.

\DoxyHorRuler{0}
\hypertarget{index_bound}{}\doxysubsection{\texorpdfstring{Setting the boundary conditions}{Setting the boundary conditions}}\label{index_bound}
We wish to re-\/iterate the comments made in the \href{../../../solid/unstructured_solid/html/index.html\#comm_ex}{\texttt{ corresponding solid mechanics tutorial}} that the manual identification of nodes on domain boundaries is tedious and therefore error prone. It pays off to {\bfseries{be as a paranoid as possible}}, by always documenting the domain boundaries and the applied boundary conditions.

Here is the plot of boundary conditions applied in the present problem. Hollow blue markers indicate (pseudo-\/)solid boundary conditions (both displacements are pinned); small red markers identify nodes where the vertical fluid velocity is pinned; hollow green markers (filling the space between the blue and red lines markers) identify nodes at which the horizontal fluid velocity is pinned.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{bcs}
\doxyfigcaption{Plot of the correct boundary conditions. }
\end{DoxyImage}


Here is another plot, obtained with the initial version of our driver code -- can you spot what\textquotesingle{}s wrong and can you identify the lines were added to the mesh constructor to fix the problem?

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{bcs_wrong}
\doxyfigcaption{Plot of the wrong boundary conditions. }
\end{DoxyImage}


\DoxyHorRuler{0}
\hypertarget{index_pseudo_elast}{}\doxysubsection{\texorpdfstring{Pseudo-\/elasticity}{Pseudo-elasticity}}\label{index_pseudo_elast}
As mentioned above, the elements\textquotesingle{} pseudo-\/elasticity plays no useful role in the present problem, as the domain boundaries remain at fixed positions and no mesh movement is required.


\begin{DoxyItemize}
\item As an exercise, remove all functionality related to the pseudo-\/elasticity by changing the element type from 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classElasticTriangleMesh}{PseudoSolidNodeUpdateElement<TTaylorHoodElement<2>}},\mbox{\hyperlink{classElasticTriangleMesh}{TPVDElement<2,3>}}\ >}

\end{DoxyCode}
 to 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classElasticTriangleMesh}{TTaylorHoodElement<2>}}}

\end{DoxyCode}
 Adjust the code as required (\doxylink{classElasticTriangleMesh_a4c24e9abbde344d34e1e08fb3319d7b6}{e.\+g}. remove mesh\textquotesingle{}s inheritance from the {\ttfamily Solid\+Mesh} base class; remove the application of boundary conditions for the nodal positions; etc) and confirm that the results for the flow field remain unchanged. ~\newline
~\newline

\item Alternatively, the pseudo-\/elasticity can can be suppressed by pinning all nodal positions, drastically reducing the number of degrees of freedom in the problem without the need to rewrite the rest of the code. (Note that this is also a useful test for the development of FSI codes.) ~\newline
~\newline

\item However, if the pseudo-\/elastic capabilities are retained the fluid mesh can indeed deform as an elastic body; for example, by specifying a (solid mechanics) body force. Simply follow the steps used in \href{../../../solid/unstructured_solid/html/index.html}{\texttt{ the corresponding solid mechanics problem.}} Define the body force in the namespace {\ttfamily \doxylink{namespaceGlobal__Physical__Variables}{Global\+\_\+\+Physical\+\_\+\+Variables}} and pass a (function-\/)pointer to it to the elements. \doxylink{classElasticTriangleMesh_a4c24e9abbde344d34e1e08fb3319d7b6}{N.\+B}. The body force for the (pseudo-\/)solid equations must be specified explicitly because the Navier-\/\+Stokes equations have their own body force pointer! The compiler will complain about ambiguities in the following code\+: ~\newline
 
\begin{DoxyCode}{0}
\DoxyCodeLine{[...]}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Set\ the\ body\ force}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{el\_pt}}-\/>body\_force\_fct\_pt()\ =\ Global\_Physical\_Variables::gravity;}
\DoxyCodeLine{}
\DoxyCodeLine{[...]\ \ }

\end{DoxyCode}
 Instead, we must be more specific by writing ~\newline
 
\begin{DoxyCode}{0}
\DoxyCodeLine{[...]}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{//Set\ the\ body\ force}}
\DoxyCodeLine{\ \mbox{\hyperlink{classElasticTriangleMesh}{el\_pt}}-\/>PVDEquationsBase<2>::body\_force\_fct\_pt()\ =\ }
\DoxyCodeLine{\ \ Global\_Physical\_Variables::gravity;}
\DoxyCodeLine{}
\DoxyCodeLine{[...]\ \ \ }

\end{DoxyCode}
 indicating that it is the body force defined in the 2D solid mechanics equations that is being specified.
\end{DoxyItemize}\DoxyHorRuler{0}
 \DoxyHorRuler{0}
\hypertarget{index_sources}{}\doxysection{\texorpdfstring{Source files for this tutorial}{Source files for this tutorial}}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/navier_stokes/unstructured_fluid/}{\texttt{ demo\+\_\+drivers/navier\+\_\+stokes/unstructured\+\_\+fluid/ }} \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/navier_stokes/unstructured_fluid/unstructured_two_d_fluid.cc}{\texttt{ demo\+\_\+drivers/navier\+\_\+stokes/unstructured\+\_\+fluid/unstructured\+\_\+two\+\_\+d\+\_\+fluid.\+cc }} \end{center} 
\end{DoxyItemize}

\DoxyHorRuler{0}
 \DoxyHorRuler{0}
 \hypertarget{index_pdf}{}\doxysection{\texorpdfstring{PDF file}{PDF file}}\label{index_pdf}
A \href{../latex/refman.pdf}{\texttt{ pdf version}} of this document is available. \end{document}
